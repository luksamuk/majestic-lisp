<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt-br" xml:lang="pt-br">
<head>
<!-- 2022-10-24 seg 00:27 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Interpretação</title>
<meta name="author" content="Lucas S. Vieira" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="./main.css" />
<link rel="stylesheet" type="text/css" href="./syntax.css" />
<link id="theme-css" rel="stylesheet" type="text/css" href="./dark-theme.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:image" content="../img/cat-i-mage.jpg">
<meta name="theme-color" content="#14171e">
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="08-interpretador.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">Interpretação</h1>
<p>
Arquivo: <code>evaluator/evaluation.rs</code>
</p>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">use</span> <span style="color: #569cd6;">gc</span>::<span style="color: #4ec9b0;">Gc</span>;
<span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::maj_list;
<span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">core</span>::{ <span style="color: #4ec9b0;">Maj</span>, <span style="color: #4ec9b0;">MajState</span> };
<span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">axioms</span>::<span style="color: #569cd6;">predicates</span>::{
    maj_eq,
    maj_nilp,
    maj_symbolp,
    maj_errorp,
    maj_literalp,
    maj_numberp,
    maj_charp,
    maj_streamp,
    maj_stringp,
    maj_macrop
};
<span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">axioms</span>::<span style="color: #569cd6;">primitives</span>::{
    maj_car,
    maj_cdr,
    maj_err,
    maj_length
};

<span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">axioms</span>::<span style="color: #569cd6;">utils</span>::{
    <span style="color: #4ec9b0;">STACK_RED_ZONE</span>,
    <span style="color: #4ec9b0;">STACK_PER_RECURSION</span>
};

<span style="color: #569cd6;">use</span> <span style="color: #569cd6;">super</span>::maj_apply;
</pre>
</div>

<div id="outline-container-orga186e7f" class="outline-2">
<h2 id="orga186e7f"><span class="section-number-2">1.</span> <span class="todo TODO">TODO</span> Interpretação genérica</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>Um <i>erro</i> deverá suspender a interpretação imediatamente, sendo levado
ao <i>top-level</i> da interpretação sem que mais ações sejam feitas;</li>
<li>Um objeto <i>auto-interpretável</i> deverá ser interpretado para si mesmo;</li>
<li>Um <i>literal</i> deve ser interpretado para si mesmo;</li>
<li>Uma <i>variável</i> deve ser consultada no <i>contexto</i> atual;</li>
<li>Uma expressão <i>quotada</i> deve retornar seu conteúdo;</li>
<li>Uma   expressão    <i>quasiquotada</i>   deverá    realizar   substituições
apropriadamente e retornar seu valor apropriado;</li>
<li>Uma <i>definição</i> deverá alterar o contexto global;</li>
<li>Uma <i>condição</i> deverá ter seu predicado interpretado, e então realizar
<i>branching</i> para a situação adequada;</li>
<li>Uma  <i>clausura</i>  deverá ser  transformada  em  um literal  apropriado,
condizente com clausuras;</li>
<li>Uma forma <i>do</i>  deverá ter cada um de seus  elementos interpretados, e
será retornado o valor de interpretação do último;</li>
<li><i>and</i></li>
<li><i>or</i></li>
<li>Uma <i>aplicação</i> consistirá em delegar a aplicação do primeiro elemento
aos argumentos  informados. Antes desse  passo de despacho,  cada um
dos  elementos  (incluindo  o   primeiro)  deverá  ser  interpretado
recursivamente;</li>
<li>Caso nenhuma das situações se encaixe, então constitui-se um erro de
interpretação de uma forma desconhecida.</li>
</ul>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">pub</span> <span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_eval</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
                <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;,
                <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">use crate::maj_format;</span>
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">println!("EVAL: {}", maj_format(&amp;state, expr.clone()));</span>

    <span style="color: #6a9955;">/* </span><span style="color: #6a9955;">Errors */</span>
    <span style="color: #569cd6;">if</span> maj_errorp(expr.clone()).to_bool() {
        expr
    }

    <span style="color: #6a9955;">/* </span><span style="color: #6a9955;">Special forms */</span>
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">self-evaluating forms:</span>
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">Literals, numbers, characters, streams</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_is_selfeval(expr.clone()) {
        expr
    }
    
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">variables</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_symbolp(expr.clone()).to_bool() {
        state.lookup(env, expr)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">quote</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_quotep(expr.clone()).to_bool() {
        maj_handle_quote(expr)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">quasiquote</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_quasiquotep(expr.clone()).to_bool() {
        maj_handle_quasiquote(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">macros</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_macp(expr.clone()).to_bool() {
        maj_handle_mac(expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">definitions</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_defp(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr.clone()).to_bool() {
        maj_handle_definition(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">redefinitions</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_setp(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr.clone()).to_bool() {
        maj_handle_redefinition(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">redefinitions for a cons cell</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_set_car_p(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr.clone()).to_bool() {
        maj_handle_redefine_car(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_set_cdr_p(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr.clone()).to_bool() {
        maj_handle_redefine_cdr(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">conditionals</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_ifp(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr.clone()).to_bool() {
        maj_handle_if(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">closures</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_fnp(expr.clone()).to_bool() {
        maj_handle_fn(expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">do</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_dop(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr.clone()).to_bool() {
        maj_handle_do(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">and</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_andp(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr.clone()).to_bool() {
        maj_handle_and(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">or</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_orp(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr.clone()).to_bool() {
        maj_handle_or(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">apply</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_applyp(expr.clone()).to_bool() {
        maj_handle_apply(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">while</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_whilep(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr.clone()).to_bool() {
        maj_handle_while(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">letrec</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_letrecp(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr.clone()).to_bool() {
        maj_handle_letrec(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">unwind-protect</span>
    <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_unwind_protect_p(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr.clone()).to_bool() {
        maj_handle_unwind_protect(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env)
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">application</span>
    <span style="color: #569cd6;">else</span> {
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">fun</span> = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state,
                           maj_car(expr.clone()),
                           env.clone());
        <span style="color: #569cd6;">if</span> maj_errorp(fun.clone()).to_bool() {
            <span style="color: #569cd6;">return</span> fun;
        }

        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">args</span> =
            <span style="color: #569cd6;">if</span> maj_macrop(fun.clone()).to_bool() {
                maj_cdr(expr)
            } <span style="color: #569cd6;">else</span> {
                maj_evlist(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state,
                           maj_cdr(expr),
                           env.clone())
            };
        
        <span style="color: #569cd6;">if</span> maj_errorp(args.clone()).to_bool() {
            <span style="color: #569cd6;">return</span> args;
        }

        <span style="color: #569cd6;">stacker</span>::maybe_grow(
            <span style="color: #4ec9b0;">STACK_RED_ZONE</span>,
            <span style="color: #4ec9b0;">STACK_PER_RECURSION</span>,
            || maj_apply(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, fun, args, env))
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ba8fde" class="outline-2">
<h2 id="org5ba8fde"><span class="section-number-2">2.</span> <span class="todo TODO">TODO</span> Interpretação iterativa de listas</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_evlist</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
              <span style="color: #9cdcfe;">list</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;,
              <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">elts</span> = <span style="color: #4ec9b0;">Vec</span>::new();
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">itr</span> = list.clone();
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">Evaluate member by member</span>
    <span style="color: #569cd6;">while</span> !maj_nilp(itr.clone()).to_bool() {
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">elt</span> = maj_car(itr.clone());
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">elt</span> = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, elt, env.clone());
        <span style="color: #569cd6;">if</span> maj_errorp(elt.clone()).to_bool() {
            <span style="color: #569cd6;">return</span> elt;
        }
        elts.push(elt);
        itr = maj_cdr(itr);
    }
    elts.reverse();
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">Generate list of evaluated members backwards</span>
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">new_list</span> = <span style="color: #4ec9b0;">Maj</span>::nil();
    
    <span style="color: #569cd6;">for</span> <span style="color: #9cdcfe;">elt</span> <span style="color: #569cd6;">in</span> elts.iter() {
        new_list = <span style="color: #4ec9b0;">Maj</span>::cons(elt.clone(),
                             new_list.clone());
    }
    new_list
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org027024d" class="outline-2">
<h2 id="org027024d"><span class="section-number-2">3.</span> <span class="todo TODO">TODO</span> Formas especiais</h2>
<div class="outline-text-2" id="text-3">
</div>

<div id="outline-container-org5382f47" class="outline-3">
<h3 id="org5382f47"><span class="section-number-3">3.1.</span> Expressão quotada</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_quote</span>(<span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">length</span> = maj_length(expr.clone())
        .to_integer().unwrap();
    <span style="color: #569cd6;">if</span> length != 2 {
        <span style="color: #569cd6;">return</span> maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Invalid syntax: {}"</span>),
            <span style="color: #c586c0;">maj_list!</span>(expr));
    }

    maj_car(maj_cdr(expr))
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org15ae8ad" class="outline-3">
<h3 id="org15ae8ad"><span class="section-number-3">3.2.</span> Expressão quasiquotada</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_quasiquote</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>, <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">length</span> = maj_length(expr.clone())
        .to_integer().unwrap();
    <span style="color: #569cd6;">if</span> length != 2 {
        <span style="color: #569cd6;">return</span> maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Invalid syntax: {}"</span>),
            <span style="color: #c586c0;">maj_list!</span>(expr));
    }
    maj_do_quasiquote(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, maj_car(maj_cdr(expr)), env)
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_do_quasiquote</span>(
    <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
    <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;,
    <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;
) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">axioms</span>::<span style="color: #569cd6;">predicates</span>::maj_atomp;
    <span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">axioms</span>::<span style="color: #569cd6;">primitives</span>::maj_append;
    
    <span style="color: #569cd6;">if</span> maj_atomp(expr.clone()).to_bool() {
        <span style="color: #569cd6;">return</span> expr;
    }

    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car</span>  = maj_car(expr.clone());
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">cdr</span>  = maj_cdr(expr.clone());
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">cadr</span> = maj_car(cdr.clone());

    <span style="color: #569cd6;">if</span> maj_unquotep(expr.clone()).to_bool() ||
        maj_unquote_splice_p(expr.clone()).to_bool() {
            maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, cadr.clone(), env.clone())
        } <span style="color: #569cd6;">else</span> {
            <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">should_append</span> = maj_unquote_splice_p(
                car.clone()
            ).to_bool();
            <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car_qquote</span> = maj_do_quasiquote(
                <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, car.clone(), env.clone());

            <span style="color: #569cd6;">if</span> maj_errorp(car_qquote.clone()).to_bool() {
                <span style="color: #569cd6;">return</span> car_qquote;
            }

            <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">rest</span> = maj_do_quasiquote(
                <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state,
                cdr.clone(),
                env.clone());
            <span style="color: #569cd6;">if</span> maj_errorp(rest.clone()).to_bool() {
                <span style="color: #569cd6;">return</span> rest;
            }

            <span style="color: #569cd6;">if</span> should_append {
                maj_append(<span style="color: #c586c0;">maj_list!</span>(car_qquote, rest))
            } <span style="color: #569cd6;">else</span> {
                <span style="color: #4ec9b0;">Maj</span>::cons(car_qquote, rest)
            }
        }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ecbe89" class="outline-3">
<h3 id="org9ecbe89"><span class="section-number-3">3.3.</span> Definição (<code>def</code>)</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_definition</span>(
    <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
    <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;,
    <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;
) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">length</span> = maj_length(expr.clone())
        .to_integer().unwrap();
    <span style="color: #569cd6;">if</span> length != 3 {
        <span style="color: #569cd6;">return</span> maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Invalid syntax: {}"</span>),
            <span style="color: #c586c0;">maj_list!</span>(expr));
    }

    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">sym</span> = maj_car(maj_cdr(expr.clone()));
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">val</span> = maj_car(maj_cdr(maj_cdr(expr)));

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">Evaluate associated value before binding</span>
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">val</span> = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, val, env);
    <span style="color: #569cd6;">if</span> maj_errorp(val.clone()).to_bool() {
        <span style="color: #569cd6;">return</span> val;
    }

    <span style="color: #569cd6;">if</span> maj_symbolp(sym.clone()).to_bool() {
        <span style="color: #6a9955;">// </span><span style="color: #6a9955;">Try finding thing on environment.</span>
        <span style="color: #6a9955;">// </span><span style="color: #6a9955;">An error means it does not exist</span>
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">element</span> = state.assoc(<span style="color: #4ec9b0;">Maj</span>::nil(), sym.clone());
        <span style="color: #569cd6;">if</span> !maj_errorp(element.clone()).to_bool() {
            <span style="color: #6a9955;">// </span><span style="color: #6a9955;">If exists, attribute destructively</span>
            <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">new_entry</span> = <span style="color: #4ec9b0;">Maj</span>::cons(sym.clone(), val);
            <span style="color: #f16969; background-color: #252526;">unsafe</span> {
                <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">raw_element</span> = <span style="color: #4ec9b0;">Gc</span>::into_raw(element.clone());
                <span style="color: #569cd6;">std</span>::<span style="color: #569cd6;">ptr</span>::copy_nonoverlapping(
                    <span style="color: #4ec9b0;">Gc</span>::into_raw(new_entry.clone()),
                    raw_element <span style="color: #569cd6;">as</span> *<span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">Maj</span>, 1);
            }
            sym
        } <span style="color: #569cd6;">else</span> {
            <span style="color: #6a9955;">// </span><span style="color: #6a9955;">Else, push new element to state</span>
            state.push(sym, val)
        }
    } <span style="color: #569cd6;">else</span> {
        maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"{} is not a symbol"</span>),
            <span style="color: #c586c0;">maj_list!</span>(sym))
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org157d9d6" class="outline-3">
<h3 id="org157d9d6"><span class="section-number-3">3.4.</span> Redefinição (<code>set</code>)</h3>
<div class="outline-text-3" id="text-3-4">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_redefinition</span>(
    <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
    <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;,
    <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;
) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">length</span> = maj_length(expr.clone())
        .to_integer().unwrap();
    <span style="color: #569cd6;">if</span> length != 3 {
        <span style="color: #569cd6;">return</span> maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Invalid syntax: {}"</span>),
            <span style="color: #c586c0;">maj_list!</span>(expr));
    }

    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">sym</span> = maj_car(maj_cdr(expr.clone()));
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">val</span> = maj_car(maj_cdr(maj_cdr(expr)));

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">Evaluate associated value before binding</span>
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">val</span> = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, val, env.clone());
    <span style="color: #569cd6;">if</span> maj_errorp(val.clone()).to_bool() {
        <span style="color: #569cd6;">return</span> val;
    }

    <span style="color: #569cd6;">if</span> maj_symbolp(sym.clone()).to_bool() {
        <span style="color: #6a9955;">// </span><span style="color: #6a9955;">Try finding thing on both environments.</span>
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">element</span> = state.assoc(env, sym.clone());
        <span style="color: #569cd6;">if</span> maj_errorp(element.clone()).to_bool() {
            element
        } <span style="color: #569cd6;">else</span> {
            <span style="color: #6a9955;">// </span><span style="color: #6a9955;">When found, replace binding cons</span>
            <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">new_binding</span> = <span style="color: #4ec9b0;">Maj</span>::cons(sym.clone(), val);
            <span style="color: #f16969; background-color: #252526;">unsafe</span> {
                <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">rawelement</span> = <span style="color: #4ec9b0;">Gc</span>::into_raw(element.clone());
                <span style="color: #569cd6;">std</span>::<span style="color: #569cd6;">ptr</span>::copy_nonoverlapping(
                    <span style="color: #4ec9b0;">Gc</span>::into_raw(new_binding.clone()),
                    rawelement <span style="color: #569cd6;">as</span> *<span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">Maj</span>, 1);
            }
            sym
        }
    } <span style="color: #569cd6;">else</span> {
        maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"{} is not a symbol"</span>),
            <span style="color: #c586c0;">maj_list!</span>(sym))
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2015c53" class="outline-3">
<h3 id="org2015c53"><span class="section-number-3">3.5.</span> Redefinições para células cons (<code>set-car</code> e <code>set-cdr</code>)</h3>
<div class="outline-text-3" id="text-3-5">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_redefine_cxr_helper</span>(
    <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
    <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;,
    <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;
) -&gt; <span style="color: #4ec9b0;">Result</span>&lt;(<span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;), <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;&gt; {
    <span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">axioms</span>::<span style="color: #569cd6;">predicates</span>::maj_consp;
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">length</span> = maj_length(expr.clone())
        .to_integer().unwrap();
    <span style="color: #569cd6;">if</span> length != 3 {
        <span style="color: #569cd6;">return</span> <span style="color: #4ec9b0;">Err</span>(maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Invalid syntax: {}"</span>),
            <span style="color: #c586c0;">maj_list!</span>(expr)));
    }

    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">value</span> = maj_car(maj_cdr(maj_cdr(expr.clone())));
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">pair</span>  = maj_car(maj_cdr(expr));

    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">value</span> = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, value, env.clone());
    <span style="color: #569cd6;">if</span> maj_errorp(value.clone()).to_bool() {
        <span style="color: #569cd6;">return</span> <span style="color: #4ec9b0;">Err</span>(value);
    }
    
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">pair</span> = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, pair, env.clone());
    <span style="color: #569cd6;">if</span> maj_errorp(pair.clone()).to_bool() {
        <span style="color: #569cd6;">return</span> <span style="color: #4ec9b0;">Err</span>(pair);
    } <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> !maj_consp(pair.clone()).to_bool() {
        <span style="color: #569cd6;">return</span> <span style="color: #4ec9b0;">Err</span>(maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"{} is not a cons cell"</span>),
            <span style="color: #c586c0;">maj_list!</span>(pair)));
    }

    <span style="color: #4ec9b0;">Ok</span>((pair, value))
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_redefine_car</span>(
    <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
    <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;,
    <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;
) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">match</span> maj_handle_redefine_cxr_helper(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env) {
        <span style="color: #4ec9b0;">Ok</span>((pair, value)) =&gt; {
            <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">new_pair</span> = <span style="color: #4ec9b0;">Maj</span>::cons(value, maj_cdr(pair.clone()));
            <span style="color: #f16969; background-color: #252526;">unsafe</span> {
                <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">rawpair</span> = <span style="color: #4ec9b0;">Gc</span>::into_raw(pair.clone());
                <span style="color: #569cd6;">std</span>::<span style="color: #569cd6;">ptr</span>::copy_nonoverlapping(
                    <span style="color: #4ec9b0;">Gc</span>::into_raw(new_pair.clone()),
                    rawpair <span style="color: #569cd6;">as</span> *<span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">Maj</span>, 1);
            }
            pair
        },
        <span style="color: #4ec9b0;">Err</span>(error) =&gt; error,
    }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_redefine_cdr</span>(
    <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
    <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;,
    <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;
) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">match</span> maj_handle_redefine_cxr_helper(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env) {
        <span style="color: #4ec9b0;">Ok</span>((pair, value)) =&gt; {
            <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">new_pair</span> = <span style="color: #4ec9b0;">Maj</span>::cons(maj_car(pair.clone()), value);
            <span style="color: #f16969; background-color: #252526;">unsafe</span> {
                <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">rawpair</span> = <span style="color: #4ec9b0;">Gc</span>::into_raw(pair.clone());
                <span style="color: #569cd6;">std</span>::<span style="color: #569cd6;">ptr</span>::copy_nonoverlapping(
                    <span style="color: #4ec9b0;">Gc</span>::into_raw(new_pair.clone()),
                    rawpair <span style="color: #569cd6;">as</span> *<span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">Maj</span>, 1);
            }
            pair
        },
        <span style="color: #4ec9b0;">Err</span>(error) =&gt; error,
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org27f7133" class="outline-3">
<h3 id="org27f7133"><span class="section-number-3">3.6.</span> Condicional (<code>if</code>)</h3>
<div class="outline-text-3" id="text-3-6">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_if</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>, <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">length</span> = maj_length(expr.clone())
        .to_integer().unwrap();
    <span style="color: #569cd6;">if</span> length != 4 {
        <span style="color: #569cd6;">return</span> maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Invalid syntax: {}"</span>),
            <span style="color: #c586c0;">maj_list!</span>(expr));
    }

    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">pred</span>   = maj_car(maj_cdr(expr.clone()));
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">conseq</span> = maj_car(maj_cdr(maj_cdr(expr.clone())));
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">altern</span> = maj_car(maj_cdr(maj_cdr(maj_cdr(expr))));
    
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">pred_result</span> = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, pred, env.clone());
    <span style="color: #569cd6;">if</span> maj_errorp(pred_result.clone()).to_bool() {
        pred_result
    } <span style="color: #569cd6;">else</span> {
        maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state,
                 <span style="color: #569cd6;">if</span> maj_nilp(pred_result).to_bool() {
                     altern
                 } <span style="color: #569cd6;">else</span> {
                     conseq
                 },
                 env)
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ad651f" class="outline-3">
<h3 id="org8ad651f"><span class="section-number-3">3.7.</span> Forma <code>fn</code></h3>
<div class="outline-text-3" id="text-3-7">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_fn</span>(<span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">length</span> = maj_length(expr.clone())
        .to_integer().unwrap();
    <span style="color: #569cd6;">if</span> length &lt; 3 {
        <span style="color: #569cd6;">return</span> maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Invalid syntax: {}"</span>),
            <span style="color: #c586c0;">maj_list!</span>(expr));
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">(fn lambda-list . body)</span>
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">lambda_list</span> = maj_car(maj_cdr(expr.clone()));
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">body</span> = maj_cdr(maj_cdr(expr));

    <span style="color: #569cd6;">if</span> maj_errorp(lambda_list.clone()).to_bool() {
        lambda_list
    } <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_errorp(body.clone()).to_bool() {
        body
    } <span style="color: #569cd6;">else</span> {
        <span style="color: #6a9955;">// </span><span style="color: #6a9955;">(lit closure &lt;env&gt; &lt;lambda-list&gt; ((&lt;body&gt;)))</span>
        <span style="color: #c586c0;">maj_list!</span>(<span style="color: #4ec9b0;">Maj</span>::lit(),
                  <span style="color: #4ec9b0;">Maj</span>::closure(),
                  env, lambda_list, body)
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7eb9019" class="outline-3">
<h3 id="org7eb9019"><span class="section-number-3">3.8.</span> Forma <code>mac</code></h3>
<div class="outline-text-3" id="text-3-8">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_mac</span>(<span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">length</span> = maj_length(expr.clone())
        .to_integer().unwrap();
    <span style="color: #569cd6;">if</span> length &lt; 3 {
        <span style="color: #569cd6;">return</span> maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Invalid syntax: {}"</span>),
            <span style="color: #c586c0;">maj_list!</span>(expr));
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">(mac lambda-list . body)</span>
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">lambda_list</span> = maj_car(maj_cdr(expr.clone()));
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">body</span> = maj_cdr(maj_cdr(expr));

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">(lit macro (lit closure &lt;env&gt; lambda-list (body)))</span>
    <span style="color: #c586c0;">maj_list!</span>(<span style="color: #4ec9b0;">Maj</span>::lit(),
              <span style="color: #4ec9b0;">Maj</span>::macro_sym(),
              <span style="color: #c586c0;">maj_list!</span>(
                  <span style="color: #4ec9b0;">Maj</span>::lit(),
                  <span style="color: #4ec9b0;">Maj</span>::closure(),
                  env, lambda_list, body))
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orged12c93" class="outline-3">
<h3 id="orged12c93"><span class="section-number-3">3.9.</span> Forma <code>do</code></h3>
<div class="outline-text-3" id="text-3-9">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_do</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>, <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">itr</span>    = maj_cdr(expr.clone());
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">result</span> = <span style="color: #4ec9b0;">Maj</span>::nil();
    <span style="color: #569cd6;">while</span> !maj_nilp(itr.clone()).to_bool() {
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">expr</span> = maj_car(itr.clone());
        result = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, expr, env.clone());
        <span style="color: #569cd6;">if</span> maj_errorp(result.clone()).to_bool() {
            <span style="color: #569cd6;">return</span> result;
        }
        itr = maj_cdr(itr.clone());
    }
    result
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org977797c" class="outline-3">
<h3 id="org977797c"><span class="section-number-3">3.10.</span> Forma <code>apply</code></h3>
<div class="outline-text-3" id="text-3-10">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_apply</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>, <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">length</span> = maj_length(expr.clone())
        .to_integer().unwrap();
    <span style="color: #569cd6;">if</span> length != 3 {
        <span style="color: #569cd6;">return</span> maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Invalid syntax: {}"</span>),
            <span style="color: #c586c0;">maj_list!</span>(expr));
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">(apply fun args) -&gt; (eval (cons fun args))</span>
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">func</span> = maj_car(maj_cdr(expr.clone()));
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">args</span> = maj_car(maj_cdr(maj_cdr(expr)));

    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">func</span> = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, func, env.clone());
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">args</span> = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, args, env.clone());

    <span style="color: #569cd6;">if</span> maj_errorp(func.clone()).to_bool() {
        func
    } <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_macrop(func.clone()).to_bool()
        || maj_macp(func.clone()).to_bool()
    {
        maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Macros cannot be applied"</span>),
            <span style="color: #4ec9b0;">Maj</span>::nil())
    } <span style="color: #569cd6;">else</span> <span style="color: #569cd6;">if</span> maj_errorp(args.clone()).to_bool() {
        args
    } <span style="color: #569cd6;">else</span> {
        maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, <span style="color: #4ec9b0;">Maj</span>::cons(func, args), env)
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ad330a" class="outline-3">
<h3 id="org6ad330a"><span class="section-number-3">3.11.</span> Forma <code>letrec</code></h3>
<div class="outline-text-3" id="text-3-11">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_letrec</span>(
    <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
    <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;,
    <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;
) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">axioms</span>::<span style="color: #569cd6;">predicates</span>::maj_consp;
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">length</span> = maj_length(expr.clone())
        .to_integer().unwrap();
    <span style="color: #569cd6;">if</span> length &lt; 3 {
        <span style="color: #569cd6;">return</span> maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Invalid syntax: {}"</span>),
            <span style="color: #c586c0;">maj_list!</span>(expr));
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">(letrec bindings . body)</span>
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">bindings</span> = maj_car(maj_cdr(expr.clone()));
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">body</span>     = maj_cdr(maj_cdr(expr.clone()));

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">Implicit `do`</span>
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">body</span> = <span style="color: #4ec9b0;">Maj</span>::cons(<span style="color: #4ec9b0;">Maj</span>::do_sym(), body);

    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">fnnames</span>  = <span style="color: #c586c0;">vec!</span>[];
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">fns</span>      = <span style="color: #c586c0;">vec!</span>[];
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">iter</span> = bindings.clone();
    <span style="color: #569cd6;">while</span> !maj_nilp(iter.clone()).to_bool() {
        <span style="color: #6a9955;">// </span><span style="color: #6a9955;">(sym lambda-list . body)</span>
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">clause</span> = maj_car(iter.clone());
        <span style="color: #569cd6;">if</span> !maj_consp(clause.clone()).to_bool() {
            <span style="color: #569cd6;">return</span> maj_err(<span style="color: #4ec9b0;">Maj</span>::string(
                <span style="color: #ce9178;">"Syntax error on letrec: {} is not a proper clause"</span>),
                <span style="color: #c586c0;">maj_list!</span>(clause));
        }

        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">sym</span> = maj_car(clause.clone());
        <span style="color: #569cd6;">if</span> !maj_symbolp(sym.clone()).to_bool() {
            <span style="color: #569cd6;">return</span> maj_err(<span style="color: #4ec9b0;">Maj</span>::string(
                <span style="color: #ce9178;">"Syntax error on letrec: {} is not a valid function name"</span>),
                <span style="color: #c586c0;">maj_list!</span>(sym));
        }

        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">function</span> = <span style="color: #4ec9b0;">Maj</span>::cons(
            <span style="color: #4ec9b0;">Maj</span>::fn_sym(),
            maj_cdr(clause));

        fnnames.push(sym);
        fns.push(function);

        iter = maj_cdr(iter);
    }

    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">closures</span> = <span style="color: #c586c0;">vec!</span>[];
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">iterate over fns, interpreting, putting results in closures</span>
    <span style="color: #569cd6;">for</span> <span style="color: #9cdcfe;">function</span> <span style="color: #569cd6;">in</span> fns.iter() {
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">closure</span> = maj_eval(
            <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state,
            function.clone(),
            env.clone());
        <span style="color: #569cd6;">if</span> maj_errorp(closure.clone()).to_bool() {
            <span style="color: #569cd6;">return</span> closure;
        }
        closures.push(closure);
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">iterate over fnnames and closures, creating an env.</span>
    <span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">core</span>::<span style="color: #569cd6;">environment</span>::maj_env_push;
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">new_env</span> = <span style="color: #4ec9b0;">Maj</span>::nil();
    <span style="color: #569cd6;">for</span> <span style="color: #9cdcfe;">i</span> <span style="color: #569cd6;">in</span> 0..closures.len() {
        new_env = maj_env_push(new_env,
                               fnnames[i].clone(),
                               closures[i].clone());
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">append new_env to env.</span>
    <span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">core</span>::<span style="color: #569cd6;">environment</span>::maj_env_union;
    new_env = maj_env_union(new_env, env.clone());

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">for each closure, inject this new environment</span>
    <span style="color: #569cd6;">for</span> <span style="color: #9cdcfe;">closure</span> <span style="color: #569cd6;">in</span> closures.iter() {
        <span style="color: #6a9955;">// </span><span style="color: #6a9955;">(lit closure &lt;env&gt; &lt;ll&gt; . &lt;body&gt;)</span>
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">clorest</span> = maj_cdr(maj_cdr(closure.clone()));
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">clobody</span> = maj_cdr(clorest.clone());
        
        <span style="color: #6a9955;">// </span><span style="color: #6a9955;">modify car of clobody</span>
        <span style="color: #f16969; background-color: #252526;">unsafe</span> {
            <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">rawclorest</span> = <span style="color: #4ec9b0;">Gc</span>::into_raw(clorest.clone());
            <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">newcons</span> = <span style="color: #4ec9b0;">Maj</span>::cons(new_env.clone(), clobody);
            <span style="color: #569cd6;">std</span>::<span style="color: #569cd6;">ptr</span>::copy_nonoverlapping(
                <span style="color: #4ec9b0;">Gc</span>::into_raw(newcons.clone()),
                rawclorest <span style="color: #569cd6;">as</span> *<span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">Maj</span>, 1);
        }
    }
    maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, body, new_env)
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5610a20" class="outline-3">
<h3 id="org5610a20"><span class="section-number-3">3.12.</span> Forma <code>while</code></h3>
<div class="outline-text-3" id="text-3-12">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_while</span>(
    <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
    <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;,
    <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;
) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">(while pred . body)</span>
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">length</span> = maj_length(expr.clone())
        .to_integer().unwrap();
    <span style="color: #569cd6;">if</span> length &lt; 2 {
        <span style="color: #569cd6;">return</span> maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Invalid syntax: {}"</span>),
            <span style="color: #c586c0;">maj_list!</span>(expr));
    }

    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">pred</span> = maj_car(maj_cdr(expr.clone()));
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">body</span> = maj_cdr(maj_cdr(expr));
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">body</span> = <span style="color: #4ec9b0;">Maj</span>::cons(<span style="color: #4ec9b0;">Maj</span>::do_sym(), body);

    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">body_result</span> = <span style="color: #4ec9b0;">Maj</span>::nil();
    <span style="color: #569cd6;">loop</span> {
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">pred_result</span> = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state,
                                   pred.clone(),
                                   env.clone());
        <span style="color: #569cd6;">if</span> maj_errorp(pred_result.clone()).to_bool() {
            <span style="color: #569cd6;">return</span> pred_result;
        }
        <span style="color: #569cd6;">if</span> !pred_result.to_bool() {
            <span style="color: #569cd6;">break</span>;
        }
        body_result = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state,
                               body.clone(),
                               env.clone());
        <span style="color: #569cd6;">if</span> maj_errorp(body_result.clone()).to_bool() {
            <span style="color: #569cd6;">return</span> body_result;
        }
    }
    body_result
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org39c7cb8" class="outline-3">
<h3 id="org39c7cb8"><span class="section-number-3">3.13.</span> Forma <code>unwind-protect</code></h3>
<div class="outline-text-3" id="text-3-13">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_unwind_protect</span>(
    <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
    <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;,
    <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;
) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">(unwind-protect expr cleanup)</span>
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">length</span> = maj_length(expr.clone())
        .to_integer().unwrap();
    <span style="color: #569cd6;">if</span> length != 3 {
        <span style="color: #569cd6;">return</span> maj_err(
            <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"Invalid syntax: {}"</span>),
            <span style="color: #c586c0;">maj_list!</span>(expr));
    }

    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">exp</span>     = maj_car(maj_cdr(expr.clone()));
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">cleanup</span> = maj_car(maj_cdr(maj_cdr(expr)));

    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">result</span> = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, exp, env.clone());
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">_</span>      = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, cleanup, env);
    result
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d01ce5" class="outline-3">
<h3 id="org3d01ce5"><span class="section-number-3">3.14.</span> Formas lógicas</h3>
<div class="outline-text-3" id="text-3-14">
</div>
<div id="outline-container-orgd59f15f" class="outline-4">
<h4 id="orgd59f15f"><span class="section-number-4">3.14.1.</span> <code>and</code></h4>
<div class="outline-text-4" id="text-3-14-1">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_and</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>, <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">forms</span> = maj_cdr(expr);
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">iter</span> = forms;
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">result</span> = <span style="color: #4ec9b0;">Maj</span>::t();
    <span style="color: #569cd6;">while</span> !maj_nilp(iter.clone()).to_bool() {
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">form</span> = maj_car(iter.clone());
        result = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, form, env.clone());
        <span style="color: #569cd6;">if</span> maj_nilp(result.clone()).to_bool() {
            <span style="color: #569cd6;">return</span> <span style="color: #4ec9b0;">Maj</span>::nil();
        }
        iter = maj_cdr(iter.clone());
    }
    result
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc39c63" class="outline-4">
<h4 id="orgfc39c63"><span class="section-number-4">3.14.2.</span> <code>or</code></h4>
<div class="outline-text-4" id="text-3-14-2">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_handle_or</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>, <span style="color: #9cdcfe;">expr</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">forms</span> = maj_cdr(expr);
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">iter</span> = forms;
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">result</span> = <span style="color: #4ec9b0;">Maj</span>::nil();
    <span style="color: #569cd6;">while</span> !maj_nilp(iter.clone()).to_bool() {
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">form</span> = maj_car(iter.clone());
        result = maj_eval(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, form, env.clone());
        <span style="color: #569cd6;">if</span> !maj_nilp(result.clone()).to_bool() {
            <span style="color: #569cd6;">return</span> result;
        }
        iter = maj_cdr(iter.clone());
    }
    result
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc7f3cec" class="outline-2">
<h2 id="orgc7f3cec"><span class="section-number-2">4.</span> Predicados auxiliares</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_is_selfeval</span>(<span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">bool</span> {
    maj_literalp(x.clone()).to_bool()
        || maj_nilp(x.clone()).to_bool()
        || maj_eq(x.clone(), <span style="color: #4ec9b0;">Maj</span>::t()).to_bool()
        || maj_eq(x.clone(), <span style="color: #4ec9b0;">Maj</span>::ampersand()).to_bool()
        || maj_eq(x.clone(), <span style="color: #4ec9b0;">Maj</span>::apply()).to_bool()
        || maj_numberp(x.clone()).to_bool()
        || maj_charp(x.clone()).to_bool()
        || maj_streamp(x.clone()).to_bool()
        || maj_stringp(x.clone()).to_bool()
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">pub</span> <span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_quotep</span>(<span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    maj_eq(maj_car(x), <span style="color: #4ec9b0;">Maj</span>::quote())
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">pub</span> <span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_quasiquotep</span>(<span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    maj_eq(maj_car(x), <span style="color: #4ec9b0;">Maj</span>::quasiquote())
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">pub</span> <span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_unquotep</span>(<span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    maj_eq(maj_car(x), <span style="color: #4ec9b0;">Maj</span>::unquote())
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">pub</span> <span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_unquote_splice_p</span>(<span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    maj_eq(maj_car(x), <span style="color: #4ec9b0;">Maj</span>::unquote_splice())
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_defp</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
            <span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car</span> = maj_car(x);
    maj_eq(car, <span style="color: #4ec9b0;">Maj</span>::symbol(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, <span style="color: #ce9178;">"def"</span>))
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_setp</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
            <span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car</span> = maj_car(x);
    maj_eq(car, <span style="color: #4ec9b0;">Maj</span>::symbol(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, <span style="color: #ce9178;">"set"</span>))
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_set_car_p</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
            <span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car</span> = maj_car(x);
    maj_eq(car, <span style="color: #4ec9b0;">Maj</span>::symbol(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, <span style="color: #ce9178;">"set-car"</span>))
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_set_cdr_p</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
            <span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car</span> = maj_car(x);
    maj_eq(car, <span style="color: #4ec9b0;">Maj</span>::symbol(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, <span style="color: #ce9178;">"set-cdr"</span>))
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_dop</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
           <span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car</span> = maj_car(x);
    maj_eq(car, <span style="color: #4ec9b0;">Maj</span>::symbol(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, <span style="color: #ce9178;">"do"</span>))
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_andp</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
            <span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car</span> = maj_car(x);
    maj_eq(car, <span style="color: #4ec9b0;">Maj</span>::symbol(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, <span style="color: #ce9178;">"and"</span>))
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_orp</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
            <span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car</span> = maj_car(x);
    maj_eq(car, <span style="color: #4ec9b0;">Maj</span>::symbol(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, <span style="color: #ce9178;">"or"</span>))
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_ifp</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
           <span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car</span> = maj_car(x);
    maj_eq(car, <span style="color: #4ec9b0;">Maj</span>::symbol(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, <span style="color: #ce9178;">"if"</span>))
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #c586c0;">#[inline]</span>
<span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_fnp</span>(<span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    maj_eq(maj_car(x), <span style="color: #4ec9b0;">Maj</span>::fn_sym())
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #c586c0;">#[inline]</span>
<span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_applyp</span>(<span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    maj_eq(maj_car(x), <span style="color: #4ec9b0;">Maj</span>::apply())
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_whilep</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
              <span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car</span> = maj_car(x);
    maj_eq(car, <span style="color: #4ec9b0;">Maj</span>::symbol(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, <span style="color: #ce9178;">"while"</span>))
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #c586c0;">#[inline]</span>
<span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_macp</span>(<span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    maj_eq(maj_car(x), <span style="color: #4ec9b0;">Maj</span>::mac())
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #c586c0;">#[inline]</span>
<span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_letrecp</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
               <span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car</span> = maj_car(x);
    maj_eq(car, <span style="color: #4ec9b0;">Maj</span>::symbol(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, <span style="color: #ce9178;">"letrec"</span>))
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #c586c0;">#[inline]</span>
<span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_unwind_protect_p</span>(<span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">state</span>: <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> <span style="color: #4ec9b0;">MajState</span>,
                        <span style="color: #9cdcfe;">x</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">car</span> = maj_car(x);
    maj_eq(car, <span style="color: #4ec9b0;">Maj</span>::symbol(<span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span><span style="color: #569cd6;">mut</span> state, <span style="color: #ce9178;">"unwind-protect"</span>))
}
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Lucas S. Vieira</p>
<p class="date">Created: 2022-10-24 seg 00:27</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
