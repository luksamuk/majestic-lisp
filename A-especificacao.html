<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt-br" xml:lang="pt-br">
<head>
<!-- 2022-10-24 seg 00:27 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Apêndice A: Especificação do Majestic Lisp</title>
<meta name="author" content="Lucas S. Vieira Lucas S. Vieira" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="./main.css" />
<link rel="stylesheet" type="text/css" href="./syntax.css" />
<link id="theme-css" rel="stylesheet" type="text/css" href="./dark-theme.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:image" content="../img/cat-i-mage.jpg">
<meta name="theme-color" content="#14171e">
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">Apêndice A: Especificação do Majestic Lisp</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgf545baa">1. Introdução</a>
<ul>
<li><a href="#orgeda13c5">1.1. Como ler este documento</a></li>
</ul>
</li>
<li><a href="#orga33e660">2. Dados</a>
<ul>
<li><a href="#orga8bf4e4">2.1. Símbolos</a></li>
<li><a href="#orgec271e6">2.2. Células <i>cons</i></a></li>
<li><a href="#org7900322">2.3. Caracteres</a></li>
<li><a href="#orgfc078c3">2.4. Streams</a></li>
<li><a href="#org0aca157">2.5. Números</a>
<ul>
<li><a href="#orgc3a1107">2.5.1. Inteiros</a></li>
<li><a href="#org8bca179">2.5.2. Frações</a></li>
<li><a href="#org79020de">2.5.3. Pontos flutuantes</a></li>
<li><a href="#org0d094f6">2.5.4. Complexos</a></li>
<li><a href="#org2cd2e1d">2.5.5. Coerções entre subtipos numéricos</a></li>
</ul>
</li>
<li><a href="#org7292e14">2.6. Dados atômicos e objetos</a></li>
</ul>
</li>
<li><a href="#org28b0d79">3. Listas</a>
<ul>
<li><a href="#org423d3a0">3.1. <span class="todo TODO">TODO</span> Listas pontuadas</a></li>
<li><a href="#orge1c225a">3.2. Listas adequadas</a></li>
<li><a href="#org82eb180">3.3. Notação abreviada de listas</a></li>
<li><a href="#org7e7cb8e">3.4. <span class="todo TODO">TODO</span> Listas associativas</a></li>
</ul>
</li>
<li><a href="#org46afd29">4. <span class="todo TODO">TODO</span> Vetores</a>
<ul>
<li><a href="#org12c929e">4.1. Notação de vetores</a></li>
<li><a href="#orgc6f2300">4.2. Tipo de um vetor</a>
<ul>
<li><a href="#orgbcf942a">4.2.1. Vetor de números inteiros</a></li>
<li><a href="#orge663bdf">4.2.2. Vetor de pontos flutuantes</a></li>
<li><a href="#org34b8a18">4.2.3. Vetor de caracteres</a></li>
<li><a href="#org1cf6abd">4.2.4. Vetor de qualquer tipo (Any)</a></li>
</ul>
</li>
<li><a href="#orgcaf69e7">4.3. <span class="todo TODO">TODO</span> Coerção entre tipos de vetores</a></li>
<li><a href="#org41b05fe">4.4. Strings</a>
<ul>
<li><a href="#org8e99eb3">4.4.1. Notação abreviada de strings</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2a7cf6c">5. Valores-verdade</a></li>
<li><a href="#org6e8d6e0">6. Funções</a>
<ul>
<li><a href="#org2b67136">6.1. Representação de clausuras</a></li>
<li><a href="#org88f1a0b">6.2. Representação alternativa de clausuras</a></li>
</ul>
</li>
<li><a href="#orge7599b4">7. Macros</a>
<ul>
<li><a href="#org6175448">7.1. Representação</a></li>
<li><a href="#org11630b4">7.2. Representação alternativa</a></li>
</ul>
</li>
<li><a href="#org3d174e9">8. Interpretação</a>
<ul>
<li><a href="#orge2a4111">8.1. Resultados de uma interpretação</a></li>
<li><a href="#org934385e">8.2. Chamadas de funções</a></li>
<li><a href="#org3199dfb">8.3. Formas especiais</a></li>
<li><a href="#org8f08237">8.4. <span class="todo TODO">TODO</span> Escopo</a></li>
</ul>
</li>
<li><a href="#orgde6bcf8">9. Ligações e Contextos</a>
<ul>
<li><a href="#orga4c904a">9.1. Ligações globais</a></li>
<li><a href="#org84f3467">9.2. Ligações léxicas ou estáticas</a></li>
<li><a href="#org448edc4">9.3. Ligações dinâmicas</a></li>
<li><a href="#orga5ff9f8">9.4. Mutabilidade</a></li>
</ul>
</li>
<li><a href="#org6064364">10. Erros</a></li>
<li><a href="#org8ba35d6">11. Axiomas</a>
<ul>
<li><a href="#org7398c10">11.1. Variáveis e constantes</a>
<ul>
<li><a href="#orgaa45278">11.1.1. Símbolos auto-interpretáveis</a></li>
<li><a href="#org53ad12f">11.1.2. Caracteres</a></li>
<li><a href="#orgdce789d">11.1.3. Números</a></li>
<li><a href="#org0f91f7c">11.1.4. Constantes globais</a></li>
</ul>
</li>
<li><a href="#org52409f7">11.2. Quote</a></li>
<li><a href="#orgf04cd8e">11.3. Funções Primitivas</a>
<ul>
<li><a href="#orgc8de040">11.3.1. Convenções</a></li>
<li><a href="#org4ae11eb">11.3.2. <code>(symbolp x)</code></a></li>
<li><a href="#org7b53e1e">11.3.3. <code>(eq x y)</code></a></li>
<li><a href="#org60e8471">11.3.4. <code>(nilp x)</code></a></li>
<li><a href="#org1cd6160">11.3.5. <code>(consp x)</code></a></li>
<li><a href="#org872a8b7">11.3.6. <code>(atomp x)</code></a></li>
<li><a href="#orgfd7d30f">11.3.7. <code>(charp x)</code></a></li>
<li><a href="#org58911f1">11.3.8. <code>(char= x y)</code></a></li>
<li><a href="#org9578239">11.3.9. <code>(streamp x)</code></a></li>
<li><a href="#org44a74d1">11.3.10. <code>(numberp x)</code></a></li>
<li><a href="#orgca253f5">11.3.11. <code>(vectorp x)</code></a></li>
<li><a href="#org1e83056">11.3.12. <code>(id x y)</code></a></li>
<li><a href="#org9c0522d">11.3.13. <code>(proper-list-p x)</code></a></li>
<li><a href="#org6de9649">11.3.14. <code>(stringp x)</code></a></li>
<li><a href="#orgc6bf322">11.3.15. <code>(literalp x)</code></a></li>
<li><a href="#org82f6c4e">11.3.16. <code>(primitivep x)</code></a></li>
<li><a href="#orgc1beee0">11.3.17. <code>(closurep x)</code></a></li>
<li><a href="#org93c8e44">11.3.18. <code>(functionp x)</code></a></li>
<li><a href="#org668ddeb">11.3.19. <code>(macrop x)</code></a></li>
<li><a href="#orgf69c3a8">11.3.20. <code>(errorp x)</code></a></li>
<li><a href="#org032b9a0">11.3.21. <code>(cons x y)</code></a></li>
<li><a href="#org6c04c37">11.3.22. <code>(car x)</code></a></li>
<li><a href="#org5a0b28f">11.3.23. <code>(cdr x)</code></a></li>
<li><a href="#orgc24a07a">11.3.24. <code>(copy x)</code></a></li>
<li><a href="#orgb565c52">11.3.25. <code>(length x)</code></a></li>
<li><a href="#orga57edce">11.3.26. <code>(depth x)</code></a></li>
<li><a href="#org965085e">11.3.27. <code>(type x)</code></a></li>
<li><a href="#org30cbb4e">11.3.28. <code>(intern x)</code></a></li>
<li><a href="#orgfb4b9e2">11.3.29. <code>(name x)</code></a></li>
<li><a href="#org1b38ffe">11.3.30. <code>(get-environment type)</code></a></li>
<li><a href="#org5f859ae">11.3.31. <code>(coin)</code></a></li>
<li><a href="#org08da3d4">11.3.32. <code>(sys com . args)</code></a></li>
<li><a href="#org3e975ff">11.3.33. <code>(format fmt . rest)</code></a></li>
<li><a href="#orgfa75b1c">11.3.34. <code>(err fmt . rest)</code></a></li>
<li><a href="#org430f544">11.3.35. <code>(warn fmt . rest)</code></a></li>
<li><a href="#org5b5ea5c">11.3.36. <code>(list . rest)</code></a></li>
<li><a href="#org925d662">11.3.37. <code>(append . rest)</code></a></li>
<li><a href="#orga04122d">11.3.38. <code>(last x)</code></a></li>
<li><a href="#orgb89e7b5">11.3.39. <code>(reverse x)</code></a></li>
<li><a href="#orge43f4bf">11.3.40. <code>(nthcdr n lst)</code></a></li>
<li><a href="#orgaa09a6f">11.3.41. <code>(nth n lst)</code></a></li>
<li><a href="#orga0dc269">11.3.42. <code>(macroexpand-1 x)</code></a></li>
<li><a href="#orgb215998">11.3.43. <code>(not x)</code></a></li>
<li><a href="#orgf2c7c6f">11.3.44. <code>(gensym)</code></a></li>
<li><a href="#org2c9db82">11.3.45. <code>(terpri)</code></a></li>
<li><a href="#orgcc46024">11.3.46. <code>(display x)</code></a></li>
<li><a href="#org7d9f96a">11.3.47. <span class="todo TODO">TODO</span> <code>(pretty-display x)</code></a></li>
<li><a href="#orgdb64f9b">11.3.48. <code>(print fmt . rest)</code></a></li>
<li><a href="#org0d0ce2f">11.3.49. <code>(load path)</code></a></li>
<li><a href="#orgfb71f3e">11.3.50. <code>(equal x y)</code></a></li>
</ul>
</li>
<li><a href="#orgcf94c15">11.4. Funções para vetores</a>
<ul>
<li><a href="#org5edfd85">11.4.1. <code>(vector . rest)</code></a></li>
<li><a href="#org54f5896">11.4.2. <code>(vec-type vec)</code></a></li>
<li><a href="#org0905ffa">11.4.3. <code>(vec-coerce type vec)</code></a></li>
<li><a href="#org06a8caf">11.4.4. <code>(vec-push x vec)</code></a></li>
<li><a href="#orgd0c7eec">11.4.5. <code>(vec-set pos x vec)</code></a></li>
<li><a href="#org45ac863">11.4.6. <code>(vec-pop vec)</code></a></li>
<li><a href="#orgd682da6">11.4.7. <code>(vec-deq vec)</code></a></li>
<li><a href="#orgafbc6dd">11.4.8. <code>(vec-length vec)</code></a></li>
<li><a href="#orgb7aa2db">11.4.9. <code>(vec-at pos vec)</code></a></li>
<li><a href="#org6ea599a">11.4.10. <code>(vec-remove pos vec)</code></a></li>
<li><a href="#orgce92312">11.4.11. <code>(vec-insert pos x vec)</code></a></li>
<li><a href="#org502ddc2">11.4.12. <code>(vector= va vb)</code></a></li>
</ul>
</li>
<li><a href="#org4f7b926">11.5. Funções numéricas</a>
<ul>
<li><a href="#org3fe7e73">11.5.1. Coerção e extração de elementos</a></li>
<li><a href="#org18da30a">11.5.2. Operações aritméticas</a></li>
<li><a href="#org6699b74">11.5.3. Miscelânea</a></li>
</ul>
</li>
<li><a href="#orgca17dce">11.6. <span class="todo TODO">TODO</span> Operações de comparação</a>
<ul>
<li><a href="#org07f161d">11.6.1. <code>(= x y . rest)</code></a></li>
<li><a href="#orgf67bf6c">11.6.2. <code>(float= x y)</code></a></li>
<li><a href="#orgff8cf3d">11.6.3. <code>(&gt; x y . rest)</code></a></li>
<li><a href="#org859b05a">11.6.4. <code>(&lt; x y . rest)</code></a></li>
<li><a href="#orgcc26525">11.6.5. <code>(&gt;= x y . rest)</code></a></li>
<li><a href="#orge7b18b3">11.6.6. <code>(&lt;= x y . rest)</code></a></li>
</ul>
</li>
<li><a href="#org1900003">11.7. <span class="todo TODO">TODO</span> Funções de streams</a>
<ul>
<li><a href="#org49006eb">11.7.1. Abertura, fechamento e status de streams</a></li>
<li><a href="#org5f74711">11.7.2. <span class="todo TODO">TODO</span> Leitura e escrita em streams</a></li>
</ul>
</li>
<li><a href="#orge549ebd">11.8. <span class="todo TODO">TODO</span> Formas Especiais</a>
<ul>
<li><a href="#orgbf4e46d">11.8.1. <code>(quote x)</code></a></li>
<li><a href="#org535dfd5">11.8.2. <code>(def sym val)</code></a></li>
<li><a href="#orgef8f555">11.8.3. <code>(set sym val)</code></a></li>
<li><a href="#org9312d62">11.8.4. <code>(set-car x val)</code></a></li>
<li><a href="#orgfc7b2ac">11.8.5. <code>(set-cdr x val)</code></a></li>
<li><a href="#org32a89e2">11.8.6. <code>(if pred conseq altern)</code></a></li>
<li><a href="#org4c27129">11.8.7. <code>(fn lambda-list . body)</code></a></li>
<li><a href="#org98fe1ff">11.8.8. <code>(mac lambda-list . body)</code></a></li>
<li><a href="#org84551ca">11.8.9. <code>(quasiquote x)</code>, <code>(unquote x)</code>, <code>(unquote-splice x)</code></a></li>
<li><a href="#org726a052">11.8.10. <code>(do . rest)</code></a></li>
<li><a href="#org08f2467">11.8.11. <span class="todo TODO">TODO</span> <code>(apply fun args)</code></a></li>
<li><a href="#org60aa373">11.8.12. <code>(while pred . body)</code></a></li>
<li><a href="#orgc06bf0f">11.8.13. <code>(and . rest)</code></a></li>
<li><a href="#org3664058">11.8.14. <code>(or . rest)</code></a></li>
<li><a href="#org72c097c">11.8.15. <code>(letrec bindings . body)</code></a></li>
<li><a href="#org0190fba">11.8.16. <code>(unwind-protect expr cleanup)</code></a></li>
</ul>
</li>
<li><a href="#orgb5f4b07">11.9. Macros do leitor de expressões</a>
<ul>
<li><a href="#org30f5a4a">11.9.1. Quote (<code>'</code>)</a></li>
<li><a href="#org3a26282">11.9.2. Quasiquote (<code>`</code>)</a></li>
<li><a href="#orgc8e55aa">11.9.3. Unquote (<code>,</code>)</a></li>
<li><a href="#org98bb2e3">11.9.4. Unquote-Splice (<code>,@</code>)</a></li>
<li><a href="#orgc471081">11.9.5. Sintaxe de vetores (<code>[ ]</code>)</a></li>
</ul>
</li>
<li><a href="#org52f4cd2">11.10. Macros</a>
<ul>
<li><a href="#org7233547">11.10.1. <code>(cond . clauses)</code></a></li>
<li><a href="#org599a342">11.10.2. <code>(defn name lambda-list . body)</code></a></li>
<li><a href="#orgc6d426c">11.10.3. <code>(defmac name lambda-list . body)</code></a></li>
<li><a href="#orgfefcf05">11.10.4. <code>(let bindings . body)</code></a></li>
<li><a href="#orgbe7d3d7">11.10.5. <code>(let* bindings . body)</code></a></li>
<li><a href="#org17ee99e">11.10.6. <code>(letfn bindings . body)</code></a></li>
<li><a href="#org838ea11">11.10.7. <code>(letfn* bindings . body)</code></a></li>
<li><a href="#orgda5580b">11.10.8. <code>(when pred . body)</code></a></li>
<li><a href="#org1a0e476">11.10.9. <code>(unless pred . body)</code></a></li>
<li><a href="#org670696f">11.10.10. <code>(until pred . body)</code></a></li>
<li><a href="#orgdeb3349">11.10.11. <code>(repeat n . body)</code></a></li>
<li><a href="#orgd94da1b">11.10.12. <code>(with-open-stream (sym dir file) . body)</code></a></li>
<li><a href="#org34d9724">11.10.13. <span class="todo TODO">TODO</span> Variações de <code>car</code> e <code>cdr</code></a></li>
</ul>
</li>
<li><a href="#orgf055758">11.11. <span class="todo TODO">TODO</span> Miscelânea</a>
<ul>
<li><a href="#orga8c1eee">11.11.1. <code>(map f (x . xs))</code></a></li>
<li><a href="#org234110e">11.11.2. <code>(mapc f (x . xs))</code></a></li>
<li><a href="#orgfedb551">11.11.3. <code>(assp proc (x . xs))</code></a></li>
<li><a href="#org1cfcc3d">11.11.4. <code>(assoc sym alist)</code></a></li>
<li><a href="#orgeeb099a">11.11.5. <code>(member elt lst)</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga8fef64">12. <span class="todo TODO">TODO</span> Aplicação</a>
<ul>
<li><a href="#org2c88f13">12.1. Aplicação de clausuras</a></li>
<li><a href="#orgcfb87d1">12.2. Aplicação de primitivas</a></li>
<li><a href="#orga8ca59a">12.3. Aplicação de macros</a></li>
</ul>
</li>
<li><a href="#org12ee3f1">13. <span class="todo TODO">TODO</span> Interpretação</a></li>
</ul>
</div>
</div>
<p>
Este apêndice inclui  a especificação da linguagem  Majestic Lisp. Ele
poderá  ser utilizado  para  consultas mais  profundas relacionadas  à
implementação e execução de elementos da linguagem.
</p>

<ul class="org-ul">
<li>Data de criação: <span class="timestamp-wrapper"><span class="timestamp">&lt;2020-07-19 dom&gt;</span></span></li>
<li>Última atualização: <span class="timestamp-wrapper"><span class="timestamp">&lt;2021-05-17 seg 23:41&gt;</span></span></li>
</ul>

<div id="outline-container-orgf545baa" class="outline-2">
<h2 id="orgf545baa"><span class="section-number-2">1.</span> Introdução</h2>
<div class="outline-text-2" id="text-1">
<p>
Majestic  Lisp é  uma linguagem  de  programação, um  dialeto de  Lisp
construido   principalmente  para   propósitos  educacionais.   Ela  é
inspirada em  dialetos Lisp  como Bel, Common  Lisp e  Clojure. Também
recebe alguma  inspiração de outras  linguagens, como APL.  Majestic é
escrita como um <i>programa instruído</i><sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>,  em forma de livro, de forma
a possibilitar que leitores pudessem reimplementá-la e também aprender
a respeito da implementação de linguagens Lisp.
</p>

<p>
Os objetivos de Majestic Lisp são:
</p>

<ul class="org-ul">
<li>Prover  uma  linguagem  que  poderia  ter  propósitos  educacionais,
através de uma implementação didática.</li>
<li>Delegar performance em  favor de corretude, uma  vez que performance
não é um tópico central, ainda que desejada em alguns pontos.</li>
<li>Prover  um dialeto  simples  de  uma linguagem  Lisp,  de forma  que
programadores Lisp veteranos possam se sentir em casa ao usá-lo.</li>
<li>Mostrar que projetar e implementar  sua própria linguagem Lisp não é
uma tarefa intangível.</li>
<li>Prover uma linguagem  suficientemente simples para que,  mesmo que o
programador não possa  executar seu interpretador, ele  ou ela possa
ainda prever o resultado de uma interpretação algebricamente.</li>
</ul>

<p>
A especificação de Majestic Lisp  é vagamente baseada na especificação
de Bel, tomando  para si alguns fragmentos da  estrutura dessa segunda
linguagem, em doses  moderadas. O motivo para tal  está na recuperação
de um  modelo de interpretação primariamente  baseado no processamento
de  listas, e  utilizando  predominantemente  listas para  representar
alguns dos objetos complexos da linguagem.
</p>

<p>
Adicionalmente,  pertinência de  conceitos durante  a implementação  é
considerada  e, por  este motivo,  tem-se elementos  atômicos que  não
sejam representados como  listas, mas sim a partir  de dados atômicos,
como é o caso dos números.
</p>

<p>
Esta  especificação não  determina  um modelo  de memória  específico,
sendo  portanto  função do  programador  determinar  a pertinência  de
ideias  na  implementação  da   linguagem,  desde  que  mantenham  sua
corretude na execução.
</p>

<p>
As seções a seguir procuram descrever Majestic Lisp em profundidade, e
podem ser modificadas no curso de desenvolvimento da linguagem.
</p>
</div>

<div id="outline-container-orgeda13c5" class="outline-3">
<h3 id="orgeda13c5"><span class="section-number-3">1.1.</span> Como ler este documento</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Ao   longo  deste   documento,   toda  e   qualquer  demonstração   de
interpretação  de  um bloco  será  feita  através  de duas  linhas  de
exemplo:  na primeira,  prefixa-se o  bloco a  ser interpretado  com o
caractere <code>&gt;</code>.  Logo abaixo  da linha  final do bloco  em questão  a ser
interpretado, mostra-se o resultado esperado. Por exemplo:
</p>

<pre class="example" id="org020b74c">
&gt; (+ 2 3)
5
</pre>

<p>
Adicionalmente,  quando a  execução de  uma certa  expressão pressupõe
saída de texto  para o console, tal saída será  inserida entre o valor
de  retorno e  a  entrada do  usuário,  e prefixada  em  linhas com  o
caractere <code>;</code>, seguido de um espaço por linha de saída:
</p>

<pre class="example" id="org7b7824e">
&gt; (display "Hello world")
; Hello world
nil
</pre>

<p>
O  exemplo acima  demonstra uma  situação onde  a execução  do comando
imprime <code>Hello world</code> na tela, sem  uma quebra de linha ao final. Quando
ocorrer quebra  de linha,  esta será  indicada por  uma nova  linha de
saída, sendo todavia vazia:
</p>

<pre class="example" id="orgc22c376">
&gt; (print "Hello world")
; Hello world
;
nil
</pre>
</div>
</div>
</div>

<div id="outline-container-orga33e660" class="outline-2">
<h2 id="orga33e660"><span class="section-number-2">2.</span> Dados</h2>
<div class="outline-text-2" id="text-2">
<p>
Majestic  Lisp inicia  sua  construção  a partir  de  seus dados,  que
dividem-se em  cinco tipos fundamentais: <i>símbolos</i>,  <i>conses</i> (ou <i>células
cons</i>), <i>caracteres</i>, <i>streams</i> e <i>números</i>.
</p>
</div>

<div id="outline-container-orga8bf4e4" class="outline-3">
<h3 id="orga8bf4e4"><span class="section-number-3">2.1.</span> Símbolos</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Símbolos são  como palavras. Cada  símbolo representa um  elemento que
atua como rótulo, e que tem valor por si mesmo:
</p>

<pre class="example" id="org3273433">
foo
bar
baz
</pre>

<p>
Os nomes de  símbolos são sensíveis a maiúsculas  e minúsculas. Assim,
<code>foo</code> e <code>Foo</code> são símbolos distintos.
</p>

<p>
Alguns símbolos são auto-interpretáveis, sendo portanto classificáveis
como <i>rótulos para si mesmos</i>:
</p>

<pre class="example" id="org383c8ed">
t
nil
&amp;
apply
</pre>
</div>
</div>

<div id="outline-container-orgec271e6" class="outline-3">
<h3 id="orgec271e6"><span class="section-number-3">2.2.</span> Células <i>cons</i></h3>
<div class="outline-text-3" id="text-2-2">
<p>
Células  <i>cons</i> são  pares  de quaisquer  duas  coisas, representando  a
forma  mais  primitiva de  composição  de  elementos. Elas  podem  ser
textualmente representadas dessa forma:
</p>

<pre class="example" id="orgfe8cb0a">
(foo . bar)
</pre>

<p>
Este é  um <i>cons</i> de  dois símbolos, <code>foo</code>  e <code>bar</code>. Por  razões históricas,
podemos chamar a primeira metade do <i>cons</i> de <i>car</i>, e a segunda metade de
<i>cdr</i>.
</p>

<p>
As duas  metades dos pares  podem ser  quaisquer coisas, o  que também
inclui outras células <i>cons</i>:
</p>

<pre class="example" id="orgdf24230">
(foo . (bar . baz))
</pre>

<p>
Este é um <i>cons</i> entre o símbolo <code>foo</code> e o <i>cons</i> <code>(bar . baz)</code>.
</p>
</div>
</div>

<div id="outline-container-org7900322" class="outline-3">
<h3 id="org7900322"><span class="section-number-3">2.3.</span> Caracteres</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Um   caractere  é   representado   sempre  tendo   os  caracteres   de
<i>jogo-da-velha</i>  e  <i>backslash</i>   como  prefixos.  Assim,  a   letra  <code>a</code>  é
representada na forma:
</p>

<pre class="example" id="orgaf2a905">
#\a
</pre>

<p>
Caracteres que não  sejam letras podem possuir nomes  mais longos. Por
exemplo, o caractere de alerta (<i>bell</i>) pode ser representado como
</p>

<pre class="example" id="orga8f1d27">
#\bel
</pre>

<p>
Outros exemplos de caracteres com formas longas são:
</p>

<pre class="example" id="orgd754e4e">
#\tab
#\space
#\newline
</pre>
</div>
</div>

<div id="outline-container-orgfc078c3" class="outline-3">
<h3 id="orgfc078c3"><span class="section-number-3">2.4.</span> Streams</h3>
<div class="outline-text-3" id="text-2-4">
<p>
<i>Streams</i> são elementos primitivos  utilizados para interação envolvendo
entrada/saída na linguagem Majestic Lisp. De certa forma, <i>streams</i> agem
como           descritores          de           arquivo          (ver
<a href="silberschatz2015">p. 445</a>), no  âmbito do interpretador,
podendo  ser representados  como um  valor inteiro  que identifica  um
arquivo aberto pelo sistema.
</p>

<p>
Sua  função  é  prover  uma   abstração  básica  para  manipulação  de
informações  armazenadas em  memória  persistente, de  forma que  tais
informações  não precisem  estar todo  o tempo  na memória  volátil da
máquina.
</p>

<p>
As  idiossincrasias   de  abertura  desse  arquivo   (como  o  formato
identificador do caminho  para tal e outros  atributos) dizem respeito
ao sistema em execução, sendo  imperativo que possam ser representados
textualmente.  Por  exemplo,  em  um  sistema  Unix-like  onde  faz-se
interface com um <i>sistema de arquivos</i>,  pode-se abrir um <i>stream</i> para um
arquivo  cujo  caminho   seja  <code>/home/user/arquivo.txt</code>;  portanto,  tal
caminho será a representação textual  para um arquivo a ser processado
durante a criação, uso e fechamento de um objeto do tipo <i>stream</i>.
</p>

<p>
Não  há forma  textual  para  representação de  um  <i>stream</i>. Assim,  se
Majestic precisa exibir  um <i>stream</i>, será impresso na  tela algum texto
que causaria um erro, caso esse mesmo texto fosse interpretado.
</p>

<p>
<i>Streams</i>  podem estar  <i>abertos</i> ou  <i>fechados</i>. Um  <i>stream</i> aberto  permite
operações de escrita ou recuperação  de informações; um <i>stream</i> fechado
não permite tal escrita ou recuperação.
</p>

<p>
<i>Streams</i> também podem ser de entrada  (<code>in</code>) ou saída (<code>out</code>). Um <i>stream</i> de
entrada permite que  dados sejam recuperados dele; um  <i>stream</i> de saída
permite que  dados sejam escritos  nele, sendo então inseridos  em sua
devida abstração de destino. Não  é possível recuperar elementos de um
<i>stream</i>  de saída,  bem como  não é  possível inserir  elementos em  um
<i>stream</i> de entrada.
</p>

<p>
<i>Streams</i> não podem ser de <i>saída</i> e <i>entrada</i> ao mesmo tempo. Ademais, dois
ou mais  <i>streams</i> não podem  modificar o  mesmo objeto no  sistema (por
exemplo, em  sistemas Unix,  não se  pode abrir  dois <i>streams</i>  para um
mesmo arquivo, independentemente da direção de tais <i>streams</i>).
</p>

<p>
Um <i>stream</i> possui também uma espécie  de cursor interno. Para um <i>stream</i>
de saída,  este cursor  estará sempre  ao final  do mesmo,  onde novos
dados  serão  inseridos;  para  um  <i>stream</i>  de  entrada,  este  cursor
inicia-se no  início do <i>stream</i>, e  move-se ao longo do  mesmo à medida
que  informações forem  sendo lidas  do  mesmo, até  que alcancem  seu
final.
</p>

<p>
Por padrão, os três primeiros <i>streams</i> (idealmente de valores <code>0</code>, <code>1</code> e <code>2</code>,
por exemplo)  são reservados, respectivamente, aos  <i>streams</i> especiais
<code>*stdin*</code> (entrada  padrão), <code>*stdout*</code>  (saída padrão) e  <code>*stderr*</code> (saída
para erros). Assume-se  que tais <i>streams</i> existem durante  todo o tempo
de vida da execução do interpretador.
</p>
</div>
</div>

<div id="outline-container-org0aca157" class="outline-3">
<h3 id="org0aca157"><span class="section-number-3">2.5.</span> Números</h3>
<div class="outline-text-3" id="text-2-5">
<p>
Números  são tratados  como apenas  um tipo  em Majestic.  Todavia, os
mesmos desdobram-se  em quatro subtipos informais  de números, podendo
então serem  interpretados como  números <i>inteiros</i>,  <i>pontos flutuantes</i>,
<i>frações</i> e <i>complexos</i>.
</p>

<p>
A  forma  como  estes  números   são  armazenados  na  memória  não  é
extremamente  relevante,  ficando a  cargo  do  programador caso  seja
necessário garantir  alguma performance.
</p>

<p>
Números são  primariamente elementos atômicos e,  ainda que constituam
sua própria  classe de  elementos, assemelham-se ao  que compreendemos
como  símbolos auto-interpretáveis;  a representação  simbólica de  um
número é,  portanto, sempre  igual a si  mesma, com  algumas ressalvas
quando for necessária a simplificação de tal número.
</p>
</div>

<div id="outline-container-orgc3a1107" class="outline-4">
<h4 id="orgc3a1107"><span class="section-number-4">2.5.1.</span> Inteiros</h4>
<div class="outline-text-4" id="text-2-5-1">
<p>
Números inteiros são números escritos  como algarismos, podendo ou não
ser prefixados por um sinal negativo:
</p>

<pre class="example" id="org08c51a3">
1
0
-1
50
295
</pre>

<p>
Números   inteiros  estão   relacionados  ao   conceito  homônimo   da
matemática, que determina o conjunto \(\mathbb{Z}\).
</p>
</div>
</div>

<div id="outline-container-org8bca179" class="outline-4">
<h4 id="org8bca179"><span class="section-number-4">2.5.2.</span> Frações</h4>
<div class="outline-text-4" id="text-2-5-2">
<p>
Números fracionários são um  tipo semi-recursivo, representados sempre
através  de   números  <i>inteiros</i>  nos  seus   respectivos  numerador  e
denominador. Podem  ser escritos  com um  <i>slash</i> entre  seus elementos,
que funciona como um separador:
</p>

<pre class="example" id="org1b50b19">
2/3
3/4
5/8
99/100
5/2
-10/3
</pre>

<p>
Estes  números correspondem  ao  conceito matemático  do conjunto  dos
números <i>racionais</i>, podendo este ser representado como
</p>

\begin{equation*}
        \mathbb{Q} = \left\{\frac{p}{q}\, \mid \, p \in \mathbb{Z}, q \in \mathbb{Z}^{*} \right\}
\end{equation*}

<p>
Esta definição sugere, portanto, que quaisquer frações expressadas com
denominador nulo constituirão erro de sintaxe.
</p>

<p>
O uso de outros subtipos  (pontos flutuantes, outras frações e números
complexos) como respectivos numeradores  e denominadores de uma fração
é sintaticamente incorreto.
</p>

<p>
As  frações  devem   sempre  ser  interpretadas  em   sua  forma  mais
simplificada  possível,   inclusive  sofrendo  coerções   para  outros
subtipos numéricos, caso seja necessário,  desde que não haja perda na
precisão da informação.
</p>

<p>
Por exemplo,  uma fração como  <code>2/4</code>, durante  o processo de  leitura, é
simplificada para <code>1/2</code>.
</p>

<p>
Igualmente, uma fração como <code>5/1</code> é diretamente convertida para o número
inteiro <code>5</code>, sendo portanto pertencente  ao subtipo numérico dos números
inteiros; isto ocorrerá  sempre que o denominador da  fração for igual
ao número <code>1</code>.
</p>

<p>
A   fração   pode  ser   precedida   pelo   sinal  <i>negativo</i>   em   seu
numerador. Caso o sinal negativo  seja expressado no denominador, este
sinal será repassado  ao numerador; caso numerado  e denominador sejam
expressados com  sinal negativo,  então ambos numerador  e denominador
tornar-se-ão positivos. Assim, <code>4/-9</code> torna-se <code>-4/9</code>, e <code>-4/-9</code> torna-se <code>4/9</code>.
</p>
</div>
</div>

<div id="outline-container-org79020de" class="outline-4">
<h4 id="org79020de"><span class="section-number-4">2.5.3.</span> Pontos flutuantes</h4>
<div class="outline-text-4" id="text-2-5-3">
<p>
Pontos flutuantes <b>emulam parcialmente</b> o conceito matemático de números
reais  (conjunto \(\mathbb{R}\)),  e são  sempre escritos  utilizando uma
notação com  <b>exatamente um  ponto</b> em algum  lugar do  número. Ademais,
também podem ser prefixados por um sinal negativo:
</p>

<pre class="example" id="org277eb89">
2.
.5
20.2
-16.3
-.9
-7.
</pre>

<p>
Os números acima  correspondem exatamente aos valores  <code>2.0</code>, <code>0.5</code>, <code>20.2</code>,
<code>-16.3</code>,  <code>-0.9</code> e  <code>-7.0</code>. Para  facilitar a  implementação, estes  números
podem ser  escritos pelo interpretador  sempre em sua  forma completa,
onde os zeros poderiam ser ignorados.
</p>
</div>
</div>

<div id="outline-container-org0d094f6" class="outline-4">
<h4 id="org0d094f6"><span class="section-number-4">2.5.4.</span> Complexos</h4>
<div class="outline-text-4" id="text-2-5-4">
<p>
Números  complexos   são  outro  tipo  semi-recursivo,   e  devem  ser
compreendidos  como dois  números, que  serão coeficientes  das partes
real e imaginária do número, respectivamente.
</p>

<p>
As  partes real  e imaginária  são descritas  através da  expressão de
algum dos outros subtipos (inteiro,  ponto flutuante ou fração), sendo
separadas ao meio pela letra <code>j</code> ou <code>J</code>, dessa forma:
</p>

<pre class="example" id="orgfc6bdf7">
0J5
3j1
2/3j.5
-2J-1
35.J-2/9
</pre>

<p>
Matematicamente,  os números  acima podem  ser expressados  como \(5i\),
\(3+i\),  \(\frac{2}{3}+0.5i\), \(-2-i\)  e \(35.0-\frac{2}{9}i\),  sendo este
último número também dotado da informação de que sua parte <i>real</i> é
composta por um <i>ponto flutuante</i>, e não por um número <i>inteiro</i>.
</p>
</div>
</div>

<div id="outline-container-org2cd2e1d" class="outline-4">
<h4 id="org2cd2e1d"><span class="section-number-4">2.5.5.</span> Coerções entre subtipos numéricos</h4>
<div class="outline-text-4" id="text-2-5-5">
<p>
Os subtipos antes mencionados pertencem  à mesma classe dos números e,
portanto, é inevitável que operações se realizem entre eles.
</p>

<p>
Todavia, essas  operações geralmente demandem que  números de subtipos
diferentes  sejam transformados  em  números do  mesmo subtipo.  Nesse
caso, o  subtipo a  prevalecer precisa  ser aquele  onde haja  a menor
perda de informação quanto for possível.
</p>

<p>
A  tabela a  seguir  apresenta comparações  entre um  Subtipo  1 e  um
Subtipo  2,  quando ambos  são  diferentes.  Para cada  comparação,  a
terceira coluna apresenta o subtipo  mais rico em informação, ou seja,
quando ambas  as variáveis forem  convertidas para este  subtipo "mais
rico", não ocorrerá perda de informação de maneira prática.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Subtipo 1</th>
<th scope="col" class="org-left">Subtipo 2</th>
<th scope="col" class="org-left">Subtipo mais rico</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>integer</code></td>
<td class="org-left"><code>float</code></td>
<td class="org-left"><code>float</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><code>fraction</code></td>
<td class="org-left"><code>fraction</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><code>complex</code></td>
<td class="org-left"><code>complex</code></td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>float</code></td>
<td class="org-left"><code>integer</code></td>
<td class="org-left"><code>float</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><code>fraction</code></td>
<td class="org-left"><code>fraction</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><code>complex</code></td>
<td class="org-left"><code>complex</code></td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>fraction</code></td>
<td class="org-left"><code>integer</code></td>
<td class="org-left"><code>fraction</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><code>float</code></td>
<td class="org-left"><code>fraction</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><code>complex</code></td>
<td class="org-left"><code>complex</code></td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>complex</code></td>
<td class="org-left"><code>integer</code></td>
<td class="org-left"><code>complex</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><code>float</code></td>
<td class="org-left"><code>complex</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><code>fraction</code></td>
<td class="org-left"><code>complex</code></td>
</tr>
</tbody>
</table>

<p>
A  tabela pode  ser abstraída  para  uma segunda  tabela de  propósito
geral, onde  possamos estipular um  subtipo \(x\) que  possa representar
qualquer subtipo não anteriormente listado.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Subtipo 1</th>
<th scope="col" class="org-left">Subtipo 2</th>
<th scope="col" class="org-left">Subtipo mais rico</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>integer</code></td>
<td class="org-left">\(x\)</td>
<td class="org-left">\(x\)</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>float</code></td>
<td class="org-left"><code>integer</code></td>
<td class="org-left"><code>float</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><code>fraction</code></td>
<td class="org-left"><code>fraction</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">\(x\)</td>
<td class="org-left">\(x\)</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>fraction</code></td>
<td class="org-left"><code>complex</code></td>
<td class="org-left"><code>complex</code></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">\(x\)</td>
<td class="org-left"><code>fraction</code></td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>complex</code></td>
<td class="org-left">\(x\)</td>
<td class="org-left"><code>complex</code></td>
</tr>
</tbody>
</table>

<p>
Algumas conclusões podem ser tiradas dessa segunda tabela:
</p>

<ul class="org-ul">
<li><code>integer</code> é o subtipo mais fraco em termos de informação carregada;</li>
<li><code>float</code> é  um subtipo  mais forte  que <code>integer</code>,  porém mais  fraco que
<code>fraction</code>: como  implementações de  pontos flutuantes  geralmente são
limitadas,  estes tendem  a  serem mais  inexatos  que <code>fraction</code>,  em
implementações reais;</li>
<li><code>fraction</code> é o subtipo mais forte depois de <code>complex</code>;</li>
<li><code>complex</code> é o subtipo mais forte de todos os anteriores.</li>
</ul>

<p>
Todavia, o caso de <code>complex</code> merece  uma melhor análise, já que trata-se
de um  subtipo que depende  de outros  subtipos diferentes de  si. Por
isso, quando  <code>complex</code> possui  parte imaginária  <i>nula</i>, ele  torna-se um
número <b>com o mesmo subtipo de sua parte real</b>.
</p>

<p>
Com relação  ao subtipo <code>fraction</code>,  é trivial imaginar que  frações com
denominador   <code>1</code>   possam    ser   automaticamente   transformadas   em
<code>integer</code>.  Todavia,  por  facilidade  de  manipulação,  <code>fraction</code>'s  não
precisam  ser transformados  em  em  <code>integer</code>'s automaticamente.  Sendo
assim, <code>2/1</code> e <code>2</code> serão dois  números de Majestic Lisp com representações
e subtipos diferentes, mas que representam o mesmo valor.
</p>
</div>

<ul class="org-ul">
<li><a id="orgb49db30"></a><b>Da nulidade numérica.</b><br />
<div class="outline-text-5" id="text-orgb49db30">
<p>
Devido à natureza das informações contidas em <code>complex</code>, por ser um tipo
primariamente recursivo,  sua conversão para  um valor <i>real</i>  (quando o
valor <i>imaginário</i> é nulo) envolve um  teste de nulidade com a sua parte
imaginária.
</p>

<p>
Tal  teste é  efetuado  utilizando-se a  função  <code>zerop</code>. Todavia,  como
comparações  envolvendo  igualdade em  números  de  subtipo <code>float</code>  nem
sempre  resultam  em  uma  comparação  correta,  Majestic  Lisp  torna
impossível  saber  da  nulidade  de  um  número  <code>float</code>  através  dessa
função<sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup>.  Assim, um número <code>complex</code> cuja parte imaginária seja
igual a  <code>0.0</code>, por  exemplo, não  será transformado  no subtipo  de sua
parte real.
</p>
</div>
</li>

<li><a id="org186c771"></a><b>Das coerções em divisões inteiras.</b><br />
<div class="outline-text-5" id="text-org186c771">
<p>
Nos  casos de  algumas  operações elementares,  é pertinente  garantir
certos subtipos  numéricos específicos  no retorno de  operações. 
</p>

<p>
Para uma  <b>operação de divisão</b>  entre dois números de  subtipo <code>integer</code>,
retorna-se um número de subtipo  <code>fraction</code> quando o divisor não
for divisível pelo  dividendo.  Essa decisão deriva da ideia  de que é
necessário minimizar a perda de informação em uma operação.
</p>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org7292e14" class="outline-3">
<h3 id="org7292e14"><span class="section-number-3">2.6.</span> Dados atômicos e objetos</h3>
<div class="outline-text-3" id="text-2-6">
<p>
Quaisquer  tipos de  dados que  não  sejam células  <i>cons</i> são  chamados
<i>átomos</i>. Portanto, <i>símbolos</i>, <i>caracteres</i>, <i>streams</i> e <i>números</i> são <i>átomos</i>.
</p>

<p>
Instâncias dos cinco tipos fundamentais são chamadas <i>objetos</i>.
</p>
</div>
</div>
</div>

<div id="outline-container-org28b0d79" class="outline-2">
<h2 id="org28b0d79"><span class="section-number-2">3.</span> Listas</h2>
<div class="outline-text-2" id="text-3">
<p>
Listas são associações de objetos  em coleções, sendo portanto um <i>meio
de combinação</i> de objetos em  Majestic Lisp, sendo estes objetos outras
listas ou não.
</p>

<p>
Podemos  utilizar   células  <i>cons</i>  para  construir   vários  tipos  de
estruturas  de  dados diferentes,  mas  a  forma mais  fundamental  de
utilizá-las  é para  a construição  de listas.
</p>
</div>

<div id="outline-container-org423d3a0" class="outline-3">
<h3 id="org423d3a0"><span class="section-number-3">3.1.</span> <span class="todo TODO">TODO</span> Listas pontuadas</h3>
</div>

<div id="outline-container-orge1c225a" class="outline-3">
<h3 id="orge1c225a"><span class="section-number-3">3.2.</span> Listas adequadas</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Para que  possamos representar listas adequadas,  seguimos duas regras
básicas:
</p>

<ol class="org-ol">
<li>O símbolo <code>nil</code> representa a lista vazia.</li>
<li>Se  <code>y</code> é uma lista,  então o <i>cons</i>  <code>(x . y)</code>  é uma lista de  <code>x</code> seguida
dos elementos de <code>y</code>.</li>
</ol>

<p>
Eis uma lista feita com um único par:
</p>

<pre class="example" id="org1355afe">
(a . nil)
</pre>

<p>
De acordo com a regra 2, esta é uma lista de um símbolo <code>a</code>, seguida dos
elementos  de  <code>nil</code>   que,  de  acordo  com  a  regra   1,  não  possui
elementos. Portanto,  trata-se de  uma lista de  um único  elemento, o
símbolo <code>a</code>.
</p>

<p>
Através  do aninhamento  de <i>cons</i>,  podemos criar  listas de  quaisquer
tamanhos. Eis uma lista cujos elementos sejam os símbolos <code>a</code> e <code>b</code>:
</p>

<pre class="example" id="orged2261c">
(a . (b . nil))
</pre>

<p>
A seguinte lista possui, como elementos, <code>a</code>, <code>b</code> e <code>c</code>:
</p>

<pre class="example" id="org1869f1f">
(a . (b . (c . nil)))
</pre>
</div>
</div>

<div id="outline-container-org82eb180" class="outline-3">
<h3 id="org82eb180"><span class="section-number-3">3.3.</span> Notação abreviada de listas</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Como esta forma de expressar uma  lista é muito pouco prática, podemos
instituir uma notação abreviada que seja mais conveniente:
</p>

<ol class="org-ol">
<li>O símbolo <code>nil</code> pode ser representado como <code>()</code>.</li>
<li>Quando o <code>cdr</code> de um <i>cons</i> for uma <i>lista</i>, pode-se omitir o ponto antes
do mesmo,  e também os parênteses  que o delimitam. Assim,  <code>(a . (b
   ...))</code> pode ser escrito como <code>(a b ...)</code>.</li>
</ol>

<p>
Através  da  aplicação  repetida  dessas duas  novas  regras,  podemos
transformar
</p>

<pre class="example" id="orge433f3e">
(a . (b . (c . nil)))
</pre>

<p>
em
</p>

<pre class="example" id="orga941772">
(a b c)
</pre>

<p>
Em outras palavras, uma lista pode ser expressada através da colocação
de seus elementos entre parênteses. Assim, não há motivo para utilizar
a notação com pontos para uma lista como  <code>(a b c)</code>, a não ser que fosse
estritamente necessário, por uma razão especial.
</p>

<p>
Como  qualquer objeto  pode  ser  uma parte  de  um  <i>cons</i>, então  seus
elementos  também podem  ser listas.  Todos os  exemplos a  seguir são
listas válidas:
</p>

<pre class="example" id="orgf18971e">
(a (b) c)
((a b c))
(nil)
</pre>

<p>
<i>Cons</i> como estes, onde pode-se iterar através do <code>cdr</code> de seus elementos,
e   eventualmente  encontra-se   sempre  <code>nil</code>,   são  chamadas   <i>listas
adequadas</i>. Esta é uma <i>lista adequada</i>:
</p>

<pre class="example" id="org8089c50">
(a b c)
</pre>

<p>
Esta lista, todavia, não é:
</p>

<pre class="example" id="org6f2f7b0">
(a b . c)
</pre>

<p>
A lista vazia também é uma lista adequada.
</p>

<p>
Um <i>cons</i> que não seja classificado  como uma <i>lista adequada</i> é chamado
<i>lista  pontuada</i>,  porque  é  necessária   a  notação  de  pontos  para
representá-la.
</p>
</div>
</div>

<div id="outline-container-org7e7cb8e" class="outline-3">
<h3 id="org7e7cb8e"><span class="section-number-3">3.4.</span> <span class="todo TODO">TODO</span> Listas associativas</h3>
</div>
</div>
<div id="outline-container-org46afd29" class="outline-2">
<h2 id="org46afd29"><span class="section-number-2">4.</span> <span class="todo TODO">TODO</span> Vetores</h2>
<div class="outline-text-2" id="text-4">
<p>
Vetores são estruturas de dados  mutáveis, com tamanho variável, cujos
elementos sejam de  um mesmo tipo, segundo  certas regras particulares
que garantem um tipo único para o vetor em determinadas situações.
</p>

<p>
Diferentemente das listas, vetores são meios de combinação que não são
compostos de <i>cons cells</i>; ao invés  disso, os elementos de um vetor são
armazenados  de forma  sequencial na  memória, não  sendo encapsulados
pelas estruturas de pares.
</p>
</div>

<div id="outline-container-org12c929e" class="outline-3">
<h3 id="org12c929e"><span class="section-number-3">4.1.</span> Notação de vetores</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Vetores  são representados  sintaticamente entre  colchetes, de  forma
muito similar às listas. De  forma geral, temos como regras sintáticas
que:
</p>

<ol class="org-ol">
<li>Os colchetes (<code>[</code> e <code>]</code>) delimitam os elementos de um vetor.</li>
<li>Elementos individuais são separados por espaço em branco.</li>
</ol>

<p>
Um vetor vazio pode ser representado como:
</p>

<pre class="example" id="org53b8678">
[]
</pre>

<p>
Valores  em   um  vetor  podem  ser   representados  igualmente  entre
colchetes, com espaço vazio entre seus elementos:
</p>

<pre class="example" id="orgc2e63d2">
[1 2 3 4 5]
</pre>
</div>
</div>

<div id="outline-container-orgc6f2300" class="outline-3">
<h3 id="orgc6f2300"><span class="section-number-3">4.2.</span> Tipo de um vetor</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Vetores seguem uma uniformidade entre  seus elementos tanto quanto for
possível. Em outras palavras, vetores possuem um tipo único entre seus
elementos, ainda  que este tipo  seja uma representação  genérica para
muitos tipos.
</p>

<p>
O tipo de um vetor é deduzido a partir dos elementos fornecidos na sua
criação  ou, caso  não seja  possível deduzir  seu tipo,  admite-se um
vetor de qualquer tipo de objeto, o que implica em uma indireção extra
em seus elementos.
</p>

<p>
Há quatro tipos diferentes de vetores:
</p>
</div>

<div id="outline-container-orgbcf942a" class="outline-4">
<h4 id="orgbcf942a"><span class="section-number-4">4.2.1.</span> Vetor de números inteiros</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
Este vetor  é composto  unicamente de números  com o  subtipo numérico
<code>integer</code>.
</p>

<pre class="example" id="orgc1e7dfc">
[1 2 3 4 5]
</pre>
</div>
</div>

<div id="outline-container-orge663bdf" class="outline-4">
<h4 id="orge663bdf"><span class="section-number-4">4.2.2.</span> Vetor de pontos flutuantes</h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
Este vetor  é composto  unicamente de números  com o  subtipo numérico
<code>float</code>.
</p>

<pre class="example" id="orgf705d9d">
[1.5 2.4 3.35 4.2 5.1]
</pre>
</div>
</div>

<div id="outline-container-org34b8a18" class="outline-4">
<h4 id="org34b8a18"><span class="section-number-4">4.2.3.</span> Vetor de caracteres</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
Este vetor possui certas particularidades  que serão discutidas mais à
frente. Independente  disso, é  composto unicamente  de objetos  com o
tipo <code>char</code>.
</p>

<pre class="example" id="org13879ee">
[#\H #\e #\l #\l #\o]
</pre>

<p>
Para este tipo de vetor, podemos adicionar uma nova regra sintática:
</p>

<p>
Um vetor de objetos do  tipo <code>char</code> pode ser sintaticamente representado
através da substituição dos colchetes por aspas duplas (<code>"</code>), seguido de
remoção  dos espaços  em branco  entre  os ítens,  e cada  um de  seus
elementos serão  representados como  caracteres em sua  versão textual
simples, sem o sufixo <code>#\</code>.
</p>

<p>
O vetor anterior de caracteres pode, portanto, ser representado como:
</p>

<pre class="example" id="org7c71435">
"Hello"
</pre>
</div>
</div>

<div id="outline-container-org1cf6abd" class="outline-4">
<h4 id="org1cf6abd"><span class="section-number-4">4.2.4.</span> Vetor de qualquer tipo (Any)</h4>
<div class="outline-text-4" id="text-4-2-4">
<p>
Este vetor pode possuir qualquer objeto como elemento.
</p>

<p>
Este é  o tipo inerente a  qualquer vetor que não  possua uniformidade
nos  tipos   de  seus  componentes,   ou  cujo  tipo  não   possa  ser
sintaticamente deduzido.
</p>

<p>
Vetores de qualquer  tipo (ou de tipo <code>any</code>) possuem  quaisquer tipos de
elementos. Isso inclui  outros vetores, e pode  incluir também vetores
sintaticamente idênticos aos exemplos anteriores.
</p>

<p>
Os exemplos a seguir representam vetores que tenham, indubitavelmente,
o tipo <code>any</code>.
</p>

<pre class="example" id="orgd7206f1">
[]
[1 2/3 2j5 6 '(a b c)]
[[] [] []]
</pre>

<p>
Outros vetores podem, por meio  de transformações sucessivas durante a
execução  de  um  programa   (por  exemplo,  inserções  sucessivas  de
elementos em  um vetor vazio), serem  vetores de tipo <code>any</code>  que lembram
sintaticamente vetores de tipos específicos.
</p>

<p>
Por  exemplo,  considere o  vetor  criado  sintaticamente na  forma  a
seguir.
</p>

<pre class="example" id="orgac80e07">
[]
</pre>

<p>
Este vetor é do tipo <code>any</code>,  porque não podemos deduzir sintaticamente o
tipo mais apropriado para um vetor temporariamente vazio.
</p>

<p>
Suponhamos, portanto, que  dois elementos de tipo  <code>char</code> sejam inserido
nesse vetor: as letras <code>'H'</code> e <code>'e'</code>.
</p>

<pre class="example" id="org6e21445">
[#\H #\e]
</pre>

<p>
A regra sintática que garante uma notação entre aspas <b>não se aplica</b> no
vetor acima, posto que o tipo de seus elementos não é <code>char</code>, e sim <code>any</code>,
algo determinado no momento de sua criação.
</p>

<p>
Para que possamos usufruir das idiossincrasias inerentes a um vetor de
<code>char</code>, será necessário realizar uma  conversão explícita de um vetor de
<code>any</code> para  um vetor de <code>char</code>.  Isso poderá ser realizado  através de uma
das funções primitivas da linguagem.
</p>
</div>
</div>
</div>

<div id="outline-container-orgcaf69e7" class="outline-3">
<h3 id="orgcaf69e7"><span class="section-number-3">4.3.</span> <span class="todo TODO">TODO</span> Coerção entre tipos de vetores</h3>
</div>

<div id="outline-container-org41b05fe" class="outline-3">
<h3 id="org41b05fe"><span class="section-number-3">4.4.</span> Strings</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Strings são  informação textual,  podendo ser compreendida  como algum
tipo de sequência de um número variável de caracteres.
</p>

<p>
Em  Majestic Lisp,  strings são  vetores  de caracteres  &#x2013; em  outras
palavras, vetores de tipo <code>char</code>.
</p>

<p>
Portanto, um vetor construído pela forma
</p>

<pre class="example" id="org537c83b">
(vector #\a #\b #\c)
</pre>

<p>
é uma string válida, podendo  também ser expressado da seguinte forma,
pela notação abreviada de vetores:
</p>

<pre class="example" id="orgb7bf05c">
[#\a #\b #\c]
</pre>
</div>

<div id="outline-container-org8e99eb3" class="outline-4">
<h4 id="org8e99eb3"><span class="section-number-4">4.4.1.</span> Notação abreviada de strings</h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
Mesmo com a notação abreviada de vetores, expressar uma string como um
vetor de  caracteres pode ser  muito pouco prático.  Podemos estipular
algumas regras que tornam a legibilidade de uma string ainda melhor:
</p>

<ol class="org-ol">
<li>Pode-se  substituir os colchetes (<code>[</code>  e <code>]</code>) por aspas  duplas (<code>"</code>), em
ambos os casos;</li>
<li>Caso  isso seja feito,  remova os espaços  entre os caracteres  e o
prefixo <code>#\</code> dos mesmos.</li>
</ol>

<p>
Dessa  forma, a  string do  exemplo  anterior poderia  ser escrita  da
seguinte forma:
</p>

<pre class="example" id="orge88708f">
"abc"
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2a7cf6c" class="outline-2">
<h2 id="org2a7cf6c"><span class="section-number-2">5.</span> Valores-verdade</h2>
<div class="outline-text-2" id="text-5">
<p>
O  símbolo  <code>nil</code> representa  falsidade,  além  de representar  a  lista
fazia. O símbolo  <code>t</code> é a representação padrão de  verdade, mas qualquer
objeto que não seja <code>nil</code> também contará como verdadeiro.
</p>

<p>
Poderá parecer estranho usar o  mesmo valor para representar falsidade
e a  lista vazia, mas na  prática, isso funciona bem.  Funções de Lisp
costumeiramente retornam  conjuntos de respostas, e  um conjunto vazio
de respostas é tratado uma falsidade.
</p>
</div>
</div>

<div id="outline-container-org6e8d6e0" class="outline-2">
<h2 id="org6e8d6e0"><span class="section-number-2">6.</span> Funções</h2>
<div class="outline-text-2" id="text-6">
<p>
A  maior parte  dos programas  de  Majestic Lisp  são constituídos  de
funções. Funções  tomam zero ou  mais objetos como  argumentos, talvez
façam  alguma coisa  (por exemplo,  mostrar uma  mensagem na  tela), e
então retornam um objeto.
</p>

<p>
Funções podem ser classificadas  como <i>funções primitivas</i> ou <i>clausuras</i>,
dependendo da forma como são  geradas. Uma função primitiva geralmente
é inerente  à implementação  de Majestic Lisp,  e uma  clausura estará
relacionada a algo que pode ser definido através da própria linguagem,
ou pelo programador.
</p>
</div>

<div id="outline-container-org2b67136" class="outline-3">
<h3 id="org2b67136"><span class="section-number-3">6.1.</span> Representação de clausuras</h3>
<div class="outline-text-3" id="text-6-1">
<p>
Clausuras são representadas  usando listas. Por exemplo,  a clausura a
seguir toma um único argumento, e retorna a soma entre o mesmo e <code>1</code>.
</p>

<pre class="example" id="org2b83e66">
(lit closure &lt;lexenv&gt; (x) (+ x 1))
</pre>

<p>
O  primeiro  elemento, <code>lit</code>,  especifica  que  estamos tratando  de  um
<i>objeto literal</i>, que não será interpretado.
</p>

<p>
O  segundo,  <code>closure</code>,  especifica  o   tipo  do  objeto  literal:  uma
<i>clausura</i>.
</p>

<p>
O  terceiro elemento  é o  contexto  léxico, uma  associação local  de
símbolos  aos  quais  valores  estejam atrelados.   Se  o  exemplo  de
clausura  tive sido  declarado no  <i>top-level</i>, o  contexto léxico  será
vazio.
</p>

<p>
O quarto  elemento, <code>(x)</code>, é  uma <i>lambda list</i>, podendo  ser compreendida
como os parâmetros da função. Quando a  função é chamada, o valor de <code>x</code>
será aquele valor com o qual a função é chamada.
</p>

<p>
O quinto e último elemento, <code>(+ x 1)</code>, é o <i>corpo</i> da clausura, e define o
valor retornado pela mesma.
</p>
</div>
</div>

<div id="outline-container-org88f1a0b" class="outline-3">
<h3 id="org88f1a0b"><span class="section-number-3">6.2.</span> Representação alternativa de clausuras</h3>
<div class="outline-text-3" id="text-6-2">
<p>
Normalmente,  não expressamos  uma clausura  usando sua  representação
literal. É suficiente que utilizemos a notação
</p>

<pre class="example" id="org982b3a4">
(fn (x) (+ x 1))
</pre>

<p>
que gerará a clausura explicitada anteriormente.
</p>

<p>
Esta sintaxe determina,  a princípio, uma forma especial,  uma vez que
realiza captura de escopo e produz uma literal.
</p>
</div>
</div>
</div>

<div id="outline-container-orge7599b4" class="outline-2">
<h2 id="orge7599b4"><span class="section-number-2">7.</span> Macros</h2>
<div class="outline-text-2" id="text-7">
<p>
Uma funcionalidade muito recorrente em dialetos de Lisp é a construção
de <i>macros</i>: elementos  que auxiliam o programador  a reescrever sintaxe
no  programa. Através  do uso  de  <i>macros</i>, pode-se  criar formas  mais
sucintas  ou mais  intuitivas  para  determinados problemas,  enquanto
ainda não se foge do uso da sintaxe da linguagem.
</p>
</div>

<div id="outline-container-org6175448" class="outline-3">
<h3 id="org6175448"><span class="section-number-3">7.1.</span> Representação</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Macros são  clausuras executadas  sobre uma expressão  qualquer, antes
que a mesma seja interpretada. Nesse  sentido, o <i>macro</i> nada mais é que
uma função que opera sobre dados comuns.
</p>

<p>
Um <i>macro</i> é  representado como um <i>literal</i> de três  elementos, tal que o
terceiro elemento  seja uma  clausura propriamente dita,  como pode-se
ver a seguir:
</p>

<pre class="example" id="orgc914e82">
(lit macro (lit closure &lt;lexenv&gt; (f x) (list f x)))
</pre>

<p>
O  primeiro elemento,  <code>lit</code>, deixa  claro  que estamos  tratando de  um
literal,  que  consequentemente  não  deverá  ter  seus  sub-elementos
interpretados. Já o segundo elemento, <code>macro</code>, clarifica que tal literal
constitui um <i>macro</i>.
</p>

<p>
O  terceiro elemento  é  uma  <i>clausura</i> comum,  que  será aplicada  aos
argumentos do <i>macro</i>. Esta clausura captura o contexto onde o macro foi
definido, e seu  retorno será considerado uma expressão  que, de forma
subsequente à aplicação comum do macro, será interpretada.
</p>

<p>
À aplicação  da clausura associada  aos dados preprocessados,  damos o
nome de <i>expansão</i> do <i>macro</i>.
</p>
</div>
</div>

<div id="outline-container-org11630b4" class="outline-3">
<h3 id="org11630b4"><span class="section-number-3">7.2.</span> Representação alternativa</h3>
<div class="outline-text-3" id="text-7-2">
<p>
Assim  como o  caso das  clausuras, podemos  expressar <i>macros</i>  com uma
notação sucinta baseada em uma forma especial:
</p>

<pre class="example" id="org9b77577">
(mac (f x) (list f x))
</pre>

<p>
O literal do macro poderá ser atribuído a um símbolo tanto no contexto
global  quanto no  contexto  léxico, porém,  tentar  <i>aplicar</i> um  macro
(através da forma especial <code>apply</code>, por exemplo) constitui um erro. Para
um macro,  pode-se fazer  sua <i>expansão</i>  através de  <code>macroexpand-1</code>, por
exemplo.
</p>
</div>
</div>
</div>

<div id="outline-container-org3d174e9" class="outline-2">
<h2 id="org3d174e9"><span class="section-number-2">8.</span> Interpretação</h2>
<div class="outline-text-2" id="text-8">
<p>
A execução de  um programa em Majestic Lisp  consiste na interpretação
de expressões.  Todos  os objetos Majestic são  expressões, portanto a
palavra "expressão"  é meramente um comunicado  de intenção: significa
que espera-se que seja interpretado.
</p>
</div>

<div id="outline-container-orge2a4111" class="outline-3">
<h3 id="orge2a4111"><span class="section-number-3">8.1.</span> Resultados de uma interpretação</h3>
<div class="outline-text-3" id="text-8-1">
<ol class="org-ol">
<li>Pode retornar um valor: <code>(+ 1 2)</code> retornará <code>3</code>.</li>
<li>Pode causar um erro: <code>(/ 1 0)</code> causará.</li>
<li>Pode  falhar em terminar:  <code>(defn foo () (foo))</code> não parará  após ser
invocada.</li>
</ol>

<p>
Outras  expressões também  realizam comportamento  no processo  de sua
interpretação,  o  que  é  convencionalmente  conhecido  como  <i>efeitos
colaterais</i>. Por exemplo, a expressão
</p>

<pre class="example" id="orge5b7ac3">
(print 1)
</pre>

<p>
retornará <code>nil</code>, mas antes disso, imprimirá <code>1</code> no console.
</p>

<p>
Alguns <i>átomos</i> são interpretados como si mesmos. Isto ocorre como todos
os caracteres, <i>streams</i>  e números, assim como com os  símbolos <code>nil</code>, <code>t</code>,
<code>o</code> e <code>apply</code>.  todos os outros símbolos são nomes  de variáveis, e sempre
serão interpretados para algum valor, ou  causarão um erro se eles não
possuírem valor associado.
</p>
</div>
</div>

<div id="outline-container-org934385e" class="outline-3">
<h3 id="org934385e"><span class="section-number-3">8.2.</span> Chamadas de funções</h3>
<div class="outline-text-3" id="text-8-2">
<p>
Uma lista adequada cujo primeiro  elemento possa ser interpretado como
uma função  é conhecida  como uma  <i>chamada de  função</i>. Por  exemplo, a
expressão
</p>

<pre class="example" id="org2d95c36">
(+ x 1)
</pre>

<p>
é uma  chamada de função, posto  que o valor  de <code>+</code> seja uma  função. O
valor de uma chamada de função será o objeto retornado pela mesma.
</p>

<p>
Chamadas de funções são interpretadas  da esquerda para a direita. Por
exemplo, ao interpretarmos a expressão
</p>

<pre class="example" id="orga921ebf">
(+ 2 3)
</pre>

<p>
teremos:
</p>

<ol class="org-ol">
<li>Primeiramente, <code>+</code> é interpretado,  retornando uma <i>função</i> que retorna
a soma de seus argumentos.</li>
<li><code>2</code> é interpretado, retornando a si mesmo.</li>
<li><code>3</code> é interpretado, retornando a si mesmo.</li>
<li>Finalmente,  os dois números são  passados à função, que  retorna o
número <code>5</code>.</li>
</ol>

<pre class="example" id="org758d06e">
&gt; (+ 2 3)
5
</pre>

<p>
Expressões podem ser  aninhadas. A regra de  interpretação da esquerda
para  a  direita significa  que  funções  aninhadas são  interpretadas
primeiramente e em profundidade. Por exemplo, a interpretação de
</p>

<pre class="example" id="orga6da642">
(+ (- 5 2) 7)
</pre>

<p>
pressupõe que as  sub-expressões que serão avaliadas  sejam, em ordem,
<code>+</code>, <code>(- 5 2)</code>, <code>-</code>, <code>5</code>, <code>2</code> e <code>7</code>.
</p>
</div>
</div>

<div id="outline-container-org3199dfb" class="outline-3">
<h3 id="org3199dfb"><span class="section-number-3">8.3.</span> Formas especiais</h3>
<div class="outline-text-3" id="text-8-3">
<p>
Nem  todas  as  expressões  são   interpretadas  da  esquerda  para  a
direita.  Há  um  pequeno  conjunto de  símbolos  chamados  de  <i>formas
especiais</i>,  e as  expressões  cujo primeiro  elemento  seja uma  forma
especial será interpretada de acordo  com as regras definidas por essa
mesma forma especial.
</p>

<p>
Por exemplo, <code>if</code> é uma <i>forma especial</i>, e portanto, quando a expressão
</p>

<pre class="example" id="orge78e8ad">
(if test then else)
</pre>

<p>
é   interpretada,  apenas   um   dos  últimos   dois  elementos   será
interpretado,  dependendo do  valor retornado  pelo segundo  elemento,
<code>test</code>, que poderá ser verdadeiro ou falso.
</p>

<p>
Objetos  que  podem  ser  utilizados como  primeiro  elemento  de  uma
expressão são  chamados <i>operadores</i>. Assim, <i>funções</i>  e <i>formas especiais</i>
são <i>operadores</i>. Mas, assim como o termo "expressão", esta é apenas uma
expressão de  intenção. Pode-se colocar  qualquer objeto no  início de
uma expressão, desde que especifique-se o que acontece ao colocá-lo.
</p>
</div>
</div>

<div id="outline-container-org8f08237" class="outline-3">
<h3 id="org8f08237"><span class="section-number-3">8.4.</span> <span class="todo TODO">TODO</span> Escopo</h3>
<div class="outline-text-3" id="text-8-4">
</div>
</div>
</div>

<div id="outline-container-orgde6bcf8" class="outline-2">
<h2 id="orgde6bcf8"><span class="section-number-2">9.</span> Ligações e Contextos</h2>
<div class="outline-text-2" id="text-9">
<p>
Há três formas  de fazer com que uma variável  tenha um valor: através
de ligações <i>globais</i>, <i>léxicas</i> e <i>dinâmicas</i>.  A de consulta dos contextos
durante um processo de consulta de valores de variáveis é:
</p>

<ol class="org-ol">
<li>Contexto léxico;</li>
<li>Contexto dinâmico;</li>
<li>Contexto global.</li>
</ol>
</div>

<div id="outline-container-orga4c904a" class="outline-3">
<h3 id="orga4c904a"><span class="section-number-3">9.1.</span> Ligações globais</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Uma variável poderá  ter um valor <i>global</i>, como por  exemplo a função <code>+</code>
possui, significando que, por padrão, ela possui aquele valor em todos
os lugares onde  puder ser invocada.  Tal variável  é dita <i>globalmente
ligada</i>, e o conjunto de ligações globais é chamado <i>contexto global</i>.
</p>

<p>
Podemos definir ligações globais entre  variáveis e valores através da
forma especial <code>def</code>.
</p>

<pre class="example" id="org8a9f3da">
&gt; (def my-value 5)
my-value

&gt; my-value
5
</pre>
</div>
</div>

<div id="outline-container-org84f3467" class="outline-3">
<h3 id="org84f3467"><span class="section-number-3">9.2.</span> Ligações léxicas ou estáticas</h3>
<div class="outline-text-3" id="text-9-2">
<p>
Outra forma de uma variável ter um valor é através de ser um parâmetro
de uma clausura. Quando a clausura
</p>

<pre class="example" id="org2b43c49">
(fn (x) (+ x 1))
</pre>

<p>
é chamada,  a variável <code>x</code>  irá, no corpo da  mesma, assumir o  valor de
qualquer que seja o argumento com  o qual a clausura foi chamada. Este
processo é chamado  de <i>ligação léxica</i>, e o atual  conjunto de <i>ligações
léxicas</i> durante a execução do corpo de uma clausura é chamado <i>contexto
léxico</i>.
</p>

<p>
Ocasionalmente, caso a clausura tenha sido definida dentro de outra,
como no exemplo a seguir&#x2026;
</p>

<pre class="example" id="org536b2a7">
(fn (x) (fn (y) (+ x y)))
</pre>

<p>
&#x2026;a  clausura  mais  interna  <i>capturará</i>  todas  as  ligações  léxicas
determinadas  pela  externa  &#x2013;  leia-se  o valor  atribuído  a  <code>x</code>  na
invocação da clausura.   Sendo assim, por mais que o  valor de retorno
da  clausura  mais  externa  seja  a  clausura  interna,  esta  última
conhecerá o valor de <code>x</code> devido a esse mecanismo de captura.
</p>

<p>
Um  contexto capturado  por  uma clausura  será  extendido mediante  a
aplicação  da mesma,  adicionando-se novas  definições que  determinem
valores associados aos parâmetros da clausura.
</p>

<p>
Uma clausura  definida sob  um contexto  global capturará  um contexto
vazio, posto que  o contexto global compreenda um  contexto especial e
diretamente modificável pela forma especial <code>def</code>.
</p>

<p>
Ao contexto capturado  pela clausura, antes e depois  de sua extensão,
damos o nome <i>contexto léxico</i>.
</p>

<p>
Abaixo,  temos  um   exemplo  explícito  que  explora   a  captura  de
contexto. <code>g</code> é  definido através do retorno da aplicação  direta de uma
função anônima, que por sua vez  retorna uma segunda função. Como esta
segunda função  é gerada  dentro do  escopo da  primeira, o  escopo da
primeira  função, gerado  durante a  aplicação da  mesma, onde  <code>x</code> está
bem-definido e  ligado a <code>9</code>,  é capturado pela função  retornada.
</p>

<pre class="example" id="orgf53424d">
&gt; (def g
    ((fn (x)
       (fn (y) (+ x y)))
     9))
g

&gt; (g 4)
13
</pre>
</div>
</div>

<div id="outline-container-org448edc4" class="outline-3">
<h3 id="org448edc4"><span class="section-number-3">9.3.</span> Ligações dinâmicas</h3>
<div class="outline-text-3" id="text-9-3">
<p>
Adicionalmente,  como terceira  opção, temos  uma ligação  dinâmica. A
ligação dinâmica ocorre  quando uma clausura refere-se  a uma variável
que foi definida pelo contexto léxico onde a clausura foi chamada.
</p>

<p>
Por exemplo, consideremos as definições a seguir.
</p>

<pre class="example" id="orge87e2bc">
&gt; (def *my-value* 5)
my-value

&gt; (def my-function
    (fn () *my-value*))
my-function
</pre>

<p>
O exemplo  a seguir  demonstra a invocação  da clausura  armazenada no
contexto  global, sob  a alcunha  <code>my-function</code>.  Esta  clausura procura
primeiramente por  essa variável no  contexto léxico que  captura; não
encontrando-a, volta-se para o contexto global, e lá procura-a.
</p>

<pre class="example" id="org3554a6c">
&gt; (my-function)
5
</pre>

<p>
Em algumas  situações, pode  ser pertinente  <i>redefinir temporariamente</i>
uma variável global ou, caso tal  variável global não exista, pode ser
pertinente defini-la temporariamente.
</p>

<p>
Isso  pode  ser  feito  através  da  criação  de  um  <i>contexto  léxico
"especial"</i>, que  será consultado  pela clausura  antes da  consulta no
<i>contexto global</i>. Vejamos o exemplo a seguir:
</p>

<pre class="example" id="org2dab854">
&gt; (let ((*my-value* 6))
    (my-function))
6
</pre>

<p>
<code>let</code> nada mais é que um  <i>macro</i> para criação de contextos <i>léxicos</i>, sendo
portanto   equivalente  à   aplicação  de   uma  clausura,   de  forma
não-explícita.  Isso significa  que <code>my-function</code>  será executada  em um
contexto  léxico  que  realiza  <i>sombreamento</i> da  definição  global  de
<code>*my-value*</code>.
</p>

<p>
Este  exemplo mostra  uma situação  onde, após  <code>my-function</code> falhar  ao
tentar  encontrar <code>*my-value*</code>  no escopo  léxico que  captura, a  mesma
verifica o escopo  em que foi <i>invocada</i>, antes de  realizar uma procura
por <code>*my-value*</code> no escopo global.
</p>

<p>
Dizemos,  portanto,  que  <code>*my-value*</code> foi  dinamicamente  definida  com
relação a <code>my-function</code>, podendo  influenciar recursivamente na execução
dessa  clausura. Todavia,  não  há definição  explícita  de um  <i>escopo
dinâmico</i>, sendo  este tão somente  relacionado à forma  como clausuras
são  aplicadas,  e  a  como <code>*my-value*</code>  foi  localmente  redefinida  e
acessada.
</p>

<p>
Na  prática, durante  a  invocação de  <code>my-function</code>,  esta realiza  uma
<b>mescla</b> entre  seu escopo léxico  (após a  extensão) e o  escopo léxico
onde a mesma foi invocada. Esse  processo de mescla é chamado de <b>união
de contextos</b>, e deve garantir que os símbolos ligados no escopo léxico
capturado e extendido tenham precedência de consulta sobre os símbolos
ligados no escopo onde a clausura foi invocada.
</p>

<p>
Assim,  ainda  que  possamos  falar   em  <i>escopo  dinâmico</i>  para  fins
didáticos, o mesmo  trata-se de uma pequena modificação  na forma como
uma clausura lida com seu próprio escopo.
</p>
</div>
</div>

<div id="outline-container-orga5ff9f8" class="outline-3">
<h3 id="orga5ff9f8"><span class="section-number-3">9.4.</span> Mutabilidade</h3>
<div class="outline-text-3" id="text-9-4">
<p>
Majestic Lisp provê  formas de modificar certos  valores ou variáveis,
principalmente através das formas especiais <code>set</code>, <code>set-car</code> e <code>set-cdr</code>. As
duas  últimas  modificam  os  valores que  compõem  uma  célula  <i>cons</i>,
enquanto <code>set</code> é responsável por modificar a associação entre um símbolo
e um valor.
</p>

<p>
A  forma especial  <code>set</code> é,  portanto, responsável  pela modificação  do
valor associado a um certo identificador, em um contexto específico.
</p>

<p>
Redefinir o valor associado a um identificador não modifica o valor em
questão, apenas utiliza  um novo valor da linguagem  para substituir o
valor que ali estava associado.
</p>

<p>
O contexto modificado  pelo uso de <code>set</code>  é dado pelo contexto  em que a
variável em questão estiver alocada.  Desta forma, pode-se alterar uma
variável local, capturada pelo escopo  da função, global, ou até mesmo
dinâmica.
</p>

<pre class="example" id="org68e9619">
&gt; (def x 5)
x

&gt; x
5

&gt; (set x 9)
x

&gt; x
9

&gt; (let ((x 12))
    (set x (1+ x))
    x)
13

&gt; (defn mutate-x ()
    (set x (+ x 2))
    x)
mutate-x

&gt; (mutate-x)
11

&gt; (let ((x 12))
    (mutate-x))
14

&gt; x
11

&gt; (let ((x 12))
    (defn mutate-x-local ()
      (set x (+ x 2))
      x))
mutate-x-local

&gt; (mutate-x-local)
14

&gt; x
11

&gt; (mutate-x-local)
16

&gt; x
11
</pre>

<p>
No caso específico das formas especiais <code>set-car</code> e <code>set-cdr</code>, modifica-se
uma célula <i>cons</i>, independentemente do tipo de ligação realizada para a
declaração de tal  célula.  Em outras palavras,  a variável modificada
terá seu contexto deduzido através do mesmo método empregado por <code>set</code>.
</p>

<pre class="example" id="org958aa7c">
&gt; (def x '(1 . 2))
x

&gt; x
(1 . 2)

&gt; (set-car x 5)
(5 . 2)

&gt; (set-cdr x 6)
(5 . 6)

&gt; x
(5 . 6)

&gt; (defn replace-x-elts (a b)
    (set-car x a)
    (set-cdr x b)
    x)
replace-x-elts

&gt; (let ((x '(9 . 10)))
    (replace-x-elts 20 90))
(20 . 90)

&gt; x
(5 . 6)

&gt; (replace-x-elts 30 45)
(30 . 45)

&gt; x
(30 . 45)

&gt; (let ((x '(9 . 10)))
    (defn replace-x-elts-local (a b)
      (set-car x a)
      (set-cdr x b)
      x))
replace-x-elts-local

&gt; (replace-x-elts-local 13 50)
(13 . 50)

&gt; x
(30 . 45)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6064364" class="outline-2">
<h2 id="org6064364"><span class="section-number-2">10.</span> Erros</h2>
<div class="outline-text-2" id="text-10">
<p>
Em  Majestic Lisp,  erros  são sinalizados  através  de uma  expressão
literal. Por exemplo, a expressão
</p>

<pre class="example" id="org3e5db37">
(/ 1 0)
</pre>

<p>
poderá sinalizar um erro através da expressão:
</p>

<pre class="example" id="org34eedbc">
(lit error "Division by zero")
</pre>

<p>
Na  expressão  de erro,  o  primeiro  elemento,  <code>lit</code>, sinaliza  que  a
expressão inteira deverá ser interpretada para si mesma.
</p>

<p>
O segundo elemento,  <code>error</code>, sinaliza que o objeto  em questão trata-se
de um erro.
</p>

<p>
O terceiro  elemento é uma  informação textual, que  chamamos <i>formato</i>,
designando as instruções para a mensagem de erro.
</p>

<p>
Pode-se  também   adicionar  mais  elementos,  que   complementarão  a
informação a ser impressa na tela. Por exemplo, um erro da forma
</p>

<pre class="example" id="org7789c06">
(lit error "{} is not a number" nil)
</pre>

<p>
indica a intenção de que seja mostrada uma mensagem de erro como
</p>

<pre class="example" id="org5bc3c6a">
nil is not a number
</pre>

<p>
para o usuário.
</p>

<p>
Um objeto de  erro levanta uma <i>condição</i> no sistema,  o que não precisa
significar algo muito sofisticado,  mas deverá paralizar imediatamente
o processo atual de interpretação, e  então ser mostrado ao usuário. A
impressão da  mensagem de  erro na  tela fica a  cargo do  ambiente de
programação.
</p>

<p>
A  notação utilizada  na  mensagem de  erro, que  está  em formato  de
<i>string</i>, é uma  notação correspondente à utilizada  na função primitiva
<code>format</code>.
</p>

<p>
Os erros podem  ser diretamente criados através da  primitiva <code>err</code>, que
será especificada junto às funções primitivas da linguagem.
</p>
</div>
</div>

<div id="outline-container-org8ba35d6" class="outline-2">
<h2 id="org8ba35d6"><span class="section-number-2">11.</span> Axiomas</h2>
<div class="outline-text-2" id="text-11">
</div>
<div id="outline-container-org7398c10" class="outline-3">
<h3 id="org7398c10"><span class="section-number-3">11.1.</span> Variáveis e constantes</h3>
<div class="outline-text-3" id="text-11-1">
</div>
<div id="outline-container-orgaa45278" class="outline-4">
<h4 id="orgaa45278"><span class="section-number-4">11.1.1.</span> Símbolos auto-interpretáveis</h4>
<div class="outline-text-4" id="text-11-1-1">
<p>
Alguns símbolos são  interpretáveis como si mesmos. Este é  o caso dos
símbolos <code>nil</code>, <code>t</code>, <code>&amp;</code> e <code>apply</code>.
</p>
</div>
</div>

<div id="outline-container-org53ad12f" class="outline-4">
<h4 id="org53ad12f"><span class="section-number-4">11.1.2.</span> Caracteres</h4>
<div class="outline-text-4" id="text-11-1-2">
<p>
Caracteres  também são  símbolos  auto-interpretáveis; o  valor de  um
caractere é sempre ele mesmo.
</p>
</div>
</div>

<div id="outline-container-orgdce789d" class="outline-4">
<h4 id="orgdce789d"><span class="section-number-4">11.1.3.</span> Números</h4>
<div class="outline-text-4" id="text-11-1-3">
<p>
Números   originalmente  poderiam   ser   enquadrados  como   símbolos
especiais,  mas em  Majestic Lisp,  compreendemos o  número como  algo
separado e igualmente auto-interpretável.
</p>
</div>
</div>

<div id="outline-container-org0f91f7c" class="outline-4">
<h4 id="org0f91f7c"><span class="section-number-4">11.1.4.</span> Constantes globais</h4>
<div class="outline-text-4" id="text-11-1-4">
</div>
<ol class="org-ol">
<li><a id="org02a3f47"></a><code>*stdin*</code><br />
<div class="outline-text-5" id="text-11-1-4-1">
<p>
Referencia, por padrão, o stream padrão de entrada da aplicação.
</p>

<p>
Normalmente, este  stream está relacionado à  digitação de informações
da parte do usuário, em um terminal.
</p>

<p>
Como  este  stream  está  relacionado ao  processo  do  programa,  sua
implementação é livre,  desde que se adeque ao  vocabulário de streams
comuns. Todavia, <code>*stdin*</code>  é um stream que <b>nunca  poderá ser encerrado</b>,
de forma  que seu tempo  de vida esteja atrelado  ao tempo de  vida da
execução do interpretador de Majestic Lisp.
</p>
</div>
</li>

<li><a id="org01cfca9"></a><code>*stdout*</code><br />
<div class="outline-text-5" id="text-11-1-4-2">
<p>
Referencia, por padrão, o stream padrão de saída da aplicação.
</p>

<p>
Normalmente,  este stream  está relacionado  à escrita  de informações
pelo interpretador, em um terminal.
</p>

<p>
Como  este  stream  está  relacionado ao  processo  do  programa,  sua
implementação é livre,  desde que se adeque ao  vocabulário de streams
comuns. Todavia, <code>*stdout*</code> é um  stream que <b>nunca poderá ser encerrado</b>,
de forma  que seu tempo  de vida esteja atrelado  ao tempo de  vida da
execução do interpretador de Majestic Lisp.
</p>
</div>
</li>

<li><a id="org015daa0"></a><code>*stderr*</code><br />
<div class="outline-text-5" id="text-11-1-4-3">
<p>
Referencia, por padrão, o stream de saída de erros da aplicação.
</p>

<p>
Normalmente,  este  stream  está  relacionado à  escrita  de  erros  e
avisos.
</p>

<p>
Como  este  stream  está  relacionado ao  processo  do  programa,  sua
implementação é livre,  desde que se adeque ao  vocabulário de streams
comuns. Todavia, <code>*stderr*</code> é um  stream que <b>nunca poderá ser encerrado</b>,
de forma  que seu tempo  de vida esteja atrelado  ao tempo de  vida da
execução do interpretador de Majestic Lisp.
</p>
</div>
</li>

<li><a id="org9abe479"></a><code>*ulps*</code><br />
<div class="outline-text-5" id="text-11-1-4-4">
<p>
Enumera um  número inteiro  positivo, expressando a  quantidade mínima
de  números <code>float</code>  representáveis entre  dois números  <code>float</code> de  mesmo
sinal, para que estes sejam considerados aproximadamente iguais.
</p>

<p>
Seu nome  está relacionado às  expressões <i>units of least  precision</i> ou
<i>units in the last place</i>.
</p>

<p>
Por padrão, corresponde ao número inteiro <code>3</code>. Para maiores informações,
veja a descrição da função <code>float=</code>.
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org52409f7" class="outline-3">
<h3 id="org52409f7"><span class="section-number-3">11.2.</span> Quote</h3>
</div>

<div id="outline-container-orgf04cd8e" class="outline-3">
<h3 id="orgf04cd8e"><span class="section-number-3">11.3.</span> Funções Primitivas</h3>
<div class="outline-text-3" id="text-11-3">
<p>
Funções primitivas podem ser chamadas como funções, todavia, assume-se
que já  existam, sem  que precisem ser  definidas com  código Majestic
Lisp. Assim  como ocorre  nas chamadas de  funções, os  <i>argumentos</i> nas
chamadas de  primitivas são  completamente interpretados,  da esquerda
para a direita.
</p>
</div>

<div id="outline-container-orgc8de040" class="outline-4">
<h4 id="orgc8de040"><span class="section-number-4">11.3.1.</span> Convenções</h4>
<div class="outline-text-4" id="text-11-3-1">
<p>
Por convenção, argumentos faltantes  ao fim da <i>lambda-list</i> equivalerão
a  <code>nil</code>.  Em contrapartida,  argumentos  extras  serão considerados  um
erro.
</p>

<p>
Ademais,  funções  que  enquadram-se  como <i>predicados</i>  (ou  seja,  que
produzem um resultado  <i>verdadeiro</i> ou <i>falso</i> de acordo com  uma lista de
argumentos)  normalmente terminam  seus  nomes com  o  caractere <code>p</code>,  à
exceção dos predicados <code>eq</code> e <code>id</code>, por razões históricas.
</p>
</div>
</div>

<div id="outline-container-org4ae11eb" class="outline-4">
<h4 id="org4ae11eb"><span class="section-number-4">11.3.2.</span> <code>(symbolp x)</code></h4>
<div class="outline-text-4" id="text-11-3-2">
<p>
Informa se <code>x</code> é um símbolo ou  não. <code>t</code> é retornado em caso afirmativo, e
<code>nil</code> em caso negativo.
</p>

<pre class="example" id="org51576ab">
&gt; (symbolp t)
t

&gt; (symbolp 2/3)
nil
</pre>
</div>
</div>

<div id="outline-container-org7b53e1e" class="outline-4">
<h4 id="org7b53e1e"><span class="section-number-4">11.3.3.</span> <code>(eq x y)</code></h4>
<div class="outline-text-4" id="text-11-3-3">
<p>
Informa se <code>x</code> e <code>y</code> são símbolos <i>equivalentes</i>. A comparação só realmente
ocorre se  <code>x</code> e <code>y</code>  forem especificamente  símbolos. Caso ambos  sejam o
mesmo símbolo, <code>t</code> é retornado; caso algum de ambos não seja símbolo ou,
se forem, caso não sejam idênticos, retorna-se <code>nil</code>.
</p>

<pre class="example" id="orgda30fc1">
&gt; (eq t t)
t

&gt; (eq nil nil)
t

&gt; (eq t nil)
nil

&gt; (eq 20 t)
nil
</pre>
</div>
</div>

<div id="outline-container-org60e8471" class="outline-4">
<h4 id="org60e8471"><span class="section-number-4">11.3.4.</span> <code>(nilp x)</code></h4>
<div class="outline-text-4" id="text-11-3-4">
<p>
Informa se <code>x</code> é <i>equivalente</i> a <code>nil</code>.  <code>t</code> é retornado em caso afirmativo, e
<code>nil</code> em caso negativo.
</p>

<p>
Pode-se  convencionar que  o comportamento  da chamada  <code>(nilp x)</code>  seja
exatamente o mesmo de <code>(eq x)</code> ou <code>(eq x nil)</code>.
</p>

<pre class="example" id="org1c57883">
&gt; (nilp nil)
t

&gt; (nilp 5)
nil
</pre>
</div>
</div>

<div id="outline-container-org1cd6160" class="outline-4">
<h4 id="org1cd6160"><span class="section-number-4">11.3.5.</span> <code>(consp x)</code></h4>
<div class="outline-text-4" id="text-11-3-5">
<p>
Informa se <code>x</code> é  uma célula <i>cons</i>.  <code>t</code> é retornado  em caso afirmativo, e
<code>nil</code> em caso negativo.
</p>

<pre class="example" id="orgf31f722">
&gt; (consp (cons 2 3))
t

&gt; (consp '(a . b))
t

&gt; (consp 10)
nil
</pre>
</div>
</div>

<div id="outline-container-org872a8b7" class="outline-4">
<h4 id="org872a8b7"><span class="section-number-4">11.3.6.</span> <code>(atomp x)</code></h4>
<div class="outline-text-4" id="text-11-3-6">
<p>
Informa se  <code>x</code> é  um <i>átomo</i>.  Convenciona-se que,  para todo  e qualquer
objeto que  não seja uma  célula <i>cons</i>, tal objeto  será um <i>átomo</i>.  <code>t</code> é
retornado em caso afirmativo, e <code>nil</code> em caso negativo.
</p>

<pre class="example" id="orgb511acd">
&gt; (atomp 1)
t

&gt; (atomp 'a)
t

&gt; (atomp '(1 2 3))
nil
</pre>
</div>
</div>

<div id="outline-container-orgfd7d30f" class="outline-4">
<h4 id="orgfd7d30f"><span class="section-number-4">11.3.7.</span> <code>(charp x)</code></h4>
<div class="outline-text-4" id="text-11-3-7">
<p>
Informa se <code>x</code> é  um caractere. <code>t</code> é retornado em  caso afirmativo, e <code>nil</code>
em caso negativo.
</p>

<pre class="example" id="org1ee7ca9">
&gt; (charp #\a)
t

&gt; (charp t)
nil
</pre>
</div>
</div>

<div id="outline-container-org58911f1" class="outline-4">
<h4 id="org58911f1"><span class="section-number-4">11.3.8.</span> <code>(char= x y)</code></h4>
<div class="outline-text-4" id="text-11-3-8">
<p>
Compara pela igualdade de dois caracteres.
</p>

<p>
Caso algum dos objetos não seja um caractere, retorna um erro.
</p>

<pre class="example" id="orgaac5ddd">
&gt; (char= #\a #\a)
t

&gt; (char= #\a #\A)
nil

&gt; (char= #\a t)
(lit error "{} is not a character" t)

&gt; (char= nil #\bel)
(lit error "{} is not a character" nil)
</pre>
</div>
</div>

<div id="outline-container-org9578239" class="outline-4">
<h4 id="org9578239"><span class="section-number-4">11.3.9.</span> <code>(streamp x)</code></h4>
<div class="outline-text-4" id="text-11-3-9">
<p>
Informa se <code>x</code> é um <i>stream</i>.  <code>t</code>  é retornado em caso afirmativo, e <code>nil</code> em
caso negativo.
</p>

<pre class="example" id="org22929b3">
&gt; (streamp (open-stream 'out "/home/user/file.txt"))
t

&gt; (streamp *stdout*)
t

&gt; (streamp t)
nil
</pre>
</div>
</div>

<div id="outline-container-org44a74d1" class="outline-4">
<h4 id="org44a74d1"><span class="section-number-4">11.3.10.</span> <code>(numberp x)</code></h4>
<div class="outline-text-4" id="text-11-3-10">
<p>
Informa se  <code>x</code> é um  <i>número</i>. Esse predicado  diz respeito a  números em
geral, não efetuando distinção de subtipos numéricos.
</p>

<pre class="example" id="orgf2656d0">
&gt; (numberp 2)
t

&gt; (numberp .5)
t

&gt; (numberp 2/3)
t

&gt; (numberp 0j2.)
t

&gt; (numberp t)
nil
</pre>

<p>
A seguir, descreveremos alguns predicados  que fazem a distinção entre
subtipos numéricos.
</p>
</div>

<ol class="org-ol">
<li><a id="org1ff372f"></a><code>(integerp x)</code><br />
<div class="outline-text-5" id="text-11-3-10-1">
<p>
Informa se <code>x</code> é um número  <i>inteiro</i>.  Esse predicado realiza a avaliação
de <code>x</code> para identificar se o mesmo é um número e, caso o seja, avalia se
trata-se de  um número inteiro.  <code>t</code>  é retornado em caso  afirmativo, e
<code>nil</code> em caso negativo.
</p>

<pre class="example" id="orgd64bd16">
&gt; (integerp 2)
t

&gt; (integerp 2/3)
nil
</pre>
</div>
</li>

<li><a id="org6cabc62"></a><code>(floatp x)</code><br />
<div class="outline-text-5" id="text-11-3-10-2">
<p>
Informa se <code>x</code> é um <i>ponto flutuante</i>.  Esse predicado realiza a avaliação
de <code>x</code> para identificar se o mesmo é um número e, caso o seja, avalia se
trata-se de um  ponto flutuante.  <code>t</code> é retornado em  caso afirmativo, e
<code>nil</code> em caso negativo.
</p>

<pre class="example" id="org223fc83">
&gt; (floatp 2.5)

&gt; (floatp 2.)
t

&gt; (floatp .5)
t

&gt; (floatp 3)
nil
</pre>
</div>
</li>

<li><a id="org4126cd8"></a><code>(fractionp x)</code><br />
<div class="outline-text-5" id="text-11-3-10-3">
<p>
Informa se  <code>x</code> é uma <i>fração</i>.   Esse predicado realiza a  avaliação de <code>x</code>
para identificar  se o  mesmo é um  número e, caso  o seja,  avalia se
trata-se de um número fracionário.   <code>t</code> é retornado em caso afirmativo,
e <code>nil</code> em caso negativo.
</p>

<pre class="example" id="org5b01047">
&gt; (fractionp 2/3)
t

&gt; (fractionp 5/9)
t

&gt; (fractionp 8)
nil
</pre>
</div>
</li>

<li><a id="orgbf21573"></a><code>(complexp x)</code><br />
<div class="outline-text-5" id="text-11-3-10-4">
<p>
Informa se <code>x</code> é um número <i>complexo</i>.  Esse predicado realiza a avaliação
de <code>x</code> para identificar se o mesmo é um número e, caso o seja, avalia se
trata-se de um  número complexo.  <code>t</code> é retornado em  caso afirmativo, e
<code>nil</code> em caso negativo.
</p>

<pre class="example" id="orge86784c">
&gt; (complexp .5J1)
t

&gt; (complexp -10J-3)
t

&gt; (complexp 5)
nil

&gt; (complexp 5J0)
nil

&gt; (complexp 5J0.)
t
</pre>

<p>
Os dois últimos casos acima podem parecer peculiares do ponto de vista
do que  fazem, mas são  bastante triviais.  O número <code>5J0</code>  é convertido
para  <code>5</code>  (número  inteiro),  devido  à  nulidade  de  seu  coeficiente
imaginário. Em  <code>5J0.</code>, porém, que  é também equivalente a  <code>5J0.0</code>, ainda
que sua parte imaginária seja  tecnicamente nula, devido à condição de
não-comparação por nulidade em coerções de pontos flutuantes, inibe-se
que  o número  complexo como  um todo  seja convertido  para o  número
inteiro <code>5</code>.
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgca253f5" class="outline-4">
<h4 id="orgca253f5"><span class="section-number-4">11.3.11.</span> <code>(vectorp x)</code></h4>
<div class="outline-text-4" id="text-11-3-11">
<p>
Informa se <code>x</code>  é um vetor. <code>t</code>  é retornado em caso afirmativo,  e <code>nil</code> em
caso negativo.
</p>

<pre class="example" id="org3db6dff">
&gt; (vectorp [1 2 3])
t

&gt; (vectorp t)
nil
</pre>
</div>
</div>

<div id="outline-container-org1e83056" class="outline-4">
<h4 id="org1e83056"><span class="section-number-4">11.3.12.</span> <code>(id x y)</code></h4>
<div class="outline-text-4" id="text-11-3-12">
<p>
Informa se <code>x</code> e <code>y</code> são <i>idênticos</i>, ou sejam, se são objetos que habitam o
mesmo lugar na memória da máquina.
</p>

<p>
A  ideia de  <i>identidade</i>  é  mais rigorosa  que  a  <i>igualdade</i>, e  menos
específica que a <i>equivalência</i>. Enquanto pode-se dizer que há apenas um
de  cada símbolo  ou caractere,  pode  haver um  número gigantesco  de
células  <i>cons</i>  que não  sejam  <i>idênticas</i>,  mas  que tenham  <i>os  mesmos
elementos</i>.
</p>

<pre class="example" id="org9d44253">
&gt; (id 'a 'a)
t

&gt; (id #\c #\c)
t

&gt; (id '(a b) '(a b))
nil
</pre>

<p>
Igualmente,  pode  ser também  que  dois  números sejam  numericamente
iguais, mas sejam objetos diferentes.
</p>

<pre class="example" id="orgae6261a">
&gt; (id 5 5)
nil
</pre>

<p>
Esse  comportamento  ocorre  porque  a <i>identidade</i>  trata  de  comparar
diretamente  dois  objetos.  Enquanto  símbolos  e  caracteres  têm  a
<i>identidade</i> verificada de forma diferente,  outros tipos de objetos são
comparados de  acordo com sua  localização na memória: caso  não sejam
símbolos ou caracteres, dois objetos  serão <i>idênticos</i> se referem-se ao
exato mesmo espaço de memória.
</p>

<p>
Para  realizar  comparações  por   <i>igualdade</i>,  em  especial  de  forma
aritmética, recomenda-se utilizar a função <code>=</code> em vez de <code>id</code>.
</p>

<p>
Para uma identidade,  <code>t</code> é retornado em caso afirmativo,  e <code>nil</code> em caso
negativo.
</p>
</div>
</div>

<div id="outline-container-org9c0522d" class="outline-4">
<h4 id="org9c0522d"><span class="section-number-4">11.3.13.</span> <code>(proper-list-p x)</code></h4>
<div class="outline-text-4" id="text-11-3-13">
<p>
Informa se <code>x</code> é uma <i>lista adequada</i>.
</p>

<p>
Como anteriormente  citado, uma  lista adequada  é um  encadeamento de
células <i>cons</i>, de tal forma que  iniciemos em uma célula <i>cons</i> qualquer,
indicando o primeiro elemento da lista, e verifique-se que o <code>cdr</code> dessa
célula seja outro  <i>cons</i>, ou seja o símbolo <code>nil</code>.  Caso seja outro <i>cons</i>,
deve-se   verificar    essa   mesma    condição   para    tal   célula
recém-descoberta.  <code>t</code> é  retornado em  caso afirmativo,  e <code>nil</code>  em caso
negativo.
</p>

<pre class="example" id="org7d57e2b">
&gt; (proper-list-p '(a b c d))
t

&gt; (proper-list-p '(a b c . d))
nil
</pre>
</div>
</div>

<div id="outline-container-org6de9649" class="outline-4">
<h4 id="org6de9649"><span class="section-number-4">11.3.14.</span> <code>(stringp x)</code></h4>
<div class="outline-text-4" id="text-11-3-14">
<p>
Informa se <code>x</code> é uma <i>string</i>.
</p>

<p>
Strings são  vetores de caracteres  &#x2013; em outras palavras,  vetores de
tipo <code>char</code>.
</p>

<p>
Caso  <code>x</code>  seja  uma string,  <code>t</code>  é  retornado.   Caso  não seja,  <code>nil</code>  é
retornado.
</p>

<pre class="example" id="orgccadbdb">
&gt; (stringp (vector #\a #\b #\c))
t

&gt; (stringp [#\a #\b #\c])
t

&gt; (stringp "abc")
t

&gt; (stringp '(#\a #\b #\c))
nil

&gt; (stringp (vec-coerce 'any [#\a #\b #\c]))
nil

&gt; (stringp t)
nil
</pre>
</div>
</div>

<div id="outline-container-orgc6bf322" class="outline-4">
<h4 id="orgc6bf322"><span class="section-number-4">11.3.15.</span> <code>(literalp x)</code></h4>
<div class="outline-text-4" id="text-11-3-15">
<p>
Informa se <code>x</code> é um <i>literal</i>.
</p>

<p>
Literais são listas adequadas que são iniciadas pelo símbolo <code>lit</code>. Tais
listas nunca  são recursivamente interpretadas; tentar  interpretar um
literal resulta nele mesmo como valor de retorno.
</p>

<p>
Caso  <code>x</code>  seja  um  literal,  <code>t</code>  é retornado.  Caso  não  seja,  <code>nil</code>  é
retornado.
</p>

<pre class="example" id="org4568074">
&gt; (literalp (fn (x) (* x x)))
t

&gt; (literalp '(a b c))
nil

&gt; (literalp (lit blah))
t
</pre>
</div>
</div>

<div id="outline-container-org82f6c4e" class="outline-4">
<h4 id="org82f6c4e"><span class="section-number-4">11.3.16.</span> <code>(primitivep x)</code></h4>
<div class="outline-text-4" id="text-11-3-16">
<p>
Informa se <code>x</code> é uma <i>função primitiva</i>.
</p>

<p>
Funções primitivas são  similares a clausuras no sentido  de que podem
ser   <i>aplicadas</i>   a   argumentos,  porém   não   classificam-se   como
clausuras. Em  outras palavras, pressupõe-se que  uma primitiva esteja
presente  na  linguagem  durante  o  tempo  de  vida  da  execução  do
interpretador.
</p>

<p>
Assimo  como  no  caso  das clausuras,  primitivas  são  identificadas
internamente como literais. Por exemplo, a função primitiva <code>primitivep</code>
em si  é interpretada  para um literal  <code>(lit prim  primitivep)</code>. Assim,
identifica-se uma  <i>primitiva</i> pelo valor  da consulta do seu  nome, que
envolve o símbolo <code>prim</code> como segundo elemento da lista.
</p>

<p>
Caso  <code>x</code> seja  uma primitiva,  <code>t</code>  é retornado.   Caso não  seja, <code>nil</code>  é
retornado.
</p>

<pre class="example" id="org2bcccd7">
&gt; (primitivep primitivep)
t

&gt; (primitivep (fn (x) (+ x x)))
nil

&gt; (primitivep +)
t
</pre>
</div>
</div>

<div id="outline-container-orgc1beee0" class="outline-4">
<h4 id="orgc1beee0"><span class="section-number-4">11.3.17.</span> <code>(closurep x)</code></h4>
<div class="outline-text-4" id="text-11-3-17">
<p>
Informa se <code>x</code> é uma <i>clausura</i>.
</p>

<p>
Clausuras são literais gerados pelo  resultado de interpretação de uma
função  do usuário.  Especifica-se que  seja uma  clausura através  do
segundo símbolo  da lista  que identifica  tal literal;  este elemento
deverá ser o símbolo <code>closure</code>.
</p>

<p>
Em geral, clausuras  possuem a peculiaridade de  não misturarem-se com
primitivas.  Portanto,  uma função  primitiva  não  é considerada  uma
clausura.
</p>

<p>
Caso  <code>x</code>  seja uma  clausura,  <code>t</code>  é retornado.  Caso  não  seja, <code>nil</code>  é
retornado.
</p>

<pre class="example" id="orgd6cf112">
&gt; (closurep (fn (x) (* x x)))
t

&gt; (closurep (lit blah))
nil

&gt; (closurep cons)
nil

&gt; (closurep +)
nil
</pre>
</div>
</div>

<div id="outline-container-org93c8e44" class="outline-4">
<h4 id="org93c8e44"><span class="section-number-4">11.3.18.</span> <code>(functionp x)</code></h4>
<div class="outline-text-4" id="text-11-3-18">
<p>
Informa se <code>x</code>  é uma função. Uma possível  implementação para <code>functionp</code>
poderia ser:
</p>

<pre class="example" id="org856e906">
(defn functionp (f)
  (or (primitivep f)
      (closurep f)))
</pre>

<p>
A alcunha <i>função</i> deverá ser compreendida como um nome generalizado que
define  <i>funções primitivas</i>  ou  <i>clausuras</i>; em  outras palavras,  ambos
estes tipos de objetos compreendem <i>funções</i>.
</p>

<p>
Esta função, portanto,  retorna <code>t</code> caso <code>x</code> seja uma  função primitiva ou
uma clausura, e retorna <code>nil</code> em situação contrária.
</p>

<pre class="example" id="org13accd1">
&gt; (functionp (fn (x) (* x x)))
t

&gt; (functionp +)
t

&gt; (functionp cons)
t

&gt; (functionp (lit blah))
nil
</pre>
</div>
</div>

<div id="outline-container-org668ddeb" class="outline-4">
<h4 id="org668ddeb"><span class="section-number-4">11.3.19.</span> <code>(macrop x)</code></h4>
<div class="outline-text-4" id="text-11-3-19">
<p>
Informa se <code>x</code> é um <i>macro</i>.
</p>

<p>
Macros são literais  gerados pelo resultado de  interpretação da forma
especial <code>mac</code>, que são capazes  de manipular expressões e reescrevê-las
para  que sejam,  subsequencialmente, interpretadas.  Especifica-se um
macro através do segundo símbolo  da lista que identifica tal literal;
este elemento deverá ser o símbolo <code>macro</code>.
</p>

<p>
Macros  englobam uma  <i>clausura</i>  subjacente em  sua criação,  portanto,
pode-se compreender  o terceiro elemento  de um literal de  macro como
sendo tal clausura. Esta clausura  é responsável por receber dados que
não  serão interpretados  antes de  serem repassados,  e portanto,  um
<i>macro</i> nada  mais é que uma  função especial que manipula  sintaxe para
que possa ser interpretada, de forma subsequente.
</p>

<p>
Caso <code>x</code> seja um macro, <code>t</code> é retornado. Caso não seja, <code>nil</code> é retornado.
</p>

<pre class="example" id="org6a2da7d">
&gt; (macrop (mac (x) `(list ,x)))
t

&gt; (macrop until)
t

&gt; (macrop (lit blah))
nil

&gt; (macrop cons)
nil

&gt; (macrop +)
nil
</pre>
</div>
</div>

<div id="outline-container-orgf69c3a8" class="outline-4">
<h4 id="orgf69c3a8"><span class="section-number-4">11.3.20.</span> <code>(errorp x)</code></h4>
<div class="outline-text-4" id="text-11-3-20">
<p>
Informa se <code>x</code> é um objeto de <i>erro</i>.
</p>

<p>
Erros  assemelham-se  a  clausuras  e primitivas,  porque  são  também
<i>literais</i>. Um erro pode ser identificado através do segundo elemento de
sua literal, que será sempre o símbolo <code>error</code>.
</p>

<p>
Caso <code>x</code> seja  um objeto de erro,  <code>t</code> é retornado.  Caso não  seja, <code>nil</code> é
retornado.
</p>

<pre class="example" id="org55dcc4f">
&gt; (errorp (err "Some error"))
t

&gt; (errorp (lit error "Some other error"))
t

&gt; (errorp 2)
nil
</pre>
</div>
</div>

<div id="outline-container-org032b9a0" class="outline-4">
<h4 id="org032b9a0"><span class="section-number-4">11.3.21.</span> <code>(cons x y)</code></h4>
<div class="outline-text-4" id="text-11-3-21">
<p>
Retorna  uma nova  célula  <i>cons</i> cuja  primeira metade  seja  <code>x</code> e  cuja
segunda metade seja <code>y</code>.
</p>

<pre class="example" id="orgbd07a25">
&gt; (cons 'a 'b)
(a . b)

&gt; (cons 1 2)
(1 . 2)
</pre>

<p>
Uma nova  célula <i>cons</i> não  será idêntica  (<code>id</code>) a nenhuma  outra célula
<i>cons</i> existente.
</p>
</div>
</div>

<div id="outline-container-org6c04c37" class="outline-4">
<h4 id="org6c04c37"><span class="section-number-4">11.3.22.</span> <code>(car x)</code></h4>
<div class="outline-text-4" id="text-11-3-22">
<p>
Retorna a primeira metade de uma célula <i>cons</i>.
</p>

<pre class="example" id="org720424d">
&gt; (car '(a . b))
a

&gt; (car (cons 'c 'd))
c
</pre>

<p>
Especificamente para o símbolo <code>nil</code>, seu <code>car</code> é <code>nil</code>.
</p>

<pre class="example" id="org250e94e">
&gt; (car nil)
nil
</pre>

<p>
Historicamente,  <i>car</i> refere-se  a "conteúdo  da parte  de endereço  do
número  no registrador"  (<i>Contents  of the  Address  part of  Register
number</i>). Esse nome legado refere-se à implementação original de LISP,
feita em um IBM 704 no final da década de 1950, por John McCarthy e
associados<sup><a id="fnr.3" class="footref" href="#fn.3" role="doc-backlink">3</a></sup>.
</p>
</div>
</div>

<div id="outline-container-org5a0b28f" class="outline-4">
<h4 id="org5a0b28f"><span class="section-number-4">11.3.23.</span> <code>(cdr x)</code></h4>
<div class="outline-text-4" id="text-11-3-23">
<p>
Retorna a segunda metade de uma célula <i>cons</i>.
</p>

<pre class="example" id="org18c6a00">
&gt; (cdr '(a . b))
b

&gt; (cdr (cons 'c 'd))
d
</pre>

<p>
Assim como em <code>car</code>, para o símbolo <code>nil</code>, seu <code>cdr</code> é <code>nil</code>.
</p>

<pre class="example" id="orgf2a2547">
&gt; (cdr nil)
nil
</pre>

<p>
Como  igualmente explicado  em  <code>car</code>, o  nome <i>cdr</i>  é  histórico, e  diz
respeito ao "conteúdo da parte de decremento do número no registrador"
(<i>Contents of the Decrement part of Register number</i>).
</p>
</div>
</div>

<div id="outline-container-orgc24a07a" class="outline-4">
<h4 id="orgc24a07a"><span class="section-number-4">11.3.24.</span> <code>(copy x)</code></h4>
<div class="outline-text-4" id="text-11-3-24">
<p>
Retorna uma cópia rasa  de uma célula <i>cons</i> <code>x</code>. Se <code>x</code>  não for uma célula
<i>cons</i>, retorna um erro.
</p>

<p>
A  função  cria uma  nova  célula  <i>cons</i>, garantidamente  diferente  de
quaisquer  outras células  <i>cons</i>  anteriormente  criadas. Todavia,  seu
conteúdo (<i>car</i> e <i>cdr</i>) não  será copiado, permanecendo os mesmos objetos
do <code>x</code> original.
</p>

<pre class="example" id="org41849f5">
&gt; (def x (cons 'a 'b))
x

&gt; (def y (copy x))
y

&gt; x
(a . b)

&gt; y
(a . b)

&gt; (id x y)
nil

&gt; (and (id (car x) (car y))
       (id (cdr x) (cdr y)))
t

&gt; (copy t)
(lit error "{} is not a cons cell" t)
</pre>
</div>
</div>

<div id="outline-container-orgb565c52" class="outline-4">
<h4 id="orgb565c52"><span class="section-number-4">11.3.25.</span> <code>(length x)</code></h4>
<div class="outline-text-4" id="text-11-3-25">
<p>
Retorna um número <i>inteiro</i> correspondente  à quantidade de elementos em
uma  <i>lista</i>.
</p>

<p>
Se o  objeto for uma lista  pontuada, considera-se o tamanho  da mesma
até o <i>cdr</i> contendo um átomo.
</p>

<p>
Se o  objeto for uma lista  adequada, procede-se da mesma  maneira até
que <code>nil</code> seja encontrado.
</p>

<p>
Caso o objeto em questão não seja uma <i>lista</i>, será levantado um erro no
sistema.
</p>

<pre class="example" id="org4194155">
&gt; (length '(1 2 3 4))
4

&gt; (length '(a b c))
3

&gt; (length nil)
0

&gt; (length 'a)
(lit error "{} is not a proper list" a)

&gt; (length '(1 2 . 3))
2
</pre>
</div>
</div>

<div id="outline-container-orga57edce" class="outline-4">
<h4 id="orga57edce"><span class="section-number-4">11.3.26.</span> <code>(depth x)</code></h4>
<div class="outline-text-4" id="text-11-3-26">
<p>
Retorna  um   número  inteiro   correspondente  ao  nível   máximo  de
aninhamentos em uma lista.
</p>

<p>
Se o objeto for um átomo, será levantado um erro no sistema.
</p>

<p>
Do contrário, a função recorre sobre a estrutura das células <i>cons</i>. Uma
sublista  será considerada  como tendo  profundidade se  e somente  se
possuir pelo menos um elemento.
</p>

<pre class="example" id="orgc0363a9">
&gt; (depth 1)
(lit error "{} is an atom" 1)

&gt; (depth '())
0

&gt; (depth '(()))
1

&gt; (depth '((1)))
2

&gt; (depth '(1 2 3 4 5))
5

&gt; (depth '(1 2 3 4 5 6))
6

&gt; (depth '(1 2 3 4 5 . 6))
5
</pre>
</div>
</div>

<div id="outline-container-org965085e" class="outline-4">
<h4 id="org965085e"><span class="section-number-4">11.3.27.</span> <code>(type x)</code></h4>
<div class="outline-text-4" id="text-11-3-27">
<p>
Retorna um símbolo que indique o <i>tipo</i> de um certo objeto.
</p>

<p>
Para  os  tipos  numéricos,  que envolvem  a  ideia  intermediária  de
<i>subtipo</i>, retorna-se  a informação  mais específica a  respeito daquele
elemento.  Por exemplo,  o tipo  de <code>1/3</code>  será <code>fraction</code>,  pois isso  já
indica  implicitamente  que  o  objeto  seja  um  <code>number</code>.  Comparações
genéricas podem ser feitas com os predicados apropriados.
</p>

<pre class="example" id="org917fe9c">
&gt; (type 1)
integer

&gt; (type 2.0)
float

&gt; (type 'a)
symbol

&gt; (type nil)
symbol

&gt; (type 2/3)
fraction

&gt; (type '(a b c))
cons

&gt; (type #\L)
char

&gt; (type *stdout*)
stream

&gt; (type 1J5)
complex

&gt; (type [1 2 3])
vector
</pre>
</div>
</div>

<div id="outline-container-org30cbb4e" class="outline-4">
<h4 id="org30cbb4e"><span class="section-number-4">11.3.28.</span> <code>(intern x)</code></h4>
<div class="outline-text-4" id="text-11-3-28">
<p>
<i>Interna</i>   um  novo   símbolo   no  escopo   global   da  linguagem   e
retorna-o.  Caso o  símbolo já  exista no  escopo global,  retorne tal
símbolo. Caso a string em questão seja vazia, será retornado o símbolo
<code>nil</code>.
</p>

<p>
<code>x</code> deverá ser obrigatoriamente uma string. Essa string será o nome para
o novo símbolo em questão. Caso não seja, será retornado um erro.
</p>

<p>
É importante lembrar que o nome  de um símbolo é puramente estético do
ponto de  vista de sintaxe,  servindo portanto para designar  um único
símbolo, independente de sua implementação.
</p>

<pre class="example" id="org1b4fe83">
&gt; (intern "blah")
blah

&gt; (intern "foo")
foo

&gt; (intern "")
nil

&gt; (intern 'a)
(lit error "{} is not a string" a)
</pre>
</div>
</div>

<div id="outline-container-orgfb4b9e2" class="outline-4">
<h4 id="orgfb4b9e2"><span class="section-number-4">11.3.29.</span> <code>(name x)</code></h4>
<div class="outline-text-4" id="text-11-3-29">
<p>
Toma um  símbolo <i>interno</i> no escopo  global da linguagem e  retorna seu
nome, no formato de string. Caso <code>x</code> não seja um símbolo, será retornado
um erro.
</p>

<pre class="example" id="org7e7ab6d">
&gt; (name t)
"t"

&gt; (name 'foo)
"foo"

&gt; (name 'thing)
"thing"

&gt; (name nil)
"nil"

&gt; (name "Blah")
(lit error "{} is not a symbol" "Blah")
</pre>
</div>
</div>

<div id="outline-container-org1b38ffe" class="outline-4">
<h4 id="org1b38ffe"><span class="section-number-4">11.3.30.</span> <code>(get-environment type)</code></h4>
<div class="outline-text-4" id="text-11-3-30">
<p>
Retorna uma referência  ao contexto requisitado. Se  o contexto léxico
for requisitado no <i>top-level</i>, será retornado um contexto vazio.
</p>

<p>
<code>type</code> deve  corresponder a  um dos símbolos  <code>lexical</code> ou  <code>global</code>. Outros
símbolos ocasionarão um erro.
</p>

<p>
Note que modificar o contexto retornado poderá colocar o interpretador
em um estado  inseguro. Todavia, os contextos <i>léxico</i> e  <i>global</i> não são
<code>set</code>-áveis, ou seja,  não há local em algum contexto,  por padrão, onde
podem ser redefinidos, pois suas referências não podem ser obtidas com
consulta simples.
</p>

<pre class="example" id="org4fc1b99">
&gt; (get-environment 'global)
#&lt;environment {...}&gt;

&gt; (get-environment 'blah)
(lit error "Unknown environment type {}" blah)

&gt; (let ((x 5)
        (y 6))
    (get-environment 'lexical))
#&lt;environment {...}&gt;

&gt; (let ((x 5)
        (y 6))
    (let ((env (get-environment 'lexical)))
      (def sum-test `(lit closure ,env () ((+ x y))))))
sum-test

&gt; (sum-test)
11
</pre>
</div>
</div>

<div id="outline-container-org5f859ae" class="outline-4">
<h4 id="org5f859ae"><span class="section-number-4">11.3.31.</span> <code>(coin)</code></h4>
<div class="outline-text-4" id="text-11-3-31">
<p>
Retorna os símbolos <code>t</code> e <code>nil</code>, aleatoriamente.
</p>

<pre class="example" id="orgf41551a">
&gt; (coin)
t

&gt; (coin)
t

&gt; (coin)
nil

&gt; (coin)
t

&gt; (coin)
nil

&gt; (coin)
nil
</pre>
</div>
</div>

<div id="outline-container-org08da3d4" class="outline-4">
<h4 id="org08da3d4"><span class="section-number-4">11.3.32.</span> <code>(sys com . args)</code></h4>
<div class="outline-text-4" id="text-11-3-32">
<p>
Executa  o comando  <code>com</code>, seguido  dos  argumentos em  <code>args</code>. Tanto  <code>com</code>
quanto os elementos da lista <code>args</code> devem ser <i>strings</i>.
</p>

<p>
Caso  o comando  não possa  ser  executado por  algum motivo  anormal,
retorna  um erro.   Caso algum  dos  argumentos não  seja uma  string,
também retorna um erro.
</p>

<p>
Caso o comando  seja executado com sucesso, retorna  um número inteiro
correspondente ao código de retorno do comando.
</p>

<pre class="example" id="org17f02fd">
&gt; (sys "/bin/true")
0

&gt; (sys "/bin/false")
1

&gt; (sys "ls" "-all" "--color=never")
0
</pre>
</div>
</div>

<div id="outline-container-org3e975ff" class="outline-4">
<h4 id="org3e975ff"><span class="section-number-4">11.3.33.</span> <code>(format fmt . rest)</code></h4>
<div class="outline-text-4" id="text-11-3-33">
<p>
Retorna uma <i>string</i> contendo os elementos em <code>rest</code>, formatados segundo a
<i>string</i> de formato <code>fmt</code>.
</p>

<p>
A <i>string</i>  de formato deverá conter  zero ou mais indicadores  na forma
<code>{}</code>,  que  serão  substituídos  pela formatação  padrão  dos  elementos
contidos em <code>rest</code>, na sequência em que aparecem.
</p>

<p>
Caso  um  ou  mais  indicadores  <code>{}</code>  estejam  mal-escritos,  a  função
retornará  um  erro.  Da  mesma  forma, caso  a  função  possua  menos
argumentos, após  o formato, do  que for  esperado no mesmo,  a função
também retornará um erro.
</p>

<pre class="example" id="org831c08c">
&gt; (format "Hello world")
"Hello world"

&gt; (format "The number five: {}" 5)
"The number five: 5"

&gt; (format "The floating point {} is nice" 2.)
"The floating point 2.0 is nice"

&gt; (let ((x 1/2))
    (format "The number {} has a subtype {}"
            x
            (type x)))
"The number 1/2 has a subtype fraction"

&gt; (format "Hello {}")
(lit error "Missing arguments on format")

&gt; (format "Hello {" "World")
(lit error "Unmatched opening curly brace in {}" "Hello {")

&gt; (format "Hello }" "World")
(lit error "Unmatched closing curly brace in {}" "Hello }")
</pre>
</div>
</div>

<div id="outline-container-orgfa75b1c" class="outline-4">
<h4 id="orgfa75b1c"><span class="section-number-4">11.3.34.</span> <code>(err fmt . rest)</code></h4>
<div class="outline-text-4" id="text-11-3-34">
<p>
Cria um  objeto de  <i>erro</i>. O  retorno será um  <i>literal</i>, que  conterá um
formato e o restante dos argumentos para compor tal formato.
</p>

<p>
A string  de formato obedece à  mesma sintaxe de <code>format</code>,  sendo também
acompanhada  de tantos  objetos quanto  forem necessários  para que  a
formatação possa ser aplicada.
</p>

<pre class="example" id="orgf6b1db6">
&gt; (err "{} is not a number" t)
(lit error "{} is not a number" t)

&gt; (err "This is an error, numbers are {} and {}" 2 3)
(lit error "This is an error, numbers are {} and {}" 2 3)
</pre>
</div>
</div>

<div id="outline-container-org430f544" class="outline-4">
<h4 id="org430f544"><span class="section-number-4">11.3.35.</span> <code>(warn fmt . rest)</code></h4>
<div class="outline-text-4" id="text-11-3-35">
<p>
Mostra uma mensagem de alerta em  <code>*stderr*</code>, sucedida por uma quebra de
linha. O retorno será sempre <code>nil</code>.
</p>

<p>
A string  de formato obedece à  mesma sintaxe de <code>format</code>,  sendo também
acompanhada  de tantos  objetos quanto  forem necessários  para que  a
formatação possa ser aplicada.
</p>

<p>
Nos exemplos a seguir, a saída para o console corresponde à saída para
<code>*stderr*</code>, e não para a saída  padrão, como normalmente se apresenta em
outros exemplos.
</p>

<pre class="example" id="orgb484edc">
&gt; (warn "{} is not a number" t)
; Warning: t is not a number
;
nil

&gt; (warn "This is a warning, numbers are {} and {}" 2 3)
; Warning: This is a warning, numbers are 2 and 3
;
nil
</pre>
</div>
</div>

<div id="outline-container-org5b5ea5c" class="outline-4">
<h4 id="org5b5ea5c"><span class="section-number-4">11.3.36.</span> <code>(list . rest)</code></h4>
<div class="outline-text-4" id="text-11-3-36">
<p>
Retorna uma nova lista com  todos os elementos passados por parâmetro,
na sequência em que foram passados.
</p>

<p>
Caso nenhum elemento tenha sido passado, retornará <code>nil</code>.
</p>

<pre class="example" id="org041849f">
&gt; (list 1 2 3)
(1 2 3)

&gt; (list 'a 6 'b)
(a 6 b)

&gt; (list)
nil
</pre>
</div>
</div>

<div id="outline-container-org925d662" class="outline-4">
<h4 id="org925d662"><span class="section-number-4">11.3.37.</span> <code>(append . rest)</code></h4>
<div class="outline-text-4" id="text-11-3-37">
<p>
Retorna uma nova lista, gerada através  da anexação de todas as listas
passadas à função.
</p>

<p>
Se <code>rest</code>  é uma lista  de listas, será gerada  uma nova lista,  tal que
todos  os elementos  de cada  sublistas  sejam dispostos  na nova,  na
sequência em que as sublistas foram fornecidas.
</p>

<p>
Se o último elemento de <code>rest</code> for  um único átomo, ele se tornará o <i>cdr</i>
ao fim da lista &#x2013; isto é, o resultado será uma <i>lista pontuada</i>.
</p>

<pre class="example" id="orge2bfa6d">
&gt; (append '(1 2 3) '(4 5 6))
(1 2 3 4 5 6)

&gt; (append '(a (b c) d (e)) '(f (g h)))
(a (b c) d (e) f (g h))

&gt; (append '(a b c) 'd)
(a b c . d)
</pre>
</div>
</div>

<div id="outline-container-orga04122d" class="outline-4">
<h4 id="orga04122d"><span class="section-number-4">11.3.38.</span> <code>(last x)</code></h4>
<div class="outline-text-4" id="text-11-3-38">
<p>
Retorna  o  último   <i>cons</i> de  uma  lista.  Se   o  parâmetro  passado
inicialmente não for um <i>cons</i>, retorna um erro.
</p>

<p>
Caso a  lista passada seja uma  <i>lista pontuada</i>, retorna o  último <i>cons</i>
possível.
</p>

<pre class="example" id="org3e02bb8">
&gt; (last '(a b c d))
(d)

&gt; (last '(a b c . d))
(c . d)

&gt; (last 'a)
(lit error "{} is not a cons" a)
</pre>
</div>
</div>

<div id="outline-container-orgb89e7b5" class="outline-4">
<h4 id="orgb89e7b5"><span class="section-number-4">11.3.39.</span> <code>(reverse x)</code></h4>
<div class="outline-text-4" id="text-11-3-39">
<p>
Inverte  os elementos  de uma  lista adequada  <code>x</code>, retornando  uma nova
lista com os mesmos elementos da original.
</p>

<p>
Caso <code>x</code> não seja um <i>cons</i>, retorna  um erro. Da mesma forma, caso <code>x</code> seja
uma lista pontuada, retorna também um erro.
</p>

<pre class="example" id="orgea636cb">
&gt; (reverse '(a b c d))
(d c b a)

&gt; (reverse 'a)
(lit error "{} is not a cons" a)

&gt; (reverse '(a b c . d))
(lit error "Not a proper list: {}" (a b c . d))
</pre>
</div>
</div>

<div id="outline-container-orge43f4bf" class="outline-4">
<h4 id="orge43f4bf"><span class="section-number-4">11.3.40.</span> <code>(nthcdr n lst)</code></h4>
<div class="outline-text-4" id="text-11-3-40">
<p>
Recupera o <code>n</code>-ésimo <i>cons</i> da lista <code>lst</code>.
</p>

<p>
Os <i>cons</i>'es  começam a ser  contados a partir  de <code>0</code>.  Assim,  um número
menor  que  <code>0</code>  incorrerá  em  um erro.   Da  mesma  forma,  um  número
não-inteiro também será considerado um erro.
</p>

<p>
Se  <code>lst</code> for  uma  lista  pontuada, o  algoritmo  tentará encontrar  os
elementos até  onde for possível.  Caso o algoritmo precise  chegar ao
ponto de encontrar o  <i>cdr</i> de um objeto que não seja  <i>cons</i> ou o símbolo
<code>nil</code>, um erro será levantado.
</p>

<p>
Caso <code>n</code> corresponda a um índice  maior que o índice atribuído ao último
elemento, o retorno será <code>nil</code>.
</p>

<pre class="example" id="org2bc0747">
&gt; (nthcdr 0 '(1 2 3 4))
(1 2 3 4)

&gt; (nthcdr 1 '(1 2 3 4))
(2 3 4)

&gt; (nthcdr 3 '(1 2 3 4))
(4)

&gt; (nthcdr 3 '(1 2 3 . 4))
(lit error "{} is not a list" 4)

&gt; (nthcdr -1 '(1 2 3 4))
(lit error "{} is not a valid index" -1)

&gt; (nthcdr 3/4 '(1 2 3 4))
(lit error "{} is not an integer" 3/4)

&gt; (nthcdr 4 '(1 2 3 4))
nil

&gt; (nthcdr 5 '(1 2 3 4))
nil

&gt; (nthcdr 50 nil)
nil
</pre>
</div>
</div>

<div id="outline-container-orgaa09a6f" class="outline-4">
<h4 id="orgaa09a6f"><span class="section-number-4">11.3.41.</span> <code>(nth n lst)</code></h4>
<div class="outline-text-4" id="text-11-3-41">
<p>
Recupera o <code>n</code>-ésimo elemento da lista <code>lst</code>.
</p>

<p>
Uma possível implementação para <code>nth</code> seria:
</p>

<pre class="example" id="orgc2c911b">
(defn nth (n lst)
  (car (nthcdr n lst)))
</pre>

<p>
Os elementos  começam a ser contados  a partir de <code>0</code>.  Assim, um número
menor  que  <code>0</code>  incorrerá  em  um  erro.  Da  mesma  forma,  um  número
não-inteiro também será considerado um erro.
</p>

<p>
Se  <code>lst</code> for  uma  lista  pontuada, o  algoritmo  tentará encontrar  os
elementos até  onde for possível.  Caso o algoritmo precise  chegar ao
ponto de encontrar o  <i>cdr</i> de um objeto que não seja  <i>cons</i> ou o símbolo
<code>nil</code>, um erro será levantado.
</p>

<p>
Caso <code>n</code> corresponda a um índice  maior que o índice atribuído ao último
elemento, o retorno será <code>nil</code>.
</p>

<pre class="example" id="org7fb69bb">
&gt; (nth 0 '(1 2 3 4))
1

&gt; (nth 3 '(1 2 3 4))
4

&gt; (nth 3 '(1 2 3 . 4))
(lit error "{} is not a list" 4)

&gt; (nth -1 '(1 2 3 4))
(lit error "{} is not a valid index" -1)

&gt; (nth 3/4 '(1 2 3 4))
(lit error "{} is not an integer" 3/4)

&gt; (nth 4 '(1 2 3 4))
nil

&gt; (nth 5 '(1 2 3 4))
nil

&gt; (nth 50 nil)
nil
</pre>
</div>
</div>

<div id="outline-container-orga0dc269" class="outline-4">
<h4 id="orga0dc269"><span class="section-number-4">11.3.42.</span> <code>(macroexpand-1 x)</code></h4>
<div class="outline-text-4" id="text-11-3-42">
<p>
Expande uma  expressão quotada,  caso esta envolva  a aplicação  de um
<i>macro</i>.
</p>

<p>
Retorna o resultado  da aplicação da função associada ao  macro, o que
pode ser tanto uma expressão válida quanto um objeto de erro.
</p>

<pre class="example" id="orged34a6a">
&gt; (def m (mac (f x) (list f x)))
m

&gt; (macroexpand-1 '(m f 5))
(f 5)
</pre>

<p>
A expansão de um  macro deverá retornar um erro caso  a expansão em si
gere uma <i>função</i>  ao invés alguma outra forma, pois  <b>macros não admitem
aplicação parcial</b>.
</p>

<p>
Igualmente, caso a própria aplicação do  macro gere algum erro, o erro
deverá ser retornado.
</p>
</div>
</div>

<div id="outline-container-orgb215998" class="outline-4">
<h4 id="orgb215998"><span class="section-number-4">11.3.43.</span> <code>(not x)</code></h4>
<div class="outline-text-4" id="text-11-3-43">
<p>
Nega logicamente o argumento <code>x</code>.
</p>

<p>
De acordo  com as regras de  <i>verdade</i> de Majestic Lisp,  qualquer valor
diferente de <code>nil</code> será  considerado verdadeiro. Portanto, ao aplicarmos
esta  função a  qualquer valor  diferente de  <code>nil</code>, obteremos  <code>nil</code> como
resposta.
</p>

<p>
Pela mesma regra de <i>verdade</i>, ao  aplicarmos a função <code>not</code> ao valor <code>nil</code>,
obteremos necessariamente o símbolo <code>t</code>.
</p>

<pre class="example" id="org9db41ac">
&gt; (not 1)
nil

&gt; (not '(a b c))
nil

&gt; (not t)
nil

&gt; (not nil)
t
</pre>
</div>
</div>

<div id="outline-container-orgf2c7c6f" class="outline-4">
<h4 id="orgf2c7c6f"><span class="section-number-4">11.3.44.</span> <code>(gensym)</code></h4>
<div class="outline-text-4" id="text-11-3-44">
<p>
Gera um símbolo aleatório.
</p>

<p>
Os símbolos  têm uma representação textual  com o formato <code>:Gx</code>,  onde <code>x</code>
será um número  que, internamente, é gerado sem que  haja colisões com
outros símbolos.
</p>

<p>
Isso  classifica  a  função  <code>gensym</code> como  uma  função  necessariamente
impura, sendo portanto dependente de estado externo à mesma.
</p>

<pre class="example" id="org6218dd6">
&gt; (gensym)
:G88

&gt; (gensym)
:G89

&gt; (gensym)
:G90

&gt; (gensym)
:G91
</pre>
</div>
</div>

<div id="outline-container-org2c9db82" class="outline-4">
<h4 id="org2c9db82"><span class="section-number-4">11.3.45.</span> <code>(terpri)</code></h4>
<div class="outline-text-4" id="text-11-3-45">
<p>
Imprime uma nova linha no stream <code>*stdout*</code>.
</p>

<p>
Uma possível implementação para <code>terpri</code> poderia ser:
</p>

<pre class="example" id="org6dae1ea">
(defn terpri ()
  (write-char #\newline *stdout*))
</pre>

<p>
A impressão da nova linha retorna um erro se não puder ser efetuada em
<code>*stdout*</code>. Caso contrário, a função sempre retorna <code>nil</code>.
</p>

<pre class="example" id="org21cbf5b">
&gt; (terpri)
;
nil

&gt; (let ((*stdout* (open-stream 'out "file.txt")))
    (close-stream *stdout*)
    (terpri))
(lit error "The stream {} is closed" #&lt;stream (out) {...}&gt;)
</pre>
</div>
</div>

<div id="outline-container-orgcc46024" class="outline-4">
<h4 id="orgcc46024"><span class="section-number-4">11.3.46.</span> <code>(display x)</code></h4>
<div class="outline-text-4" id="text-11-3-46">
<p>
Imprime o  objeto <code>x</code> no  <i>stream</i> <code>*stdout*</code>.  A impressão <b>não  adiciona</b> um
caractere de fim de linha ao final da impressão, portanto, <b>o resultado
da execução pode aparecer junto à saída esperada</b>.
</p>

<p>
Para  adicionar um  terminador de  linha ao  final da  impressão, veja
<code>terpri</code>.
</p>

<p>
Uma possível implementação de <code>display</code> seria:
</p>

<pre class="example" id="orgf429269">
(defn display (x)
  (write x *stdout*))
</pre>

<p>
A  impressão do  objeto está  condicionada à  impressão de  objetos de
Majestic por parte do sistema.
</p>

<p>
Retorna um erro  se o objeto não puder ser  impresso em <code>*stdout*</code>. Caso
contrário, a função sempre retorna <code>nil</code>.
</p>

<pre class="example" id="orgb76396a">
&gt; (display 'hello)
; hello
nil

&gt; (do (display 'hello)
      (terpri))
; hello
;
nil

&gt; (let ((x 2)
        (y 3))
    (display (+ x y))
    (terpri))
; 5
;
nil

&gt; (let ((*stdout* (open-stream 'out "file.txt")))
    (close-stream *stdout*)
    (display 'a))
(lit error "Cannot write to closed stream")
</pre>
</div>
</div>

<div id="outline-container-org7d9f96a" class="outline-4">
<h4 id="org7d9f96a"><span class="section-number-4">11.3.47.</span> <span class="todo TODO">TODO</span> <code>(pretty-display x)</code></h4>
<div class="outline-text-4" id="text-11-3-47">
<p>
Imprime o objeto <code>x</code> no stream <code>*stdout*</code>.
</p>

<p>
<code>pretty-display</code> é exatamente igual a <code>display</code>,  à exceção do fato de que
esta função tenta realizar <i>pretty printing</i> da expressão em <code>x</code>.
</p>
</div>
</div>

<div id="outline-container-orgdb64f9b" class="outline-4">
<h4 id="orgdb64f9b"><span class="section-number-4">11.3.48.</span> <code>(print fmt . rest)</code></h4>
<div class="outline-text-4" id="text-11-3-48">
<p>
Imprime uma string formatada a partir  de <code>fmt</code> e dos argumentos em <code>rest</code>
no <i>stream</i>  <code>*stdout*</code>. O processo de  impressão <b>necessariamente adiciona
uma nova linha ao final do texto impresso</b>.
</p>

<p>
Uma possível implementação  para essa função em  Majestic Lisp poderia
ser:
</p>

<pre class="example" id="org94712b2">
(defn print args
  (write-string
    (apply format args)
    *stdout*)
  (terpri))
</pre>

<p>
Esta função retorna um erro caso  a formatação não possa ser feita, 
</p>

<pre class="example" id="org7304948">
&gt; (print "My name is {}" 'Someone)
; My name is Someone
;
nil

&gt; (print "{} + {} = {}"
         2
         3
         (+ 2 3))
; 2 + 3 = 5
;
nil

&gt; (print "Hello {}")
(lit error "Missing arguments on format")

&gt; (let ((*stdout* (open-stream 'out "file.txt")))
    (close-stream *stdout*)
    (print "Hello {}" 'World))
(lit error "Cannot write to closed stream")
</pre>
</div>
</div>

<div id="outline-container-org0d0ce2f" class="outline-4">
<h4 id="org0d0ce2f"><span class="section-number-4">11.3.49.</span> <code>(load path)</code></h4>
<div class="outline-text-4" id="text-11-3-49">
<p>
Carrega o código do arquivo existente no caminho <code>path</code>, interpretando-o
logo em seguida.
</p>

<p>
Caso o caminho não possa ser aberto, retorna um objeto de erro.
</p>

<p>
Espera-se que  o arquivo  em questão  constitua-se de  código Majestic
Lisp válido. Caso alguma das  formas textualmente descritas no arquivo
falhe   em  sua   interpretação,  tal   processo  será   imediatamente
interrompido, e o erro relacionado será retornado.
</p>

<p>
Do contrário,  a função retornará o  mesmo valor de retorno  da última
expressão interpretada no arquivo.
</p>

<p>
O exemplo  a seguir  assume a  execução em um  sistema Unix,  apenas a
título de exemplo.
</p>

<p>
Suponha-se o arquivo <code>test.maj</code> com conteúdo:
</p>

<pre class="example" id="org0b679f9">
(defn foo (x)
  (+ x 2))

(defn bar ()
  (foo 5))
</pre>

<p>
Pode-se, portanto, considerar o seguinte uso de tal arquivo:
</p>

<pre class="example" id="org85a41f9">
&gt; (load "test.maj")
bar

&gt; (foo 7)
9

&gt; (bar)
7
</pre>

<p>
De forma similar, erros serão emitidos quando um arquivo não existir.
</p>

<pre class="example" id="org3e379a3">
&gt; (load "blah.maj")
(lit error "While reading file {}: Cannot open file" "blah.maj")
</pre>
</div>
</div>

<div id="outline-container-orgfb71f3e" class="outline-4">
<h4 id="orgfb71f3e"><span class="section-number-4">11.3.50.</span> <code>(equal x y)</code></h4>
<div class="outline-text-4" id="text-11-3-50">
<p>
Informa  se  <code>x</code>  e <code>y</code>  são  iguais.  A  igualdade  tratada por  <code>equal</code>  é
inerentemente mais  permissiva, e procurará realizar  comparação entre
os elementos de acordo com o  tipo dos mesmos, quando tais tipos forem
iguais.  Ademais,  <code>equal</code>  realizará comparações  recursivas  entre  os
elementos de coleções.
</p>

<p>
A função <code>equal</code> é executada de forma a ser o mais permissiva quanto for
possível. Isso significa que <code>equal</code> não retorna erros relacionados aos
tipos  de <code>x</code>  e  <code>y</code>, e  será  capaz de  comparar  estes dois  argumentos
independentemente de seus tipos.
</p>

<p>
A  função <code>equal</code>  pode ser  implementada em  Majestic Lisp  da seguinte
forma:
</p>

<pre class="example" id="org876a749">
(defn equal (x y)
  (cond ((and (numberp x) (numberp y))
         (= x y))
        ((and (vectorp x) (vectorp y))
         (vector= x y))
        ((and (symbolp x) (symbolp y))
         (eq x y))
        ((and (consp x) (consp y))
         (when (equal (car x) (car y))
           (equal (cdr x) (cdr y))))
        ((and (atomp x) (atomp y))
         (id x y))
        (t nil)))
</pre>

<p>
Como é  possível notar, <code>x</code>  e <code>y</code> podem  ser quaisquer tipos  de valores;
quando  forem  coleções  (como  listas ou  vetores),  <code>equal</code>  realizará
comparações recursivamente entre seus elementos.
</p>

<p>
Caso   os  dois   parâmetros  sejam   iguais,  segundo   os  critérios
estabelecidos, retorna <code>t</code>. Caso contrário, retorna <code>nil</code>.
</p>

<pre class="example" id="org13de433">
&gt; (equal 0.5 1/2)
t

&gt; (equal [1 2 3] [1 2 3])
t

&gt; (equal 'a 'b)
nil

&gt; (equal '(a b c) '(a b c))
t

&gt; (equal #\F #\F)
t

&gt; (equal *stdin* *stdin*)
t

&gt; (equal *stdin* *stdout*)
nil

&gt; (equal 20 'a)
nil

&gt; (equal *stdout* '(a b c))
nil

&gt; (equal [6 5] '(6 5))
nil

&gt; (equal "Teste" "Teste")
t
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf94c15" class="outline-3">
<h3 id="orgcf94c15"><span class="section-number-3">11.4.</span> Funções para vetores</h3>
<div class="outline-text-3" id="text-11-4">
</div>
<div id="outline-container-org5edfd85" class="outline-4">
<h4 id="org5edfd85"><span class="section-number-4">11.4.1.</span> <code>(vector . rest)</code></h4>
<div class="outline-text-4" id="text-11-4-1">
<p>
Cria um vetor de objetos.
</p>

<p>
O tipo do vetor está relacionado aos tipos dos elementos fornecidos em
<code>rest</code>:
</p>

<ol class="org-ol">
<li>Se <code>rest</code> é <code>nil</code>, então será retornado um vetor vazio de tipo <code>any</code>;</li>
<li>Se <code>rest</code> possui elementos de tipos variados, então será retornado um
vetor de tipo <code>any</code> com os elementos fornecidos em sequência;</li>
<li>Se  <code>rest</code> possui apenas elementos  de tipos <code>integer</code>, <code>float</code>  ou <code>char</code>,
então  será retornado  um vetor  com tipo  igual ao  dos elementos,
populado pelos mesmos elementos fornecidos em sequência.</li>
</ol>

<pre class="example" id="org57a9488">
&gt; (vector)
[]

&gt; (vec-type (vector))
any

&gt; (vector 1 2 3 4)
[1 2 3 4]

&gt; (vec-type (vector 1 2 3 4))
integer

&gt; (vector 1. 3. 2.5)
[1.0 3.0 2.5]

&gt; (vec-type (vector 1. 3. 2.5))
float

&gt; (vector #\H #\e #\l #\l #\o)
"Hello"

&gt; (vec-type (vector #\H #\e #\l #\l #\o))
char

&gt; (vector 1. 3 2/5 2j6 'blah)
[1.0 3 2/5 2J6 blah]

&gt; (vec-type (vector 1. 3 2/5 2j6 'blah))
any
</pre>
</div>
</div>

<div id="outline-container-org54f5896" class="outline-4">
<h4 id="org54f5896"><span class="section-number-4">11.4.2.</span> <code>(vec-type vec)</code></h4>
<div class="outline-text-4" id="text-11-4-2">
<p>
Retorna o tipo de um vetor. Caso o objeto fornecido não seja um vetor,
será retornado um erro.
</p>

<p>
Em  circunstâncias normais,  será  retornado um  dos símbolo  <code>integer</code>,
<code>float</code>, <code>char</code> ou <code>any</code>.
</p>

<pre class="example" id="org96d71a8">
&gt; (vec-type [])
any

&gt; (vec-type [1 2 3 4])
integer

&gt; (vec-type [1. 3. 2.5])
float

&gt; (vec-type "Hello")
char

&gt; (vec-type [1. 3 2/5 2j6 'blah])
any

&gt; (vec-type 2)
(lit error "{} is not a vector" 2)
</pre>
</div>
</div>

<div id="outline-container-org0905ffa" class="outline-4">
<h4 id="org0905ffa"><span class="section-number-4">11.4.3.</span> <code>(vec-coerce type vec)</code></h4>
<div class="outline-text-4" id="text-11-4-3">
<p>
Tenta converter o  tipo de um vetor  <code>vec</code> para o tipo  <code>type</code>, que deverá
ser um dos símbolos <code>integer</code>, <code>float</code>, <code>char</code> ou <code>any</code>.
</p>

<p>
O vetor original não será alterado, e será retornado um novo vetor com
o novo tipo.
</p>

<p>
A conversão  segue as regras de  coerção entre vetores. Assim,  caso a
coerção individual  de um  elemento falhe,  a coerção  do vetor  em si
falhará.
</p>

<p>
Caso  <code>vec</code> não  seja um  vetor, caso  <code>type</code> não  seja um  símbolo &#x2013;  em
especial, caso não seja um  dos símbolos permitidos &#x2013;, será retornado
um erro.
</p>

<pre class="example" id="orgf7e4440">
&gt; (let ((v []))
    (vec-push v 2)
    (vec-push v 3)
    (print "Vector: {}" v)
    (print "Vector type: {}" (vec-type v))
    (set v (vec-coerce 'integer v))
    (print "Vector type: {}" (vec-type v)))
; Vector: [2 3]
; Vector type: any
; Vector type: integer
;
nil

&gt; (vec-coerce 'any "Hello")
[#\H #\e #\l #\l #\o]
</pre>
</div>
</div>

<div id="outline-container-org06a8caf" class="outline-4">
<h4 id="org06a8caf"><span class="section-number-4">11.4.4.</span> <code>(vec-push x vec)</code></h4>
<div class="outline-text-4" id="text-11-4-4">
<p>
Insere um novo elemento <code>x</code> ao final do vetor <code>vec</code>. O vetor original será
alterado  durante essa  operação.  Portanto,  <code>vec-push</code> <b>é  uma operação
destrutiva</b>.
</p>

<p>
Uma possível implementação para <code>vec-push</code> poderia ser:
</p>

<pre class="example" id="orgbc67e77">
(defn vec-push (x vec)
  (vec-insert vec
              (vec-length vec)
              x))
</pre>

<p>
Para que essa operação funcione, <code>vec</code> precisa ser um vetor, e <code>x</code> precisa
ser  um elemento  cujo tipo  seja compatível  com o  tipo do  vetor em
questão. Por exemplo, vetores de tipo <code>integer</code>, <code>float</code> e <code>char</code> só aceitam
novos elementos de  tais tipos; vetores de tipo  <code>any</code> aceitam quaisquer
tipos de elementos.
</p>

<p>
Caso os parâmetros não possuam os  tipos e valores esperados, a função
retornará  erros. Em  caso de  sucesso, será  retornado o  mesmo vetor
original, após a sua modificação.
</p>

<pre class="example" id="orgd554cca">
&gt; (def v (vec-coerce 'integer []))
v

&gt; (vec-push 5 v)
[5]

&gt; (vec-push 6 v)
[5 6]

&gt; (vec-push 'a v)
(lit error "{} has type {}, which is incompatible with pushing to vector of type {}" a symbol integer)

&gt; (let ((myvec []))
    (mapc (fn (x) (vec-push x myvec)) '(5 6 a 2/3))
    myvec)
[5 6 a 2/3]
</pre>
</div>
</div>

<div id="outline-container-orgd0c7eec" class="outline-4">
<h4 id="orgd0c7eec"><span class="section-number-4">11.4.5.</span> <code>(vec-set pos x vec)</code></h4>
<div class="outline-text-4" id="text-11-4-5">
<p>
Redefine um  elemento de  <code>vec</code> na posição  <code>pos</code> para o  novo valor  <code>x</code>. O
vetor original será alterado  durante essa operação. Portanto, <code>vec-set</code>
<b>é uma operação destrutiva</b>.
</p>

<p>
Para que essa operação funcione, <code>vec</code> precisa ser um vetor, e <code>x</code> precisa
ser  um elemento  cujo tipo  seja compatível  com o  tipo do  vetor em
questão. Por exemplo, vetores de tipo <code>integer</code>, <code>float</code> e <code>char</code> só aceitam
novos elementos de  tais tipos; vetores de tipo  <code>any</code> aceitam quaisquer
tipos de elementos.
</p>

<p>
Ademais, <code>pos</code>  precisa ser um número  inteiro maior ou igual  a zero, e
menor que  o tamanho do vetor  em questão. Por exemplo,  para um vetor
com  tamanho  <code>6</code>,  serão  admitidos  valores no  intervalo  de  <code>0</code>  a  <code>5</code>
inclusive.
</p>

<p>
Caso os parâmetros não possuam os  tipos e valores esperados, a função
retornará  erros. Em  caso de  sucesso, será  retornado o  mesmo vetor
original, após a sua modificação.
</p>

<pre class="example" id="orgc78be62">
&gt; (def v [1 2 3 4 5])
v

&gt; (vec-type v)
integer

&gt; (vec-set 2 50 v)
[1 2 50 4 5]

&gt; (vec-set 4 10 v)
[1 2 50 4 10]

&gt; (vec-set 5 90 v)
(lit error "Index {} is out of bounds in {}" 5 [11 2 50 4 10])
</pre>
</div>
</div>

<div id="outline-container-org45ac863" class="outline-4">
<h4 id="org45ac863"><span class="section-number-4">11.4.6.</span> <code>(vec-pop vec)</code></h4>
<div class="outline-text-4" id="text-11-4-6">
<p>
Remove  um elemento  na última  posição de  <code>vec</code> e  o retorna.  O vetor
original será alterado durante essa  operação. Portanto, <code>vec-pop</code> <b>é uma
operação destrutiva</b>.
</p>

<p>
Uma possível implementação para <code>vec-pop</code> poderia ser:
</p>

<pre class="example" id="orgd00104a">
(defn vec-pop (vec)
  (let ((len (vec-length vec)))
    (unless (zerop len)
      (vec-remove vec (1- len)))))
</pre>

<p>
Para que essa operação funcione, <code>vec</code>  precisa ser um vetor. Caso não o
seja, a função retornará um erro.
</p>

<p>
Se  não  houver  mais  elementos  a serem  retirados  do  vetor,  será
retornado <code>nil</code>.
</p>

<pre class="example" id="org19ad257">
&gt; (def vec [1 2 3])
vec

&gt; (while (&gt; (vec-length vec) 0)
    (print "{}" (vec-pop vec)))
; 3
; 2
; 1
;
nil

&gt; (vec-pop vec)
nil

&gt; vec
[]

&gt; (vec-pop 2/3)
(lit error "{} is not a vector" 2/3)
</pre>
</div>
</div>

<div id="outline-container-orgd682da6" class="outline-4">
<h4 id="orgd682da6"><span class="section-number-4">11.4.7.</span> <code>(vec-deq vec)</code></h4>
<div class="outline-text-4" id="text-11-4-7">
<p>
Remove um  elemento na primeira  posição de <code>vec</code>  e o retorna.  O vetor
original será alterado  durante essa operação. Portanto  <code>vec-deq</code> <b>é uma
operação destrutiva</b>.
</p>

<p>
Para que essa operação funcione, <code>vec</code>  precisa ser um vetor. Caso não o
seja, a função retornará um erro.
</p>

<p>
Se  não  houver  mais  elementos  a serem  retirados  do  vetor,  será
retornado <code>nil</code>.
</p>

<pre class="example" id="org87398ea">
&gt; (def vec (apply vector (iota 3)))
vec

&gt; vec
[0 1 2]

&gt; (until (zerop (vec-length vec))
    (print "{}" (vec-deq vec)))
; 0
; 1
; 2
;
nil

&gt; (vec-deq vec)
nil

&gt; vec
[]

&gt; (vec-deq 2/3)
(lit error "{} is not a vector" 2/3)
</pre>
</div>
</div>

<div id="outline-container-orgafbc6dd" class="outline-4">
<h4 id="orgafbc6dd"><span class="section-number-4">11.4.8.</span> <code>(vec-length vec)</code></h4>
<div class="outline-text-4" id="text-11-4-8">
<p>
Retorna  a quantidade  de elementos  do  vetor. A  quantidade será  um
número inteiro maior ou igual a zero.
</p>

<p>
Caso o objeto informado não seja um vetor, será retornado um erro.
</p>

<pre class="example" id="org6642c55">
&gt; (vec-length [])
0

&gt; (vec-length [1 2 3 4])
4

&gt; (vec-length (apply vector (reverse (iota 50))))
50

&gt; (vec-length *stdin*)
(lit error "{} is not a vector" #&lt;stream (in) {...}&gt;)
</pre>
</div>
</div>

<div id="outline-container-orgb7aa2db" class="outline-4">
<h4 id="orgb7aa2db"><span class="section-number-4">11.4.9.</span> <code>(vec-at pos vec)</code></h4>
<div class="outline-text-4" id="text-11-4-9">
<p>
Retorna um valor numa posição específica do vetor.
</p>

<p>
<code>pos</code> deve ser um valor maior ou igual  a <code>0</code>, e menor que a quantidade de
elementos  do vetor.  Assim, um  vetor  de cinco  elementos permite  a
recuperação  de  valores nas  posições  entre  <code>0</code>  e <code>4</code>  inclusive,  por
exemplo.
</p>

<p>
Se  <code>vec</code> não  for um  vetor ou  <code>pos</code> não  for um  número inteiro,  serão
retornados  erros. Igualmente,  se  <code>pos</code> não  estiver  no intervalo  de
valores admitido, será também retornado um erro.
</p>

<pre class="example" id="org2ce1f74">
&gt; (vec-at 1 [1 2 3])
2

&gt; (vec-at 0 "Hello")
#\H

&gt; (vec-at 5 "Hello")
(lit error "Index {} is out of bounds in {}" 5 "Hello")

&gt; (vec-at 5 '(1 2 3))
(lit error "{} is not a vector" (1 2 3))
</pre>
</div>
</div>

<div id="outline-container-org6ea599a" class="outline-4">
<h4 id="org6ea599a"><span class="section-number-4">11.4.10.</span> <code>(vec-remove pos vec)</code></h4>
<div class="outline-text-4" id="text-11-4-10">
<p>
Remove um elemento na posição <code>pos</code> de <code>vec</code> e o retorna. O vetor original
será  alterado  durante essa  operação.   Portanto,  <code>vec-remove</code> <b>é  uma
operação destrutiva</b>.
</p>

<p>
Para  que essa  operação funcione,  <code>vec</code> precisa  ser um  vetor, e  <code>pos</code>
precisa ser um número inteiro positivo, maior ou igual a <code>0</code> e menor que
o tamanho de <code>vec</code>. Caso contrário, a função retornará erros.
</p>

<p>
O elemento removido será então retornado pela função.
</p>

<pre class="example" id="org038a0a2">
&gt; (def vec [1 2 3 4 5])
vec

&gt; (vec-remove 2 vec)
3

&gt; (vec-remove 2 vec)
4

&gt; vec
[1 2 5]

&gt; (vec-remove 2 vec)
5

&gt; (vec-remove 2 vec)
(lit error "Index {} is out of bounds in {}" [1 2])

&gt; (vec-remove 0 2)
(lit error "{} is not a vector" 2)
</pre>
</div>
</div>

<div id="outline-container-orgce92312" class="outline-4">
<h4 id="orgce92312"><span class="section-number-4">11.4.11.</span> <code>(vec-insert pos x vec)</code></h4>
<div class="outline-text-4" id="text-11-4-11">
<p>
Insere  um novo  elemento  <code>x</code> na  posição  <code>pos</code> do  vetor  <code>vec</code>. O  vetor
original será  alterado durante essa operação.  Portanto, <code>vec-insert</code> <b>é
uma operação destrutiva</b>.
</p>

<p>
Para que essa  operação funcione, <code>vec</code> precisa ser um  vetor, <code>x</code> precisa
ser  um elemento  cujo tipo  seja compatível  com o  tipo do  vetor em
questão, e  <code>pos</code> precisa  ser um número  inteiro de valor  entre <code>0</code>  e o
tamanho do vetor <code>vec</code>.
</p>

<p>
Por exemplo,  vetores de tipo <code>integer</code>,  <code>float</code> e <code>char</code> só  aceitam novos
elementos de tais  tipos; vetores de tipo <code>any</code>  aceitam quaisquer tipos
de elementos.
</p>

<p>
No caso de <code>pos</code>, para um  vetor de <code>n</code> elementos, serão admitidos valores
de <code>0</code>  a <code>n</code> inclusive.  Uma inserção  na posição <code>n</code>  é similar ao  uso de
<code>vec-push</code>.
</p>

<p>
Caso os parâmetros não possuam os  tipos e valores esperados, a função
retornará  erros. Em  caso de  sucesso, será  retornado o  mesmo vetor
original, após a sua modificação.
</p>

<pre class="example" id="org0f1ae92">
&gt; (def v [1 2 3])
v

&gt; v
[1 2 3]

&gt; (vec-insert 3 5 v)
[1 2 3 5]

&gt; (vec-insert 0 5 v)
[5 1 2 3 5]

&gt; (vec-insert 0 5 v)
[5 5 1 2 3 5]

&gt; (vec-insert 0 5 v)
[5 5 5 1 2 3 5]

&gt; (vec-insert 1 7 v)
[5 7 5 5 1 2 3 5]

&gt; (vec-insert 3 8 v)
[5 7 5 8 5 1 2 3 5]

&gt; (vec-insert 20 8 [1 2 3])
(lit error "Index {} is out of bounds in {}" 20 [1 2 3])

&gt; (vec-insert 2 'a [1 2 3])
(lit error "{} has type {}, which is incompatible with insertion on vector of type {}" a symbol integer)
</pre>
</div>
</div>

<div id="outline-container-org502ddc2" class="outline-4">
<h4 id="org502ddc2"><span class="section-number-4">11.4.12.</span> <code>(vector= va vb)</code></h4>
<div class="outline-text-4" id="text-11-4-12">
<p>
Verifica se <code>va</code> e <code>vb</code> são vetores iguais.
</p>

<p>
Vetores iguais são aqueles que possuem mesmo subtipo, mesmo tamanho, e
elementos iguais. A igualdade de  elementos entre vetores é verificada
com auxílio da função <code>equal</code>,  que pode ser temporariamente substituída
com a utilização de escopo dinâmico.
</p>

<p>
Uma possível implementação de <code>vector=</code> pode ser:
</p>

<pre class="example" id="orga809465">
(defn vector= (va vb)
  (when (eq (vec-type va) (vec-type vb))
    (let* ((len (vec-length va))
           (i 0)
           (continue t))
      (when (= len (vec-length vb))
        (while (and (&lt; i len) continue)
          (unless (equal (vec-at va i)
                         (vec-at vb i))
            (set continue nil))
          (set i (1+ i)))
        continue))))
</pre>

<p>
Caso <code>va</code> e <code>vb</code> sejam iguais,  retorna <code>t</code>. Caso contrário, retorna <code>nil</code>. Se
<code>va</code> ou <code>vb</code> não forem vetores, será retornado um erro.
</p>

<pre class="example" id="org4ea51ff">
&gt; (vector= [1 2 3] [1 2 3])
t

&gt; (let ((v [5 6 7 8]))
    (vector= v [5 6 7 8]))
t

&gt; (vector= [1 2] [3 4 5])
nil

&gt; (vector= "Hello" "Hello")
t

&gt; (vector= ['a 'b] [#\a #\b])
nil

&gt; (vector= 'a ['a])
(lit error "{} is not a vector" a)

&gt; (vector= [5] 5)
(lit error "{} is not a vector" 5)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f7b926" class="outline-3">
<h3 id="org4f7b926"><span class="section-number-3">11.5.</span> Funções numéricas</h3>
<div class="outline-text-3" id="text-11-5">
<p>
As funções a seguir descrevem operações com números.
</p>
</div>

<div id="outline-container-org3fe7e73" class="outline-4">
<h4 id="org3fe7e73"><span class="section-number-4">11.5.1.</span> Coerção e extração de elementos</h4>
<div class="outline-text-4" id="text-11-5-1">
</div>
<ol class="org-ol">
<li><a id="org4c217ab"></a><code>(number-coerce subtype x)</code><br />
<div class="outline-text-5" id="text-11-5-1-1">
<p>
Realiza coerção de  um número, de um subtipo para  outro. Ao contrário
das operações primitivas, que realizam coerções para que haja o mínimo
de perda de  informação possível, aqui a coerção é  realizada de forma
forçada.
</p>

<p>
<code>x</code>  pode ser  qualquer  número.  <code>subtype</code> precisa  ser  um dos  símbolos
<code>integer</code>, <code>fraction</code>, <code>float</code> e <code>complex</code>.
</p>

<p>
Caso <code>x</code> não seja um número, será retornado um erro.
</p>

<pre class="example" id="org5e9662b">
&gt; (number-coerce 'float 1)
1.0

&gt; (number-coerce 'integer 1J3)
1

&gt; (number-coerce 'integer 2.3)
2

&gt; (number-coerce 'float 2/5)
0.4

&gt; (number-coerce 'integer t)
(lit error "{} is not a number" t)
</pre>
</div>
</li>

<li><a id="org438f71b"></a><code>(real-part x)</code><br />
<div class="outline-text-5" id="text-11-5-1-2">
<p>
Retorna a parte real de um número complexo. Retorna erros se <code>x</code> não for
um número, e também se não for um número complexo.
</p>

<pre class="example" id="orgaa3b252">
&gt; (real-part 2j5)
2

&gt; (real-part 3/2j7)
3/2

&gt; (real-part 1/2)
(lit error "{} is not a complex number" 1/2)

&gt; (real-part nil)
(lit error "{} is not a number" nil)
</pre>
</div>
</li>

<li><a id="org1dc4792"></a><code>(imag-part x)</code><br />
<div class="outline-text-5" id="text-11-5-1-3">
<p>
Retorna  o coeficiente  da  parte imaginária  de  um número  complexo,
enquanto número real, dependendo do subtipo da mesma. Retorna erros se
<code>x</code> não for um número, e também se não for um número complexo.
</p>

<pre class="example" id="org4e411d7">
&gt; (imag-part 2j5)
5

&gt; (imag-part 7j3/2)
3/2

&gt; (imag-part 1/2)
(lit error "{} is not a complex number" 1/2)

&gt; (imag-part nil)
(lit error "{} is not a number" nil)
</pre>
</div>
</li>

<li><a id="org36a5771"></a><code>(numer x)</code><br />
<div class="outline-text-5" id="text-11-5-1-4">
<p>
Retorna o  numerador de uma  fração, enquanto número  inteiro. Retorna
erros se <code>x</code> não for um número, e também se não for uma fração.
</p>

<p>
A função sempre considera a fração passada após sua simplificação.
</p>

<pre class="example" id="org30981df">
&gt; (numer 1/2)
1

&gt; (numer 6/4)
3

&gt; (numer 2)
(lit error "{} is not a fraction" 2)

&gt; (numer nil)
(lit error "{} is not a number" nil)
</pre>
</div>
</li>

<li><a id="org0c94e56"></a><code>(denom x)</code><br />
<div class="outline-text-5" id="text-11-5-1-5">
<p>
Retorna o denominador de uma  fração, enquanto número inteiro. Retorna
erros se <code>x</code> não for um número, e também se não for uma fração.
</p>

<p>
A função sempre considera a fração passada após sua simplificação.
</p>

<pre class="example" id="orga11adfd">
&gt; (denom 1/2)
2

&gt; (denom 6/4)
2

&gt; (denom 2)
(lit error "{} is not a fraction" 2)

&gt; (denom nil)
(lit error "{} is not a number" nil)
</pre>
</div>
</li>

<li><a id="orgc0e462d"></a><code>(richest-number-type x y)</code><br />
<div class="outline-text-5" id="text-11-5-1-6">
<p>
Retorna um símbolo indicando o tipo  mais rico em informação entre <code>x</code> e
<code>y</code>. Caso <code>x</code> ou <code>y</code> não sejam números, retorna um erro.
</p>

<p>
Essa  função é  essencial  para  o emprego  de  coerções numéricas  em
operações primitivas.  Ao deduzirmos o  tipo, entre outros  dois, onde
menos se perde informação, podemos realizar coerções em <code>x</code> e <code>y</code> para que
operações primitivas sejam feitas nos mesmos, de forma subsequente.
</p>

<p>
Esta  função   segue  estritamente  as  regras   de  coerção  numérica
mencionadas na especificação de números anteriormente citada.
</p>

<p>
Esta função também <b>não aborda</b> casos individuais relacionados a números
compostos (<code>fraction</code> e <code>complex</code>, quando  o primeiro possui denominador <code>1</code>
e o  segundo possui  parte imaginária  igual a  <code>0</code>). Para  estes casos,
espera-se  que   a  operação  em   questão  realize  um   processo  de
<i>simplificação</i> do resultado, onde uma nova coerção poderá ocorrer.
</p>

<pre class="example" id="org3621c0b">
&gt; (richest-number-type 5 2.0)
float

&gt; (richest-number-type 2 2/3)
fraction

&gt; (richest-number-type 2J3 9)
complex

&gt; (richest-number-type 2/3J-9 2.0)
complex

&gt; (richest-number-type 2/3J-9 t)
(lit error "{} is not a number" t)
</pre>
</div>
</li>

<li><a id="orga498454"></a><code>(rich-number-coerce x y)</code><br />
<div class="outline-text-5" id="text-11-5-1-7">
<p>
Realiza uma coerção rica entre <code>x</code> e <code>y</code>.
</p>

<p>
Uma  coerção rica  toma  o subtipo  numérico  mais rico  entre  <code>x</code> e  <code>y</code>
(através   de  <code>richest-number-type</code>)   e  utiliza   <code>number-coerce</code>  para
transformar ambos <code>x</code> e <code>y</code> em números dos subtipos designados.
</p>

<pre class="example" id="org9b2776b">
(defn rich-number-coerce (x y)
  (let ((best-type (richest-number-type x y)))
    (list (number-coerce best-type x)
          (number-coerce best-type y))))
</pre>

<p>
Esta função retorna uma lista contendo as versões transformadas de <code>x</code> e
<code>y</code>. Caso  um desses parâmetros  não seja  um número, será  retornado um
erro,    normalmente    sendo    o   mesmo    erro    retornado    por
<code>richest-number-type</code>.
</p>

<pre class="example" id="org7a12300">
&gt; (rich-number-coerce 2J3 2/5)
(2J3 2/5J0.0)

&gt; (rich-number-coerce 1.5 5/2)
(3/2 5/2)

&gt; (rich-number-coerce 2 t)
(lit error "{} is not a number" t)
</pre>
</div>
</li>
</ol>
</div>

<div id="outline-container-org18da30a" class="outline-4">
<h4 id="org18da30a"><span class="section-number-4">11.5.2.</span> Operações aritméticas</h4>
<div class="outline-text-4" id="text-11-5-2">
<p>
As operações básicas de Majestic  dependem da quantidade de argumentos
passados para as funções. Em geral, há comportamentos para zero, um ou
mais argumentos.
</p>

<p>
Caso algum dos argumentos não seja um número, retorna um erro.
</p>

<p>
As  operações podem  precisar  de algumas  coerções implícitas.  Essas
coerções  estão   definidas  na  discussão  anterior   a  respeito  da
especificação dos números.
</p>
</div>

<ol class="org-ol">
<li><a id="org51311fd"></a><code>(+ . rest)</code><br />
<div class="outline-text-5" id="text-11-5-2-1">
<p>
<b>Nenhum argumento:</b> Retorna o elemento neutro da soma (<code>1</code>).
</p>

<p>
<b>Um argumento:</b> Conjugado  &#x2013; retorna o conjugado do  número atual, caso
seja  um  número   complexo;  do  contrário,  retorna   o  número  sem
alterações.
</p>

<p>
<b>Mais argumentos:</b> Retorna o somatório dos argumentos.
</p>

<pre class="example" id="org214531d">
&gt; (+)
1

&gt; (+ 2J3)
2J-3

&gt; (+ 1 2 3)
6

&gt; (+ 'a)
(lit error "{} is not a number" a)
</pre>
</div>
</li>

<li><a id="org23b739e"></a><code>(- . rest)</code><br />
<div class="outline-text-5" id="text-11-5-2-2">
<p>
<b>Nenhum argumento:</b> Retorna o elemento neutro da subtração (<code>0</code>).
</p>

<p>
<b>Um argumento:</b> Retorna a negação do número.
</p>

<p>
<b>Mais argumentos:</b> Retorna a subtração sucessiva dos argumentos.
</p>

<pre class="example" id="org3ddacfd">
&gt; (-)
0

&gt; (- 1)
-1

&gt; (- 1 2 3)
-4

&gt; (- 'a)
(lit error "{} is not a number" a)
</pre>
</div>
</li>

<li><a id="org19b6e42"></a><code>(* . rest)</code><br />
<div class="outline-text-5" id="text-11-5-2-3">
<p>
<b>Nenhum argumento:</b> Retorna o elemento neutro da multiplicação (<code>1</code>).
</p>

<p>
<b>Um  argumento:</b> Retorna  o  sinal do  número.  Para números  positivos,
retorna  <code>1</code>; para  negativos,  retorna  <code>-1</code>. Caso  o  número seja  zero,
retorna <code>0</code>.
</p>

<p>
<b>Mais argumentos:</b> Retorna o produtório dos argumentos.
</p>

<pre class="example" id="orgad6aaf6">
&gt; (*)
1

&gt; (* -50)
-1

&gt; (* 1 2 3)
6

&gt; (* 3J2 1J7)
-11J23.0

&gt; (* 'a)
(lit error "{} is not a number" a)
</pre>
</div>
</li>

<li><a id="org2b4947d"></a><code>(/ . rest)</code><br />
<div class="outline-text-5" id="text-11-5-2-4">
<p>
<b>Nenhum argumento:</b> Retorna o elemento neutro da divisão (<code>1</code>).
</p>

<p>
<b>Um argumento:</b> Retorna o <i>recíproco</i> do número. Os números podem precisar
de coerção para que o recíproco seja calculado.
</p>

<p>
<b>Mais argumentos:</b> Retorna a divisão sucessiva dos argumentos.
</p>

<p>
Exclusivamente  para esta  operação,  nenhum dos  argumentos pode  ser
<i>zero</i>. Se for, será gerado um erro de divisão por zero.
</p>

<pre class="example" id="orga12d44d">
&gt; (/)
1

&gt; (/ 3)
1/3

&gt; (/ 0.5)
2

&gt; (/ 3 4)
3/4

&gt; (/ 2 3 0)
(lit error "Division by zero")

&gt; (/ 0)
(lit error "Division by zero")

&gt; (/ 2 'a)
(lit error "{} is not a number" a)
</pre>
</div>
</li>
</ol>
</div>

<div id="outline-container-org6699b74" class="outline-4">
<h4 id="org6699b74"><span class="section-number-4">11.5.3.</span> Miscelânea</h4>
<div class="outline-text-4" id="text-11-5-3">
</div>
<ol class="org-ol">
<li><a id="orgca142f2"></a><code>(zerop x)</code><br />
<div class="outline-text-5" id="text-11-5-3-1">
<p>
Retorna <code>t</code> se <code>x</code> for um número igual a zero.
</p>

<p>
Esta  função usualmente  utiliza uma  comparação com  zero através  da
operação de  comparação <code>=</code>. Para o  caso de números com  subtipo <code>float</code>,
será utilizada a operação de comparação <code>float=</code>.
</p>

<pre class="example" id="orga6519e6">
(defn zerop (x)
  (or (and (floatp x)
           (float= x 0.0))
      (= x 0)))
</pre>

<p>
Caso o objeto  em questão não seja um número,  será retornado um erro,
geralmente o mesmo retornado por <code>float=</code> ou <code>=</code>.
</p>

<pre class="example" id="org91e32c4">
&gt; (zerop 0.00)
t

&gt; (zerop 0/1)
t

&gt; (zerop 0)
t

&gt; (zerop 5)
nil

&gt; (zerop t)
(lit error "{} is not a number" t)
</pre>
</div>
</li>

<li><a id="orgb720254"></a><code>(iota n)</code><br />
<div class="outline-text-5" id="text-11-5-3-2">
<p>
Gera uma lista contendo  números de <code>0</code> a <code>(1- n)</code>  (<code>n</code> não estará incluído
na lista).
</p>

<p>
Retorna um erro se <code>n</code> não for um número inteiro positivo.
</p>

<pre class="example" id="org666cea9">
&gt; (iota 0)
nil

&gt; (iota 5)
(0 1 2 3 4)

&gt; (map 1+ (iota 5))
(1 2 3 4 5)

&gt; (iota -1)
(lit error "iota expects a positive integer number")

&gt; (iota 2/3)
(lit error "iota expects a positive integer number")

&gt; (iota 'a)
(lit error "iota expects a positive integer number")
</pre>
</div>
</li>

<li><a id="orga93b4cb"></a><code>(1+ x)</code><br />
<div class="outline-text-5" id="text-11-5-3-3">
<p>
Retorna o número <code>x</code>, acrescido de uma unidade (<code>1</code>).
</p>

<p>
<code>1+</code> pode ser definido da seguinte forma:
</p>

<pre class="example" id="orga4bb5ee">
(defn 1+ (x) (+ 1 x))
</pre>

<p>
Caso <code>x</code> não seja um número, será retornado um erro.
</p>

<pre class="example" id="org3080402">
&gt; (1+ 2)
3

&gt; (map 1+ (iota 2))
(1 2)

&gt; (1+ 'a)
(lit error "{} is not a number" a)
</pre>
</div>
</li>

<li><a id="orgc51e554"></a><code>(1- x)</code><br />
<div class="outline-text-5" id="text-11-5-3-4">
<p>
Retorna o número <code>x</code>, decrescido de uma unidade (<code>1</code>).
</p>

<p>
<code>1-</code> pode ser definido da seguinte forma:
</p>

<pre class="example" id="org2d97350">
(defn 1- (x) (+ -1 x))
</pre>

<p>
Caso <code>x</code> não seja um número, será retornado um erro.
</p>

<pre class="example" id="orgd937484">
&gt; (1- 2)
1

&gt; (map 1- (iota 2))
(-1 0)

&gt; (1- 'a)
(lit error "{} is not a number" a)
</pre>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orgca17dce" class="outline-3">
<h3 id="orgca17dce"><span class="section-number-3">11.6.</span> <span class="todo TODO">TODO</span> Operações de comparação</h3>
<div class="outline-text-3" id="text-11-6">
</div>
<div id="outline-container-org07f161d" class="outline-4">
<h4 id="org07f161d"><span class="section-number-4">11.6.1.</span> <code>(= x y . rest)</code></h4>
<div class="outline-text-4" id="text-11-6-1">
<p>
Verifica por igualdade entre dois ou mais números, retornando <code>t</code> ou <code>nil</code>.
</p>

<p>
Antes  de efetuar  qualquer  comparação, realiza-se  uma coerção  rica
entre <code>x</code>  e <code>y</code>. Em  seguida, procede-se  à comparação para  cada subtipo
numérico.
</p>

<p>
A  igualdade numérica  realiza operações  internas de  comparação para
todos os  subtipos numéricos,  exceto o subtipo  <code>float</code>. Nesse  caso, a
função  recorrerá   à  função  <code>float=</code>  para   comparação.  Todavia,  é
importante  salientar  que <b>comparações  por  igualdade  com <code>float</code>  são
desencorajadas</b>.
</p>

<pre class="example" id="orgaba56d6">
&gt; (= 4/2 2)
t

&gt; (let ((x 1))
    (= 1 x))
t

&gt; (= 2J3 2/3)
nil

&gt; (= 2.0 2)
t

&gt; (= 2 4/2 2 3 5)
nil

&gt; (= t 2/3)
(lit error "{} is not a number" t)
</pre>

<p>
Para um número de argumentos maior que dois, a função tentará comparar
<code>x</code> e  <code>y</code> e, caso  a comparação seja  verdadeira, repetirá a  execução da
função, removendo  <code>x</code> da  lista de argumentos.  Caso a  comparação seja
falsa,  interrompe-se o  processo  recursivo, e  retorna-se <code>nil</code>,  como
esperado.
</p>

<p>
Em termos práticos, a comparação a seguir desenvolve-se como indicado:
</p>

<pre class="example" id="org5e716a4">
(= 2 4/2 2 3 5)
(= 4/2 2 3 5)
(= 2 3 5)
nil
</pre>
</div>
</div>

<div id="outline-container-orgf67bf6c" class="outline-4">
<h4 id="orgf67bf6c"><span class="section-number-4">11.6.2.</span> <code>(float= x y)</code></h4>
<div class="outline-text-4" id="text-11-6-2">
<p>
Verifica por igualdade entre exatamente dois números de subtipo <code>float</code>.
</p>

<p>
Esta  função   é  utilizada   de  forma  subjacente   nas  comparações
aritméticas  da  função <code>=</code>,  quando  envolvem  a comparação  de  pontos
flutuantes.
</p>

<p>
Comparar pontos  flutuantes por igualdade é  uma operação notavelmente
dificultosa,  posto que  valores decimais  não possuem  representações
precisas quando lidamos com pontos flutuantes. Como exemplo, vejamos o
código a seguir,  como executado em um interpretador  de Majestic Lisp
feito como referência:
</p>

<pre class="example" id="orgbbd84f8">
&gt; (def f 0.1)
f

&gt; (def sum 0.0)
sum

&gt; (repeat 10 (set sum (+ sum f)))
sum

&gt; (def product (* f 10))
product

&gt; (print "sum = {}, product = {}" sum product)
; sum = 0.9999999999999999, product = 1.0
; 
nil

&gt; (float= sum product)
t
</pre>

<p>
Os  valores de  <code>sum</code> e  <code>product</code> neste  exemplo variam  de acordo  com a
máquina,  a  implementação e  a  representação  utilizada para  pontos
flutuantes. Justamente por isso, pode-se  observar a ocorrência de uma
anomalia: ambos  <code>sum</code> e <code>product</code> calculam  a multiplicação de <code>f</code>  por <code>10</code>,
porém  de   maneiras  diferentes;  enquanto   <code>sum</code>  usa  o   método  de
multiplicações  sucessivas,   <code>product</code>  envolve  o  uso   da  função  <code>*</code>
diretamente.
</p>

<p>
Isto ocorre  devido à  natureza da  representação de  <code>float</code>'s enquanto
arredondamentos dos números aos  quais queremos representar. Por isso,
a melhor opção para uma comparação  direta entre <code>float</code>'s é comparar se
dois números são suficientemente próximos um do outro.
</p>

<p>
Normalmente seria interessante considerar  um valor pequeno \(\epsilon\)
que representasse  a distância entre dois  números representáveis como
<code>float</code>, todavia,  a própria forma  de representação desses  números faz
com que uma  constante \(\epsilon\) possa se tornar  inefetiva em alguns
casos,  especialmente  quando  o  número aumenta.  Assim,  o  ideal  é
considerar  \(\epsilon\)  como  uma  medida variável  e  dependente  dos
números comparados.
</p>

<p>
Para tanto, é possível tomar  a representação binária dos <code>float</code>'s como
se fossem  representações binárias de números  inteiros (<code>integer</code>), que
conservam a  propriedade de serem  adjacentes, quando os  dois <code>float</code>'s
o são.  Assim, uma mera  subtração destes  números, em seu  formato de
números  inteiros, dizem-nos  quão longe  um  do outro  eles estão  no
espaço dos <code>float</code>'s.
</p>

<p>
Mais especificamente, dados \(a\) e \(b\)  que possuem o mesmo sinal e são
do subtipo numérico <code>float</code>, temos que:
</p>

\begin{equation}
a_\textrm{integer} - b_{integer} = 1 + p
\end{equation}

<p>
onde \(p\) é  a quantidade de números  possivelmente representáveis como
<code>float</code> entre \(a\) e \(b\)<sup><a id="fnr.4" class="footref" href="#fn.4" role="doc-backlink">4</a></sup>.
</p>

<p>
A partir deste  método, sabemos agora que <code>float=</code>  envolve realizar tal
comparação entre <code>float</code>'s  de forma que a operação acima  não exceda um
certo  número  \(p\),  também  conhecido   como  ULPs  (<i>units  of  least
precision</i>, ou <i>units in the last place</i>).
</p>

<p>
Em Majestic Lisp, ULPs é  uma constante global armazenada como <code>*ulps*</code>,
que  pode  ser temporariamente  modificada  através  de uma  definição
dinâmica.
</p>

<p>
Em  geral, recomenda-se  não realizar  comparação direta  entre pontos
flutuantes,  pela  natureza imprecisa  de  seus  possíveis métodos  de
comparação.   Todavia,   para  as  situações  onde   for  extremamente
necessário,  será  possível  delegar  esta  atividade  para  a  função
<code>float=</code>.
</p>

<p>
Finalmente,  ao  tratarmos do  uso  conceitual  da linguagem,  onde  a
limitação de <code>float</code>'s não existiria,  <code>float=</code> seria meramente uma versão
mais específica de <code>=</code>.
</p>
</div>
</div>

<div id="outline-container-orgff8cf3d" class="outline-4">
<h4 id="orgff8cf3d"><span class="section-number-4">11.6.3.</span> <code>(&gt; x y . rest)</code></h4>
<div class="outline-text-4" id="text-11-6-3">
<p>
Compara consecutivamente se um número  é maior que outro, retornando <code>t</code>
ou <code>nil</code>.
</p>

<p>
Antes  de efetuar  qualquer  comparação, realiza-se  uma coerção  rica
entre <code>x</code>  e <code>y</code>. Em  seguida, procede-se  à comparação para  cada subtipo
numérico.
</p>

<p>
A  função numérica  de maior-que  realiza comparações  entre todos  os
subtipos numéricos, exceto para números  <code>complex</code>, posto que o conjunto
\(\mathbb{C}\)  não pode  ser um  campo ordenado<sup><a id="fnr.5" class="footref" href="#fn.5" role="doc-backlink">5</a></sup>.  Para o  caso de
números  de  subtipo  <code>fraction</code>,   realiza-se  uma  conversão  para  um
denominador comum e compara-se os números inteiros do numerador.
</p>

<p>
Realizar uma  comparação usando <code>&gt;</code>,  de forma  a envolver um  número de
subtipo <code>complex</code>, gerará um erro.
</p>

<pre class="example" id="orgb567e27">
&gt; (&gt; 5/2 2)
t

&gt; (let ((x 1))
    (&gt; 1 x))
nil

&gt; (&gt; 10 5 3 1)
t

&gt; (&gt; 1 2 3)
nil

&gt; (&gt; 2J3 2/3)
(lit error "The set of complex numbers can't be an ordered field")

&gt; (&gt; 3 t)
(lit error "{} is not a number" t)
</pre>

<p>
Para um número de argumentos maior que dois, a função tentará comparar
<code>x</code> e  <code>y</code> e, caso  a comparação seja  verdadeira, repetirá a  execução da
função, removendo  <code>x</code> da  lista de argumentos.  Caso a  comparação seja
falsa,  interrompe-se o  processo  recursivo, e  retorna-se <code>nil</code>,  como
esperado.
</p>

<p>
Em termos práticos, a comparação a seguir desenvolve-se como indicado:
</p>

<pre class="example" id="org74867d6">
(&gt; 3 2 1)
(&gt; 2 1)
t
</pre>
</div>
</div>

<div id="outline-container-org859b05a" class="outline-4">
<h4 id="org859b05a"><span class="section-number-4">11.6.4.</span> <code>(&lt; x y . rest)</code></h4>
<div class="outline-text-4" id="text-11-6-4">
<p>
Compara consecutivamente se um número  é menor que outro, retornando <code>t</code>
ou <code>nil</code>.
</p>

<p>
Antes  de efetuar  qualquer  comparação, realiza-se  uma coerção  rica
entre <code>x</code>  e <code>y</code>. Em  seguida, procede-se  à comparação para  cada subtipo
numérico.
</p>

<p>
A  função numérica  de menor-que  realiza comparações  entre todos  os
subtipos numéricos, exceto para números  <code>complex</code>, posto que o conjunto
\(\mathbb{C}\) não pode  ser um campo ordenado.  Para o  caso de números
de  subtipo <code>fraction</code>,  realiza-se  uma conversão  para um  denominador
comum e compara-se os números inteiros do numerador.
</p>

<p>
Realizar uma  comparação usando <code>&lt;</code>,  de forma  a envolver um  número de
subtipo <code>complex</code>, gerará um erro.
</p>

<pre class="example" id="orgf5bdab0">
&gt; (&lt; 2 5/2)
t

&gt; (let ((x 1))
    (&lt; 1 x))
nil

&gt; (&lt; 1 3 5 10)
t

&gt; (&lt; 3 2 1)
nil

&gt; (&lt; 2J3 2/3)
(lit error "The set of complex numbers can't be an ordered field")

&gt; (&lt; 3 t)
(lit error "{} is not a number" t)
</pre>

<p>
Para um número de argumentos maior que dois, a função tentará comparar
<code>x</code> e  <code>y</code> e, caso  a comparação seja  verdadeira, repetirá a  execução da
função, removendo  <code>x</code> da  lista de argumentos.  Caso a  comparação seja
falsa,  interrompe-se o  processo  recursivo, e  retorna-se <code>nil</code>,  como
esperado.
</p>

<p>
Em termos práticos, a comparação a seguir desenvolve-se como indicado:
</p>

<pre class="example" id="org703a4c7">
(&lt; 1 2 3)
(&lt; 2 3)
t
</pre>
</div>
</div>

<div id="outline-container-orgcc26525" class="outline-4">
<h4 id="orgcc26525"><span class="section-number-4">11.6.5.</span> <code>(&gt;= x y . rest)</code></h4>
<div class="outline-text-4" id="text-11-6-5">
<p>
Compara  consecutivamente se  um  número  é maior  ou  igual a  outro,
retornando <code>t</code> ou <code>nil</code>.
</p>

<p>
Esta  função não  é capaz  de  realizar comparações  para números  com
subtipo <code>complex</code>,  posto que  o conjunto \(\mathbb{C}\)  não pode  ser um
campo ordenado.  Realizar uma comparação envolvendo  um numero <code>complex</code>
retornará um erro.
</p>

<p>
Uma possível definição para essa função seria:
</p>

<pre class="example" id="org364a6a0">
(defn &gt;= args
  (or (apply &gt; args)
      (apply = args)))
</pre>

<p>
Esta função  pode portanto ser  definida com base  em <code>&gt;</code> e  <code>=</code>, herdando
portanto o comportamento e as limitações subjacentes dessas funções.
</p>

<pre class="example" id="org60cb965">
&gt; (&gt;= 5/2 2)
t

&gt; (&gt;= 2.0 2)
t

&gt; (&gt;= 1 2 3)
nil

&gt; (&gt;= 3 3 1)
t

&gt; (&gt;= 5J9 6J9)
(lit error "The set of complex numbers can't be an ordered field")

&gt; (&gt;= 3 t)
(lit error "{} is not a number" t)
</pre>
</div>
</div>

<div id="outline-container-orge7b18b3" class="outline-4">
<h4 id="orge7b18b3"><span class="section-number-4">11.6.6.</span> <code>(&lt;= x y . rest)</code></h4>
<div class="outline-text-4" id="text-11-6-6">
<p>
Compara  consecutivamente se  um  número  é menor  ou  igual a  outro,
retornando <code>t</code> ou <code>nil</code>.
</p>

<p>
Esta  função não  é capaz  de  realizar comparações  para números  com
subtipo <code>complex</code>,  posto que  o conjunto \(\mathbb{C}\)  não pode  ser um
campo ordenado.  Realizar uma comparação envolvendo  um numero <code>complex</code>
retornará um erro.
</p>

<p>
Uma possível definição para essa função seria:
</p>

<pre class="example" id="org7d0f959">
(defn &lt;= args
  (or (apply &lt; args)
      (apply = args)))
</pre>

<p>
Esta função  pode portanto ser  definida com base  em <code>&gt;</code> e  <code>=</code>, herdando
portanto o comportamento e as limitações subjacentes dessas funções.
</p>

<pre class="example" id="orgd2261d1">
&gt; (&lt;= 5/2 2)
nil

&gt; (&lt;= 2.0 2)
t

&gt; (&lt;= 1 2 3)
t

&gt; (&lt;= 3 3 1)
nil

&gt; (&lt;= 5J9 6J9)
(lit error "The set of complex numbers can't be an ordered field")

&gt; (&lt;= 3 t)
(lit error "{} is not a number" t)
</pre>
</div>
</div>
</div>
<div id="outline-container-org1900003" class="outline-3">
<h3 id="org1900003"><span class="section-number-3">11.7.</span> <span class="todo TODO">TODO</span> Funções de streams</h3>
<div class="outline-text-3" id="text-11-7">
</div>
<div id="outline-container-org49006eb" class="outline-4">
<h4 id="org49006eb"><span class="section-number-4">11.7.1.</span> Abertura, fechamento e status de streams</h4>
<div class="outline-text-4" id="text-11-7-1">
</div>
<ol class="org-ol">
<li><a id="org7a6c124"></a><code>(open-stream dir path)</code><br />
<div class="outline-text-5" id="text-11-7-1-1">
<p>
Abre um <i>stream</i> para um arquivo no caminho <code>path</code>, com direção <code>dir</code>.
</p>

<p>
Caso o  caminho possa ser aberto,  retorna um <i>stream</i>. Caso  não possa,
retorna um objeto de erro.
</p>

<p>
<code>dir</code>  deve ser  um dos  símbolos <code>in</code>  ou <code>out</code>.  Caso contrário,  a função
retornará um erro.
</p>

<p>
Se  o arquivo  já existe  e  for aberto  com a  direção <code>out</code>,  qualquer
informação nele escrita será inserida ao final do mesmo.
</p>

<pre class="example" id="org7c5cd05">
&gt; (open-stream 'out "/home/user/blah.txt")
#&lt;stream {...}&gt;

&gt; (open-stream 'out "/")
(lit error "Cannot open stream to path {}" "/")
</pre>
</div>
</li>

<li><a id="org10078e1"></a><code>(close-stream x)</code><br />
<div class="outline-text-5" id="text-11-7-1-2">
<p>
Fecha um <i>stream</i> <code>x</code>.
</p>

<p>
Em  caso de  sucesso,  retorna <code>t</code>.  Caso o  <i>stream</i>  já esteja  fechado,
retorna <code>nil</code>.
</p>

<p>
Se <code>x</code> não for um <i>stream</i>, retorna um erro.
</p>

<p>
Caso haja  algum erro interno  relacionado ao <i>stream</i>, a  função também
poderá retornar um objeto de erro.
</p>

<pre class="example" id="orgd521a17">
&gt; (def s (open-stream 'out "/home/user/blah.txt"))
#&lt;stream {...}&gt;

&gt; (close-stream s)
t

&gt; (close-stream s)
nil
</pre>
</div>
</li>

<li><a id="org6ffdaf6"></a><code>(stat x)</code><br />
<div class="outline-text-5" id="text-11-7-1-3">
<p>
Mostra o  estado de  um certo <i>stream</i>  <code>s</code>. Os estados  podem ser  <code>open</code> e
<code>closed</code>. Caso o objeto não seja um <i>stream</i>, retorna um erro.
</p>

<pre class="example" id="orgff7bd5e">
&gt; (def s (open-stream 'out "/home/user/blah.txt"))
s

&gt; (stat s)
open

&gt; (close-stream s)
t

&gt; (stat s)
closed

&gt; (stat 3)
(lit error "Not a stream: {}" 3)
</pre>
</div>
</li>
</ol>
</div>

<div id="outline-container-org5f74711" class="outline-4">
<h4 id="org5f74711"><span class="section-number-4">11.7.2.</span> <span class="todo TODO">TODO</span> Leitura e escrita em streams</h4>
<div class="outline-text-4" id="text-11-7-2">
</div>
<ol class="org-ol">
<li><a id="org6564e0d"></a><code>(write x stream)</code><br />
<div class="outline-text-5" id="text-11-7-2-1">
<p>
Escreve o objeto <code>x</code> no stream  de saída informado, sem espaço em branco
ao final.
</p>

<p>
Uma possível implementação para <code>write</code> poderia ser:
</p>

<pre class="example" id="org6f354d7">
(defn write (x stream)
  (write-string (apply format '("{}" x))
                stream))
</pre>

<p>
O objeto será escrito na forma de sua representação textual interna.
</p>

<p>
Caso o stream não  seja de saída, ou caso o  stream esteja fechado, ou
caso  <code>stream</code> não  seja  um stream,  retorna  um erro.  Contrariamente,
retorna <code>nil</code>.
</p>

<p>
Se houver  algum outro  problema no processo  de escrita,  essa função
poderá também retornar um erro indicando o problema em questão.
</p>

<pre class="example" id="orgd5b6941">
&gt; (let ((stream *stdout*))
    (write (fn (x) (* x x)) stream))
; #&lt;function (fn (x)) {...}&gt;
nil

&gt; (let ((stream *stdin*))
    (write (fn (x) (* x x)) stream))
(lit error "{} is not an output stream" #&lt;stream (in) {...}&gt;)

&gt; (write (fn (x) (* x x)) 5)
(lit error "{} is not a stream" 5)
</pre>
</div>
</li>

<li><a id="orgb2524f9"></a><code>(read stream)</code><br />
<div class="outline-text-5" id="text-11-7-2-2">
<p>
Lê um objeto  no stream de entrada informado, avançando  o ponteiro de
leitura do stream até onde for possível.
</p>

<p>
O texto lido  passa pelo processo de <i>parsing</i> da  própria linguagem, de
forma que uma única expressão válida  seja lida a partir do arquivo, e
então  retornada  sem passar  pelo  processo  de interpretação.  Sendo
assim,  <code>read</code> pode  ser considerado  o ponto  de entrada  do <i>parser</i>  de
Majestic Lisp.
</p>

<p>
Caso  haja um  erro no  processo de  <i>parsing</i>, será  retornado um  erro
correspondente ao problema em tal processo.
</p>

<p>
Caso  o stream  não seja  de  entrada, ou  caso seja  o stream  esteja
fechado,   ou   caso  <code>stream</code>   não   seja   um  stream,   retorna   um
erro.
</p>

<p>
Contrariamente,   será   retornado   um  objeto   de   Majestic   Lisp
correspondente à expressão lida ou, caso  o stream de entrada tenha se
esgotado, será retornado o símbolo <code>eof</code>.
</p>

<p>
Se houver  algum outro  problema no processo  de leitura,  essa função
poderá também retornar um erro indicando o problema em questão.
</p>

<p>
Supondo um  arquivo-texto <code>teste.txt</code>  contendo exatamente  os seguintes
caracteres, sem espaço em branco ao final&#x2026;
</p>

<pre class="example" id="org7c279a9">
(foo bar baz) (1 2 3)
</pre>

<p>
&#x2026;os exemplos a seguir utilizam-se de tal arquivo.
</p>

<pre class="example" id="orgff98428">
&gt; (def *my-stream* (open-stream 'in "teste.txt"))
*my-stream*

&gt; *my-stream*
#&lt;stream (in) {...}&gt;

&gt; (read *my-stream*)
(foo bar baz)

&gt; (read *my-stream*)
(1 2 3)

&gt; (read *my-stream*)
eof

&gt; (read *stdout*)
(lit error "{} is not an input stream" #&lt;stream (out) {...}&gt;)

&gt; (close-stream *my-stream*)
t

&gt; (read *my-stream*)
(lit error "The stream {} is closed" #&lt;stream (in) {...}&gt;)

&gt; (read 2/3)
(lit error "{} is not a stream" 2/3)
</pre>
</div>
</li>

<li><a id="orgd5c0976"></a><code>(read-char stream)</code><br />
<div class="outline-text-5" id="text-11-7-2-3">
<p>
Lê  um único  caractere no  stream de  entrada informado,  avançando o
ponteiro de leitura do stream, caso seja possível.
</p>

<p>
Caso  o stream  não seja  de  entrada, ou  caso seja  o stream  esteja
fechado,   ou   caso  <code>stream</code>   não   seja   um  stream,   retorna   um
erro.
</p>

<p>
Contrariamente, será retornado  o caractere lido ou, caso  o stream de
entrada tenha se esgotado, será retornado o símbolo <code>eof</code>.
</p>

<p>
Se houver  algum outro  problema no processo  de leitura,  essa função
poderá também retornar um erro indicando o problema em questão.
</p>

<p>
Supondo um  arquivo-texto <code>teste.txt</code>  contendo exatamente  os seguintes
caracteres, sem espaço em branco ao final&#x2026;
</p>

<pre class="example" id="org8a79360">
Teste
</pre>

<p>
&#x2026;os exemplos a seguir utilizam-se de tal arquivo.
</p>

<pre class="example" id="org74847f8">
&gt; (def *my-stream* (open-stream 'in "teste.txt"))
*my-stream*

&gt; *my-stream*
#&lt;stream (in) {...}&gt;

&gt; (read-char *my-stream*)
#\T

&gt; (read-char *my-stream*)
#\e

&gt; (do (until (eq 'eof (peek-char *my-stream*))
        (display (read-char *my-stream*)))
      (terpri)
      (read-char *my-stream*))
; ste
;
eof

&gt; (close-stream *my-stream*)
t

&gt; (read-char *stdout*)
(lit error "{} is not an input stream" #&lt;stream (out) {...}&gt;)

&gt; (read-char *my-stream*)
(lit error "The stream {} is closed" #&lt;stream (in) {...}&gt;)

&gt; (read-char 2/3)
(lit error "{} is not a stream" 2/3)
</pre>
</div>
</li>

<li><a id="org113b196"></a><code>(peek-char stream)</code><br />
<div class="outline-text-5" id="text-11-7-2-4">
<p>
Lê um  único caractere no stream  de entrada informado, sem  avançar o
ponteiro de leitura do stream.
</p>

<p>
Caso  o stream  não seja  de  entrada, ou  caso seja  o stream  esteja
fechado,   ou   caso  <code>stream</code>   não   seja   um  stream,   retorna   um
erro.
</p>

<p>
Contrariamente, será retornado  o caractere lido ou, caso  o stream de
entrada tenha se esgotado, será retornado o símbolo <code>eof</code>.
</p>

<p>
Se houver  algum outro  problema no processo  de leitura,  essa função
poderá também retornar um erro indicando o problema em questão.
</p>

<p>
Supondo um  arquivo-texto <code>teste.txt</code>  contendo exatamente  os seguintes
caracteres, sem espaço em branco ao final&#x2026;
</p>

<pre class="example" id="org6302d1a">
Teste
</pre>

<p>
&#x2026;os exemplos a seguir utilizam-se de tal arquivo.
</p>

<pre class="example" id="org65520ee">
&gt; (def *my-stream* (open-stream 'in "teste.txt"))
*my-stream*

&gt; *my-stream*
#&lt;stream (in) {...}&gt;

&gt; (peek-char *my-stream*)
#\T

&gt; (peek-char *my-stream*)
#\T

&gt; (do (until (eq 'eof (peek-char *my-stream*))
        (display (read-char *my-stream*)))
      (terpri)
      (peek-char *my-stream*))
; Teste
;
eof

&gt; (close-stream *my-stream*)
t

&gt; (peek-char *stdout*)
(lit error "{} is not an input stream" #&lt;stream (out) {...}&gt;)

&gt; (peek-char *my-stream*)
(lit error "The stream {} is closed" #&lt;stream (in) {...}&gt;)

&gt; (peek-char 2/3)
(lit error "{} is not a stream" 2/3)
</pre>
</div>
</li>

<li><a id="orgdbc601d"></a><code>(write-char c stream)</code><br />
<div class="outline-text-5" id="text-11-7-2-5">
<p>
Escreve o  caractere <code>c</code>  no stream  de saída  informado, sem  espaço em
branco ao final.
</p>

<p>
Caso o stream não  seja de saída, ou caso o  stream esteja fechado, ou
caso  <code>stream</code> não  seja  um stream,  retorna  um erro.  Contrariamente,
retorna <code>nil</code>.
</p>

<p>
Se houver  algum outro  problema no processo  de escrita,  essa função
poderá também retornar um erro indicando o problema em questão.
</p>

<pre class="example" id="orgb975866">
&gt; (let ((stream *stdout*))
    (write-char #\a stream))
; a
nil

&gt; (let ((stream (open-stream 'out "teste.txt")))
    (close-stream stream)
    (write-char #\a stream))
(lit error "The stream {} is closed" #&lt;stream (out) {...}&gt;)

&gt; (let ((stream *stdin*))
    (write-char #\a stream))
(lit error "{} is not an output stream" #&lt;stream (in) {...}&gt;)

&gt; (write-char #\a 5)
(lit error "{} is not a stream" 5)

&gt; (write-char 5 *stdout*)
(lit error "{} is not a character" 5)
</pre>
</div>
</li>

<li><a id="org48dde3f"></a><code>(write-string str stream)</code><br />
<div class="outline-text-5" id="text-11-7-2-6">
<p>
Escreve  a string  <code>str</code> no  stream de  saída informado,  sem espaço  em
branco ao final.
</p>

<p>
A string escrita no stream, após  sua formatação, não deverá ter aspas
duplas (<code>"</code>) ao início, e nem ao final.
</p>

<p>
Caso o stream não  seja de saída, ou caso o  stream esteja fechado, ou
caso  <code>stream</code> não  seja  um stream,  retorna  um erro.  Contrariamente,
retorna <code>nil</code>.
</p>

<p>
Se houver  algum outro  problema no processo  de escrita,  essa função
poderá também retornar um erro indicando o problema em questão.
</p>

<pre class="example" id="org20cefc2">
&gt; (let ((stream *stdout*))
    (write-string "Hello" stream))
; Hello
nil

&gt; (let ((stream (open-stream 'out "teste.txt")))
    (close-stream stream)
    (write-string "Hello" stream))
(lit error "The stream {} is closed" #&lt;stream (out) {...}&gt;)

&gt; (let ((stream *stdin*))
    (write-string "Hello" stream))
(lit error "{} is not an output stream" #&lt;stream (in) {...}&gt;)

&gt; (write-string "Hello" 5)
(lit error "{} is not a stream" 5)

&gt; (write-string 5 *stdout*)
(lit error "{} is not a string" 5)
</pre>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orge549ebd" class="outline-3">
<h3 id="orge549ebd"><span class="section-number-3">11.8.</span> <span class="todo TODO">TODO</span> Formas Especiais</h3>
<div class="outline-text-3" id="text-11-8">
</div>
<div id="outline-container-orgbf4e46d" class="outline-4">
<h4 id="orgbf4e46d"><span class="section-number-4">11.8.1.</span> <code>(quote x)</code></h4>
<div class="outline-text-4" id="text-11-8-1">
<p>
Toma <code>x</code> como um valor, isto é, sem que <code>x</code> seja interpretado.
</p>

<pre class="example" id="orga330213">
&gt; (quote x)
x

&gt; (quote (1 2 3))
(1 2 3)

&gt; (quote (+ 5 6))
(+ 5 6)
</pre>
</div>
</div>

<div id="outline-container-org535dfd5" class="outline-4">
<h4 id="org535dfd5"><span class="section-number-4">11.8.2.</span> <code>(def sym val)</code></h4>
<div class="outline-text-4" id="text-11-8-2">
<p>
Associa o  valor <code>val</code> ao  símbolo <code>sym</code> no  contexto global, e  retorna o
símbolo ao qual <code>val</code> foi atribuído.
</p>

<p>
O objeto <code>sym</code> não será interpretado, mas deverá ser obrigatoriamente um
símbolo. <code>val</code> será interpretado antes de ser atribuído.
</p>

<p>
Caso <code>sym</code> não seja um símbolo, um erro será levantado.
</p>

<p>
Caso  <code>val</code> tenha  problemas  em  sua interpretação,  o  erro gerado  na
interpretação será retornado, e <code>sym</code> não será atribuído a valor algum.
</p>

<pre class="example" id="org5dc4d2d">
&gt; (def x 5)
x

&gt; (def (foo bar) 5)
(lit error "{} is not a symbol" (foo bar))

&gt; (def y (length x))
(lit error "{} is not a proper list" 5)
</pre>
</div>
</div>

<div id="outline-container-orgef8f555" class="outline-4">
<h4 id="orgef8f555"><span class="section-number-4">11.8.3.</span> <code>(set sym val)</code></h4>
<div class="outline-text-4" id="text-11-8-3">
<p>
Redefine o valor associado ao símbolo <code>sym</code>, inserindo <code>val</code> em seu lugar,
e retorna o símbolo ao qual <code>val</code> foi atribuído.
</p>

<p>
O objeto <code>sym</code> não será interpretado, mas deverá ser obrigatoriamente um
símbolo. <code>val</code> será interpretado antes de ser atribuído.
</p>

<p>
Caso <code>sym</code> não seja um símbolo, um erro será levantado.
</p>

<p>
Caso  <code>val</code> tenha  problemas  em  sua interpretação,  o  erro gerado  na
interpretação  será retornado,  e o  valor  associado a  <code>sym</code> não  será
modificado.
</p>

<p>
Durante o processo de atribuição,  <code>set</code> procura o símbolo definido mais
próximo  do escopo  em que  foi  invocado. Sendo  assim, <code>set</code>  primeiro
tentará encontrar o símbolo no escopo léxico atual; caso não encontre,
<code>set</code>   procurará   pelo  símbolo   no   escopo   léxico  em   que   foi
invocado. Subsequentemente, caso o  símbolo ainda não seja encontrado,
<code>set</code> procurará tal símbolo no escopo global.
</p>

<p>
Se  <code>sym</code>  não for  encontrado  em  nenhum  dos  escopos, um  erro  será
retornado.
</p>

<pre class="example" id="orgacbdda8">
&gt; (set x 5)
(lit error "{} is unbound" x)

&gt; (def x 1)
x

&gt; x
1

&gt; (set x 5)
x

&gt; x
5

&gt; (let ((x 6))
    (print "x = {}" x)
    (set x 9)
    (print "x = {}" x))
; x = 6
; x = 9
;
nil

&gt; x
5
</pre>
</div>
</div>

<div id="outline-container-org9312d62" class="outline-4">
<h4 id="org9312d62"><span class="section-number-4">11.8.4.</span> <code>(set-car x val)</code></h4>
<div class="outline-text-4" id="text-11-8-4">
<p>
Redefine o <i>car</i> da célula <i>cons</i> <code>x</code> pelo valor <code>val</code>.
</p>

<p>
<code>x</code> sempre será interpretado. Portanto, espera-se que o resultado de sua
interpretação  seja  uma  célula  <i>cons</i>   (seja  ligada  a  um  símbolo
informado, seja criada através da função <code>cons</code>, ou mesmo criada através
de <i>quotation</i> ou <i>quasiquotation</i>).
</p>

<p>
Caso o resultado da interpretação de  <code>x</code> não seja uma célula <i>cons</i>, será
retornado um  erro. Igualmente, erros na  interpretação de <code>x</code> e  de <code>val</code>
serão retornados antes que a modificação seja realizada.
</p>

<p>
Após a modificação, será retornada a célula <i>cons</i> modificada.
</p>

<p>
É  importante  prestar  atenção  a qual  célula  <i>cons</i>,  exatamente,  <code>x</code>
referencia.  Pode ser  interessante copiar  a lista  ou a  célula <i>cons</i>
modificada antes que a operação seja realizada.
</p>

<pre class="example" id="org2a6f732">
&gt; (def x '(1 . 2))
x

&gt; (set-car x 3)
(3 . 2)

&gt; (set-car '(9 . 0) 'f)
(f . 0)

&gt; (let ((x '(4 . 5)))
    (set-car x 9))
(9 . 5)

&gt; x
(3 . 2)

&gt; (let ((a x))
    (set-car a 4))
(4 . 2)

&gt; x
(4 . 2)

&gt; (let ((a (copy x)))
    (set-car a 5))
(5 . 2)

&gt; x
(4 . 2)
</pre>
</div>
</div>

<div id="outline-container-orgfc7b2ac" class="outline-4">
<h4 id="orgfc7b2ac"><span class="section-number-4">11.8.5.</span> <code>(set-cdr x val)</code></h4>
<div class="outline-text-4" id="text-11-8-5">
<p>
Redefine o <i>cdr</i> da célula <i>cons</i> <code>x</code> pelo valor <code>val</code>.
</p>

<p>
<code>x</code> sempre será interpretado. Portanto, espera-se que o resultado de sua
interpretação  seja  uma  célula  <i>cons</i>   (seja  ligada  a  um  símbolo
informado, seja criada através da função <code>cons</code>, ou mesmo criada através
de <i>quotation</i> ou <i>quasiquotation</i>).
</p>

<p>
Caso o resultado da interpretação de  <code>x</code> não seja uma célula <i>cons</i>, será
retornado um  erro. Igualmente, erros na  interpretação de <code>x</code> e  de <code>val</code>
serão retornados antes que a modificação seja realizada.
</p>

<p>
Após a modificação, será retornada a célula <i>cons</i> modificada.
</p>

<p>
É  importante  prestar  atenção  a qual  célula  <i>cons</i>,  exatamente,  <code>x</code>
referencia.  Pode ser  interessante copiar  a lista  ou a  célula <i>cons</i>
modificada antes que a operação seja realizada.
</p>

<pre class="example" id="orgef7c730">
&gt; (def x '(1 . 2))
x

&gt; (set-cdr x 3)
(1 . 3)

&gt; (set-cdr '(9 . 0) 'f)
(9 . f)

&gt; (let ((x '(4 . 5)))
    (set-cdr x 9))
(4 . 9)

&gt; x
(1 . 3)

&gt; (let ((a x))
    (set-cdr a 4))
(1 . 4)

&gt; x
(1 . 4)

&gt; (let ((a (copy x)))
    (set-cdr a 5))
(1 . 5)

&gt; x
(1 . 4)
</pre>
</div>
</div>

<div id="outline-container-org32a89e2" class="outline-4">
<h4 id="org32a89e2"><span class="section-number-4">11.8.6.</span> <code>(if pred conseq altern)</code></h4>
<div class="outline-text-4" id="text-11-8-6">
<p>
Realiza  a  interpretação  de uma  condicional  simples,  efetivamente
realizando controle de fluxo.
</p>

<p>
A forma  <code>pred</code> é, inicialmente, interpretada,  constituindo portanto um
<i>predicado</i>. Caso o  resultado desse predicado seja  um valor <i>verdadeiro</i>
(ou seja, qualquer  valor que não seja o símbolo  <code>nil</code>), a forma <code>conseq</code>
será interpretada, e seu valor será retornado.
</p>

<p>
Caso contrário,  a forma  <code>altern</code> será interpretada,  e seu  valor será
retornado.
</p>

<pre class="example" id="orgcfc2ed4">
&gt; (if (nilp 'a)
      'is-nil
      'is-not-nil)
is-not-nil

&gt; (if (nilp nil)
      'is-nil
      'is-not-nil)
is-nil
</pre>

<p>
Caso  seja necessário  interpretar mais  de uma  forma nos  lugares de
<code>conseq</code> e/ou  <code>altern</code>, recomenda-se associá-las usando  a forma especial
<code>do</code>.
</p>
</div>
</div>

<div id="outline-container-org4c27129" class="outline-4">
<h4 id="org4c27129"><span class="section-number-4">11.8.7.</span> <code>(fn lambda-list . body)</code></h4>
<div class="outline-text-4" id="text-11-8-7">
<p>
Gera um <i>literal</i> para uma clausura.  Esta forma especial é similar a um
macro, porém realiza explicitamente a captura do escopo léxico atual.
</p>

<p>
Uma forma como
</p>

<pre class="example" id="org3b5f601">
(fn (x) (* x x))
</pre>

<p>
gera um literal
</p>

<pre class="example" id="org82b26ef">
(lit closure &lt;env&gt; (x) ((* x x)))
</pre>

<p>
onde <code>&lt;env&gt;</code> é  o contexto léxico no qual a clausura foi declarada.
</p>

<p>
O corpo  de uma  clausura é  armazenado em  uma lista  com um  ou mais
elementos, onde  cada elemento é  uma expressão individual.  Durante a
aplicação da mesma,  os elementos são avaliados em  sequência (como se
houvesse uma  forma especial  <code>do</code> implícita),  tendo em  consideração o
contexto léxico <code>&lt;env&gt;</code> que foi  capturado, extendido com ligações entre
os elementos  da <i>lambda list</i>  e os  valores passados como  parâmetro à
clausura.
</p>

<p>
O literal gerado  pode ser representado, durante a  impressão, como um
objeto que não possa ser lido pelo interpretador.
</p>

<p>
Para maiores informações, veja <i>Aplicação</i> e <i>Interpretação</i>.
</p>

<pre class="example" id="orge2dbaf6">
&gt; (fn (x) (* x x))
#&lt;function (fn (x)) {...}&gt;

&gt; (fn (x . rest) (list x rest))
#&lt;function (fn (x . rest)) {...}&gt;

&gt; ((fn (x) (* x x)) 5)
25

&gt; (def square (fn (x) (* x x)))
square

&gt; (square 5)
25
</pre>
</div>
</div>

<div id="outline-container-org98fe1ff" class="outline-4">
<h4 id="org98fe1ff"><span class="section-number-4">11.8.8.</span> <code>(mac lambda-list . body)</code></h4>
<div class="outline-text-4" id="text-11-8-8">
<p>
Gera um literal para um macro. Esta forma especial, na realidade, gera
internamente  uma  clausura  que,  quando  aplicada  a  uma  lista  de
argumentos, transforma essa lista de argumentos em uma nova lista, que
poderá então ser interpretada, de forma subsequente.
</p>

<p>
Assim,  um macro  também é  capaz  de capturar  o contexto  no qual  é
declarado.
</p>

<p>
Uma forma como
</p>

<pre class="example" id="orgfe4cd9a">
(mac (x) `(list ,x))
</pre>

<p>
gera um literal
</p>

<pre class="example" id="orgc780041">
(lit macro (lit closure &lt;env&gt; (x) (`(list ,x))))
</pre>

<p>
onde <code>&lt;env&gt;</code> é  o contexto léxico no qual o macro foi declarado.
</p>

<p>
As regras  sintáticas da  forma especial  <code>mac</code> acabam  sendo exatamente
iguais às da forma <code>fn</code>, pela  definição de que um <i>macro</i> constitui-se de
uma clausura subjacente.
</p>

<p>
Um <i>macro</i> não pode ser aplicado  através da forma <code>apply</code>, porém pode ser
aplicado  como se  fosse  uma  clausura comum.  Neste  caso, o  objeto
aplicado gera uma nova expressão que será imediatamente interpretada.
</p>

<p>
O uso do macro poderá ser verificado através de atribuí-lo a um nome e
então realizar apenas a expansão do  mesmo, através de uma função como
<code>macroexpand-1</code>.
</p>

<p>
O literal gerado  pode ser representado, durante a  impressão, como um
objeto que não possa ser lido pelo interpretador.
</p>

<pre class="example" id="org0193459">
&gt; (mac (x) `(list ,x))
#&lt;macro (mac (x)) {...}&gt;

&gt; ((mac (x) `(list ,x)) 5)
(5)

&gt; (def encapsulate (mac (x) `(list ,x)))
encapsulate

&gt; (macroexpand-1 '(encapsulate 5))
(list 5)

&gt; (encapsulate 5)
(5)
</pre>
</div>
</div>

<div id="outline-container-org84551ca" class="outline-4">
<h4 id="org84551ca"><span class="section-number-4">11.8.9.</span> <code>(quasiquote x)</code>, <code>(unquote x)</code>, <code>(unquote-splice x)</code></h4>
<div class="outline-text-4" id="text-11-8-9">
<p>
Percorre recursivamente <code>x</code>, alternando todas  as formas iniciadas com o
símbolo <code>unquote</code> por  sua interpretação no contexto atual.
Caso <code>x</code> seja meramente um símbolo ou uma lista sem <code>unquote</code>, o resultado
será o mesmo de <code>quote</code>:
</p>

<pre class="example" id="orgf17310e">
&gt; (quote a)
a

&gt; (quasiquote a)
a
</pre>

<p>
Caso não o seja, o resultado será uma nova lista ou objeto, tal que os
elementos sob <code>unquote</code> sejam trocados em seus lugares corretos.
</p>

<pre class="example" id="org3e6b2b6">
&gt; (let ((x 5)  (y 6))
    (quasiquote (1 (unquote x) (unquote y))))
(1 5 6)
</pre>

<p>
Caso queiramos  anexar os  elementos de uma  lista diretamente  em uma
lista atual, podemos usar <code>unquote-splice</code> para fazê-lo.
</p>

<pre class="example" id="org6f4df1e">
&gt; (let ((lst (list 1 2 3)))
    (quasiquote (0 (unquote lst))))
(0 (1 2 3))

&gt; (let ((lst (list 1 2 3)))
    (quasiquote (0 (unquote-splice lst))))
(0 1 2 3)
</pre>
</div>
</div>

<div id="outline-container-org726a052" class="outline-4">
<h4 id="org726a052"><span class="section-number-4">11.8.10.</span> <code>(do . rest)</code></h4>
<div class="outline-text-4" id="text-11-8-10">
<p>
Interpreta os  valores de  cada uma das  expressões contidas  na lista
<code>rest</code>, e então retorna o valor da última expressões.
</p>

<p>
Se alguma expressão emitir um  erro, a interpretação será interrompida
e o erro será retornado.
</p>

<p>
Caso não haja expressões disponíveis, retorna <code>nil</code>.
</p>

<pre class="example" id="org2220873">
&gt; (do 'a 'b (list 'c 'd 'e))
(c d e)

&gt; (do)
nil
</pre>

<p>
Alguns  macros  e  formas  especiais  utilizam  <code>do</code>'s  implícitos  para
possibilitar declarações menos  redundantes. Para maiores informações,
veja as formas  especiais <code>fn</code>, <code>mac</code> e <code>letrec</code>, e  os macros <code>defn</code>, <code>defmac</code>,
<code>let</code>, <code>let*</code>, <code>letfn</code>, <code>letfn*</code>, <code>when</code>, <code>unless</code> e <code>cond</code>.
</p>
</div>
</div>

<div id="outline-container-org08f2467" class="outline-4">
<h4 id="org08f2467"><span class="section-number-4">11.8.11.</span> <span class="todo TODO">TODO</span> <code>(apply fun args)</code></h4>
<div class="outline-text-4" id="text-11-8-11">
<p>
Aplica a função <code>fun</code> à lista de argumentos <code>args</code>. Ambos <code>fun</code> e <code>args</code> serão
interpretados antes de serem apropriadamente aplicados.
</p>

<p>
<code>fun</code>  não  pode ser  um  macro.  Macros  possuem uso  especialmente  em
situações de reescrita de código, o  que constitui um tipo especial de
aplicação, a ser feita antes de uma interpretação propriamente dita.
</p>

<p>
Esta operação equivale  a interpretar o resultado de  <code>(cons fun args)</code>,
portanto,  a  função  <code>fun</code>  e  cada um  dos  argumentos  em  <code>args</code>  será
devidamente interpretado antes de realizar a aplicação.
</p>

<pre class="example" id="org2b5db6f">
&gt; (let ((fun (fn (x y) (+ x y))))
    (apply fun '(1 2)))
3

&gt; (apply cond '((t 1)))
(lit error "Macros cannot be applied")

&gt; (apply 1 '(2))
(lit error "Cannot apply {} to args {}" 1 (2))
</pre>
</div>
</div>

<div id="outline-container-org60aa373" class="outline-4">
<h4 id="org60aa373"><span class="section-number-4">11.8.12.</span> <code>(while pred . body)</code></h4>
<div class="outline-text-4" id="text-11-8-12">
<p>
Executa  sequencialmente o  conjunto  de expressões  contidas em  <code>body</code>
enquanto o predicado <code>pred</code> retornar um valor verdadeiro.
</p>

<p>
A forma <code>while</code> permite executar  código iterativamente, com garantia de
que o processo de iteração em si  não faça com que a pilha de chamadas
do sistema chegue à exaustão.
</p>

<p>
O valor  retornado pela forma  especial <code>while</code>  será o valor  da última
expressão de <code>body</code>,  ao ser executada na última  iteração. Caso nenhuma
iteração tenha ainda ocorrido, será retornado o símbolo <code>nil</code>.
</p>

<p>
<code>body</code>  também poderá  ser uma  expressão vazia,  o que  configuraria um
<i>spinlock</i> na duração da validade do predicado.
</p>

<p>
Caso o  predicado <code>pred</code> ou alguma  expressão de <code>body</code> retornem  erros, o
laço de <code>while</code> será imediatamente quebrado e o erro será retornado.
</p>

<pre class="example" id="org4ac24e3">
&gt; (let ((x 0))
    (while (&lt; x 5)
      (print "x = {}" x)
      (set x (1+ x))))
; x = 0
; x = 1
; x = 2
; x = 3
; x = 4
;
x

&gt; (let ((lst '(1 2 3 a 5)))
    (while (not (nilp lst))
      (let (((num . rest) lst))
        (print "2 = {}? {}"
               num
               (= 2 num))
        (set lst rest))))
; 2 = 1? nil
; 2 = 2? t
; 2 = 3? nil
;
(lit error "{} is not a number" a)

&gt; (let ((lst '(1 2 3 NaN 5)))
    (while (&lt; (car lst) 5)
      (let (((num . rest) lst))
        (print "{}" num)
        (set lst rest))))
; 1
; 2
; 3
;
(lit error "{} is not a number" NaN)
</pre>
</div>
</div>

<div id="outline-container-orgc06bf0f" class="outline-4">
<h4 id="orgc06bf0f"><span class="section-number-4">11.8.13.</span> <code>(and . rest)</code></h4>
<div class="outline-text-4" id="text-11-8-13">
<p>
Interpreta os  valores de  cada uma das  expressões contidas  na lista
<code>rest</code>,  enquanto as  interpretações  resultarem em  valores não-<code>nil</code>,  e
então retorna o valor da última expressão.
</p>

<p>
Quando  uma  expressão  gera  um  resultado  <code>nil</code>,  a  interpretação  é
interrompida, como anteriormente citado, e <code>nil</code> é retornado.
</p>

<p>
Se alguma expressão emitir um  erro, a interpretação será interrompida
e o erro será retornado.
</p>

<p>
Caso não haja expressões disponíveis, retorna <code>t</code>.
</p>

<pre class="example" id="orgeff689a">
&gt; (and (= 1 1) (= 0.5 1/2) 'ok)
ok

&gt; (and (= 1 1) (&lt; 0.5 1/2) 'ok)
nil

&gt; (and)
t
</pre>
</div>
</div>

<div id="outline-container-org3664058" class="outline-4">
<h4 id="org3664058"><span class="section-number-4">11.8.14.</span> <code>(or . rest)</code></h4>
<div class="outline-text-4" id="text-11-8-14">
<p>
Interpreta os  valores de  cada uma das  expressões contidas  na lista
<code>rest</code>, enquanto as interpretações resultarem no valor <code>nil</code>.
</p>

<p>
Quando  uma expressão  gera um  resultado não-<code>nil</code>,  a interpretação  é
interrompida, como anteriormente citado, e o valor da interpretação da
expressão em questão é retornado.
</p>

<p>
Se alguma expressão emitir um  erro, a interpretação será interrompida
e o erro será retornado.
</p>

<p>
Caso não haja expressões disponíveis, retorna <code>nil</code>.
</p>

<pre class="example" id="org97149ca">
&gt; (or (not (= 1 1)) (&lt; 0.5 1/2) 'ok)
ok

&gt; (or (= 1 1) (&lt; 0.5 1/2))
t

&gt; (or)
nil
</pre>
</div>
</div>

<div id="outline-container-org72c097c" class="outline-4">
<h4 id="org72c097c"><span class="section-number-4">11.8.15.</span> <code>(letrec bindings . body)</code></h4>
<div class="outline-text-4" id="text-11-8-15">
<p>
Define uma lista de funções que serão bem-definidas durante a execução
da expressão <code>body</code>.
</p>

<p>
<code>bindings</code>  é uma  lista  de  definições de  funções  similares a  <code>defn</code>,
todavia  sem o  símbolo <code>defn</code>  em seu  início. <code>letrec</code>  segue as  mesmas
regras sintáticas de <code>letfn</code> e <code>letfn*</code>.
</p>

<p>
O funcionamento de <code>letrec</code> aproxima-se muito  do uso prático de <code>letfn</code> e
<code>letfn*</code>.  Todavia,  <code>letrec</code> permite  a declaração de  <i>funções mutuamente
recursivas</i>,    <b>puramente    através     de    um    contexto    léxico
compartilhado</b>.   Para  tanto,  cada  função ali  declarada  captura  o
próprio contexto criado por <code>letrec</code> <i>após a definição</i> das mesmas.
</p>

<p>
Essa característica torna <code>letrec</code>  fundamentalmente diferente de <code>letfn</code>,
uma vez que  todas as funções envolvidas terão  referências às funções
ali  declaradas. Em  outras palavras,  o uso  recursivo de  uma função
declarada com  <code>letrec</code> não implica em  procura da mesma em  um contexto
"dinâmico" (ou seja, no contexto onde tal função foi chamada).
</p>

<p>
Um  bloco <code>letrec</code>  pode, portanto,  retornar uma  de suas  clausuras, e
qualquer recursão ou recursão mútua  na mesma não será degenerada pela
procura recursiva de  uma das funções declaradas no  contexto onde for
executada.
</p>

<p>
Como esse  tipo de operação exige  modificar a forma como  funções são
declaradas  &#x2013; mais  precisamente,  modificar a  forma  como ocorre  a
captura  de  contexto  &#x2013;,  <code>letrec</code> precisa  ser  uma  forma  especial,
diferente de <code>letfn</code> e <code>let</code>, que podem ser declarados como macros.
</p>

<pre class="example" id="orgc9687da">
&gt; (letrec ((foo ()
             (print "Calling foo")
             (bar))
           (bar ()
             (print "Calling bar")
             (baz))
           (baz ()
             (print "Calling baz")))
    (foo))
; Calling foo
; Calling bar
; Calling baz
; 
nil

&gt; (letrec ((iter (x)
             (if (&gt; x 0)
                 (do (print "Recursion #{}" x)
                     (iter (1- x)))
                 'finished)))
    (iter 5))
; Recursion #5
; Recursion #4
; Recursion #3
; Recursion #2
; Recursion #1
; 
finished

&gt; (def my-function
       (letrec ((foo () (bar))
                (bar ()
                  (print "Hello from bar on letrec")))
         foo))
my-function

&gt; (my-function)
; Hello from bar on letrec
; 
nil
</pre>
</div>
</div>

<div id="outline-container-org0190fba" class="outline-4">
<h4 id="org0190fba"><span class="section-number-4">11.8.16.</span> <code>(unwind-protect expr cleanup)</code></h4>
<div class="outline-text-4" id="text-11-8-16">
<p>
<code>unwind-protect</code> interpreta  a expressão protegida <code>expr</code>  e, independente
de  tal  interpretação resultar  em  falha,  garante que  a  expressão
<code>cleanup</code> seja sempre interpretada em seguida.
</p>

<p>
<code>unwind-protect</code> deve retornar a  interpretação de <code>expr</code>, independente de
a mesma ser um erro ou não. O resultado de <code>cleanup</code> será ignorado.
</p>

<p>
<code>unwind-protect</code>  é uma  forma especial  utilizada para  garantir certos
efeitos colaterais  como forma  de limpeza após  a execução  de certas
expressões<sup><a id="fnr.6" class="footref" href="#fn.6" role="doc-backlink">6</a></sup>, e não  realiza prevenções contra falhas  em casos de
terminação anormal do processo de interpretação.
</p>

<p>
Por exemplo, <code>unwind-protect</code> não garante que, mediante uma operação que
faça  com que  a aplicação  entre em  um estado  irrecuperável, ocorra
algum  tipo  de limpeza;  neste  tipo  de  situação, espera-se  que  a
aplicação encerre-se imediatamente.
</p>

<p>
Supondo um  arquivo-texto <code>teste.txt</code>  contendo exatamente  os seguintes
caracteres, sem espaço em branco ao final&#x2026;
</p>

<pre class="example" id="org3c39bc9">
Teste
</pre>

<p>
&#x2026;os exemplos a seguir utilizam-se de tal arquivo.
</p>

<pre class="example" id="orgeee3622">
&gt; (def *my-stream* nil)
*my-stream*

&gt; (unwind-protect
      (do (set *my-stream* (open-stream 'in "teste.txt"))
          (read-char *my-stream*))
    (do (close-stream *my-stream*)
        (set *my-stream* nil)))
#\T

&gt; *my-stream*
nil

&gt; (do (set *my-stream* (open-stream 'out "teste.txt"))
      (read-char *my-stream*))
(lit error "{} is not an input stream" #&lt;stream (out) {...}&gt;)

&gt; *my-stream*
#&lt;stream (out) {...}&gt;

&gt; (do (close-stream *my-stream*)
      (set *my-stream* nil))
*my-stream*

&gt; *my-stream*
nil

&gt; (unwind-protect
      (do (set *my-stream* (open-stream 'out "teste.txt"))
          (read-char *my-stream*))
    (do (close-stream *my-stream*)
        (set *my-stream* nil)))
(lit error "{} is not an input stream" #&lt;stream (out) {...}&gt;)

&gt; *my-stream*
nil
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb5f4b07" class="outline-3">
<h3 id="orgb5f4b07"><span class="section-number-3">11.9.</span> Macros do leitor de expressões</h3>
<div class="outline-text-3" id="text-11-9">
</div>
<div id="outline-container-org30f5a4a" class="outline-4">
<h4 id="org30f5a4a"><span class="section-number-4">11.9.1.</span> Quote (<code>'</code>)</h4>
<div class="outline-text-4" id="text-11-9-1">
<p>
O macro de leitor <code>'</code> aplica a  forma especial <code>quote</code> ao próximo objeto a
ser lido.
</p>

<p>
Esse  símbolo deverá  ser apresentado  junto  ao objeto  à direita  do
mesmo, sem espaços separando-os.
</p>

<p>
Por exemplo, os objetos quotados a seguir
</p>

<pre class="example" id="org0b9f9d4">
(quote a)
(quote (1 2 3))
</pre>

<p>
poderão ser reescritos usando o macro de leitor da seguinte forma:
</p>

<pre class="example" id="orgba6edd4">
'a
'(1 2 3)
</pre>
</div>
</div>

<div id="outline-container-org3a26282" class="outline-4">
<h4 id="org3a26282"><span class="section-number-4">11.9.2.</span> Quasiquote (<code>`</code>)</h4>
<div class="outline-text-4" id="text-11-9-2">
<p>
O macro  de leitor <code>`</code>  ajuda a escrever  o processo de  quasiquoting de
forma  sucinta. Em  suma,  o  próximo objeto  a  ser  lido deverá  ser
englobado em uma forma especial de <code>quasiquote</code>.
</p>

<p>
Esse  símbolo deverá  ser apresentado  junto  ao objeto  à direita  do
mesmo, sem espaços separando-os.
</p>

<p>
Por exemplo, uma forma como
</p>

<pre class="example" id="org79da43d">
(quasiquote (x))
</pre>

<p>
poderá ser escrita, de forma sucinta, como
</p>

<pre class="example" id="org43be561">
`(x)
</pre>

<p>
Veja  que o  objeto quasi-quotado  passa a  ficar em  evidência, sendo
precedido pelo símbolo <code>`</code>, de forma similar a um objeto quotado.
</p>
</div>
</div>

<div id="outline-container-orgc8e55aa" class="outline-4">
<h4 id="orgc8e55aa"><span class="section-number-4">11.9.3.</span> Unquote (<code>,</code>)</h4>
<div class="outline-text-4" id="text-11-9-3">
<p>
O macro de leitor <code>,</code> ajuda a  escrever o processo de unquoting de forma
sucinta. Este macro de leitor só  será válido no interior de uma forma
especial de quasiquoting.
</p>

<p>
Esse  símbolo deverá  ser apresentado  junto  ao objeto  à direita  do
mesmo, sem espaços separando-os.
</p>

<p>
Por  exemplo, considere  a forma  a seguir,  que faz  uso do  macro de
leitor para quasiquoting:
</p>

<pre class="example" id="org3e3c03a">
`(+ (unquote x) (unquote y))
</pre>

<p>
Podemos reescrevê-la facilmente com o uso do novo macro de leitor para
unquoting:
</p>

<pre class="example" id="orgd96ec8f">
`(+ ,x ,y)
</pre>
</div>
</div>

<div id="outline-container-org98bb2e3" class="outline-4">
<h4 id="org98bb2e3"><span class="section-number-4">11.9.4.</span> Unquote-Splice (<code>,@</code>)</h4>
<div class="outline-text-4" id="text-11-9-4">
<p>
O  macro de  leitor  <code>,@</code> é  similar ao  unquote,  todavia representa  o
processo de  unquoting para  os elementos de  uma lista,  que chamamos
<code>unquote-splice</code>. Assim, podemos considerá-lo como uma especialização do
macro de leitor de unquote (<code>,</code>).
</p>

<p>
Essa sequência  de símbolos deverá  ser apresentada junto ao  objeto à
direita da mesma, sem espaços para separação.
</p>

<p>
Por exemplo, considere a forma a seguir, levando em consideração que <code>x</code>
é uma lista adequada:
</p>

<pre class="example" id="org5850f1b">
`(,y (unquote-splice x))
</pre>

<p>
Para reescrever esta expressão de  forma sucinta, poderemos usar nosso
novo macro de leitor:
</p>

<pre class="example" id="org0fa89cd">
`(,y ,@x)
</pre>
</div>
</div>

<div id="outline-container-orgc471081" class="outline-4">
<h4 id="orgc471081"><span class="section-number-4">11.9.5.</span> Sintaxe de vetores (<code>[ ]</code>)</h4>
<div class="outline-text-4" id="text-11-9-5">
<p>
Os macros de leitor  <code>[</code> e <code>]</code> delimitam uma sequência  de itens que serão
interpretados  e   transformados  em  um  vetor.   Podemos,  portanto,
considerá-los uma sintaxe alternativa para o uso da função <code>vector</code>.
</p>

<p>
Por exemplo, considere um vetor declarado da forma a seguir:
</p>

<pre class="example" id="org4b378af">
(vector 1 2 'a 3 (+ 2 5))
</pre>

<p>
Esta chamada de  função em específico poderá ser reescrita  da forma a
seguir:
</p>

<pre class="example" id="org69b2fa3">
[1 2 'a 3 (+ 2 5)]
</pre>
</div>
</div>
</div>

<div id="outline-container-org52f4cd2" class="outline-3">
<h3 id="org52f4cd2"><span class="section-number-3">11.10.</span> Macros</h3>
<div class="outline-text-3" id="text-11-10">
<p>
Macros  nada mais  são que  funções aplicadas  a expressões  ainda não
interpretadas.  As expressões  são  tratadas  como meras  informações,
processadas  pelo  <i>macro</i>, e  seu  resultado  então será  utilizado  na
interpretação em questão.
</p>
</div>

<div id="outline-container-org7233547" class="outline-4">
<h4 id="org7233547"><span class="section-number-4">11.10.1.</span> <code>(cond . clauses)</code></h4>
<div class="outline-text-4" id="text-11-10-1">
<p>
Realiza  a  interpretação  de múltiplas  condicionais  encadeadas,  em
sequência.
</p>

<p>
<code>cond</code> tira proveito das capabilidades  de <code>if</code>, a estrutura apropriada de
controle de fluxo.  Isso significa que cada cláusula de  <code>cond</code> deve ser
avaliada como se fosse  o <i>predicado</i> e a <i>consequência</i> de  um <code>if</code>; caso o
<i>predicado</i> não  seja verdadeiro, a  execução continua como se  <code>cond</code> não
tivesse tal cláusula avaliada.
</p>

<p>
Uma possível implementação para <code>cond</code> poderia ser:
</p>

<pre class="example" id="orgf055cbc">
(defmac cond clauses
  (if (nilp clauses)
      nil
      `(if ,(caar clauses)
           ,(car (cdar clauses))
           ,(if (nilp (cdr clauses))
                nil
                (cons 'cond (cdr clauses))))))
</pre>

<p>
Dessa forma, o seguinte uso do macro <code>cond</code>&#x2026;
</p>

<pre class="example" id="orgb64fef1">
(cond ((zerop x) 0)
      ((&lt; x 1) (- x))
      (t x))
</pre>

<p>
&#x2026;expande-se completamente para a forma:
</p>

<pre class="example" id="org30369ac">
(if (zerop x)
    0
    (if (&lt; x 1)
        (- x)
        (if t x nil)))
</pre>

<p>
Assim, o <code>cond</code> nada mais é que  a utilização de <code>if</code>'s em sequência, onde
a  escrita  dos mesmos  geraria  indentação  excessiva ou  desconforto
visual.
</p>

<p>
O uso  do símbolo <code>t</code>  na última cláusula define  <code>t</code> como sendo  o último
predicado,  ou seja,  fará com  que  a última  comparação seja  sempre
verdadeira, o que idiomaticamente  equipara-se ao uso da palavra-chave
<code>else</code> em  outras linguagens. Se  <code>t</code> não  for utilizado para  garantir um
valor final de retorno, será retornado sempre o símbolo <code>nil</code>.
</p>

<pre class="example" id="orgf838286">
&gt; (let ((x 1))
    (cond ((zerop x) 0)
          ((&lt; x 1) (- x))
          (t x)))
1

&gt; (let ((x 0))   
    (cond ((zerop x) 0)
          ((&lt; x 1) (- x))
          (t x)))
0

&gt; (cond (t 'a))
a

&gt; (cond ((eq 'a 'b) 'ok))
nil
</pre>
</div>
</div>

<div id="outline-container-org599a342" class="outline-4">
<h4 id="org599a342"><span class="section-number-4">11.10.2.</span> <code>(defn name lambda-list . body)</code></h4>
<div class="outline-text-4" id="text-11-10-2">
<p>
Associa uma literal de clausura ao símbolo <code>name</code> no contexto global.
</p>

<p>
Uma possível implementação desse macro seria:
</p>

<pre class="example" id="org197caad">
(defmac defn (label lambda-list . body)
  `(def ,label (fn ,lambda-list ,@body)))
</pre>

<p>
Isto leva à conclusão de que a forma a seguir&#x2026;
</p>

<pre class="example" id="orgba765bb">
(defn name lambda-list . body)
</pre>

<p>
&#x2026;será expandida para a seguinte expressão:
</p>

<pre class="example" id="org42e7c7b">
(def name (fn lambda-list . body))
</pre>

<p>
As demais regras para uso das formas especiais <code>def</code> e <code>fn</code> se aplicam.
</p>
</div>
</div>

<div id="outline-container-orgc6d426c" class="outline-4">
<h4 id="orgc6d426c"><span class="section-number-4">11.10.3.</span> <code>(defmac name lambda-list . body)</code></h4>
<div class="outline-text-4" id="text-11-10-3">
<p>
Associa uma literal de macro ao símbolo <code>name</code> no contexto global.
</p>

<p>
Uma possível implementação desse macro seria:
</p>

<pre class="example" id="orgb6c2f56">
(def defmac
  (mac (label lambda-list . body)
       `(def ,label
            (mac ,lambda-list ,@body))))
</pre>

<p>
Isto leva à conclusão de que a forma a seguir&#x2026;
</p>

<pre class="example" id="org7119503">
(defmac name lambda-list . body)
</pre>

<p>
&#x2026;será expandida para a seguinte expressão:
</p>

<pre class="example" id="org3378058">
(def name (mac lambda-list . body))
</pre>

<p>
As demais regras para uso das formas especiais <code>def</code> e <code>mac</code> se aplicam.
</p>
</div>
</div>

<div id="outline-container-orgfefcf05" class="outline-4">
<h4 id="orgfefcf05"><span class="section-number-4">11.10.4.</span> <code>(let bindings . body)</code></h4>
<div class="outline-text-4" id="text-11-10-4">
<p>
Cria  um contexto  léxico onde  valores sejam  bem-definidos, e  então
interpreta uma série de expressões  em sequência delimitadas por <code>body</code>,
retornando o valor da última expressão interpretada.
</p>

<p>
Caso haja  um erro em  alguma das  interpretações ou na  definição das
variáveis,  a execução  é  interrompida imediatamente  e  o erro  será
retornado.
</p>

<p>
A  sintaxe para  as  ligações  é dada  pela  lista  de listas  chamada
<code>bindings</code>,  onde cada  sublista  possui exatamente  dois elementos,  no
seguinte molde:
</p>

<pre class="example" id="orgc5ea282">
((x1 v1) (x2 v2) (x3 v3) ... (xn vn))
</pre>

<p>
No  exemplo acima,  as expressões  <code>x1</code>, <code>x2</code>,  &#x2026;, <code>xn</code>  dizem respeito  a
expressões  às  quais  os  valores  <code>v1</code>,  <code>v2</code>,  &#x2026;,  <code>vn</code>  serão  ligados
respectivamente, após suas interpretações.
</p>

<p>
As expressões  <code>x1</code>, &#x2026;, <code>xn</code>  não necessariamente precisam  ser símbolos
únicos,   podendo  ser   listas  adequadas   ou  pontuadas;   o  valor
interpretado a ser atribuído a essas expressões será desestruturado de
acordo com a  forma das expressões <code>x1</code>, &#x2026;, <code>xn</code>.  Isso está diretamente
correlacionado com a forma como  funções ligam seus parâmetros formais
aos valores a elas fornecidos.
</p>

<p>
As definições de variáveis não podem ser dependentes umas das outras.
</p>

<p>
De fato, por ser um macro, <code>let</code> pode ser definido da seguinte forma:
</p>

<pre class="example" id="org8bc8247">
(defmac let (args . body)
  ((fn (sepfn)
     ((fn ((syms vals))
        `((fn ,syms ,@body)
          ,@vals))
      (sepfn args nil nil sepfn)))
   (fn (pairs syms vals recur)
       (if (nilp pairs)
           (list syms vals)
           (recur (cdr pairs)
                  (cons (caar pairs) syms)
                  (cons (car (cdar pairs)) vals)
                  recur)))))
</pre>

<p>
Apesar de  não ser uma implementação  trivial, o <i>macro</i> <code>let</code>  sugere que
uma expressão como&#x2026;
</p>

<pre class="example" id="org49e81d4">
(let ((x 1) (y 2))
  (+ x y))
</pre>

<p>
&#x2026;será transformada na expressão a seguir:
</p>

<pre class="example" id="org977c8b9">
((fn (y x) (+ x y)) 2 1)
</pre>

<p>
Portanto,  todo  e  qualquer  uso  de  <code>let</code>  corresponderá,  mesmo  que
teoricamente, a uma  aplicação <i>ad-hoc</i> de uma função  anônima, e poderá
usufruir  dos  recursos desse  processo  de  aplicação de  uma  função
(exceto em casos de aplicação parcial).
</p>
</div>
</div>

<div id="outline-container-orgbe7d3d7" class="outline-4">
<h4 id="orgbe7d3d7"><span class="section-number-4">11.10.5.</span> <code>(let* bindings . body)</code></h4>
<div class="outline-text-4" id="text-11-10-5">
<p>
Cria  contextos léxicos  em  sequência com  valores bem-definidos,  de
forma que uma definição de valores possa depender das definições que a
precedem, e  então interpreta  uma série  de expressões  em sequência,
delimitadas   por  <code>body</code>.   Retorna   o  valor   da  última   expressão
interpretada.
</p>

<p>
Caso haja  um erro em  alguma das  interpretações ou na  definição das
variáveis,  a execução  é  interrompida imediatamente  e  o erro  será
retornado.
</p>

<p>
Dessa forma, <code>let*</code> poderia ser definido como:
</p>

<pre class="example" id="orgbfc39f2">
(defmac let* (clauses . body)
  (if (nilp clauses)
      (cons 'do body)
      `(let (,(car clauses))
         ,(if (nilp (cdr clauses))
              (cons 'do body)
              `(let* ,(cdr clauses)
                 ,@body)))))
</pre>

<p>
Em outras  palavras, trata-se de  uma versão  especial de <code>let</code>,  onde a
definição de  uma variável  pode depender das  variáveis anteriormente
definidas.
</p>

<p>
Considerando a seguinte expressão:
</p>

<pre class="example" id="org1239439">
(let* ((x (* 2 3))
       (y (1+ x))
       (z (+ y 3)))
  (+ x y z))
</pre>

<p>
Ela poderá ser expandida para a forma a seguir:
</p>

<pre class="example" id="orgabeb8bc">
(let ((x (* 2 3)))
  (let* ((y (1+ x))
         (z (+ y 3)))
    (+ x y z)))
</pre>

<p>
Como se pode observar, a expansão  de <code>let*</code> culmina no uso recursivo do
próprio macro, com usos sequenciais do macro <code>let</code>.
</p>

<p>
Uma expansão  parcial do uso recursivo  de <code>let*</code> no exemplo  culmina em
algo com uma execução similar à expressão:
</p>

<pre class="example" id="org5bfc80e">
(let ((x (* 2 3)))
  (let ((y (1+ x)))
    (let ((z (+ y 3)))
      (+ x y z))))
</pre>

<p>
Ou, expandindo todos os usos de <code>let</code>:
</p>

<pre class="example" id="orgd2af571">
((fn (x)
  ((fn (y)
     ((fn (z)
        (+ x y z))
      (+ y 3)))
   (1+ x)))
  (* 2 3))
</pre>

<p>
Dessa  forma, fica  claro  que  cada definição  de  variáveis em  <code>let*</code>
é efetuada  em um contexto  onde as variáveis  anteriormente definidas
estejam bem-definidas.
</p>
</div>
</div>

<div id="outline-container-org17ee99e" class="outline-4">
<h4 id="org17ee99e"><span class="section-number-4">11.10.6.</span> <code>(letfn bindings . body)</code></h4>
<div class="outline-text-4" id="text-11-10-6">
<p>
Cria um contexto  léxico onde certas funções  estejam bem-definidas, e
então interpreta uma série de expressões em sequência, delimitadas por
<code>body</code>. Retorna   o  valor   da  última   expressão interpretada.
</p>

<p>
Caso haja  um erro em  alguma das  interpretações ou na  definição das
funções,  a  execução  é  interrompida imediatamente  e  o  erro  será
retornado.
</p>

<p>
<code>letfn</code> é,  na prática,  uma versão  modificada de  <code>let</code>, onde  cada caso
inscrito na lista  <code>bindings</code> é uma sublista que se  assemelha ao uso de
<code>defn</code>.
</p>

<p>
Sendo assim, <code>bindings</code> segue uma estrutura similar ao exemplo:
</p>

<pre class="example" id="org92ba06f">
((function1 () body1) ... (functionN () bodyN))
</pre>

<p>
Dessa   forma,   as   funções  <code>function1</code>,   &#x2026;,   <code>functionN</code>   estarão
bem-definidas para a execução das expressões contidas em <code>body</code>.
</p>

<p>
O macro <code>letfn</code> poderia ser escrito da seguinte forma:
</p>

<pre class="example" id="org7d58d2b">
(defmac letfn (defs . body)
  ((fn (sepfn)
     ((fn ((syms vals))
        `((fn ,syms ,@body)
          ,@vals))
      (sepfn defs nil nil sepfn)))
   (fn (pairs syms vals recur)
       (if (nilp pairs)
           (list syms vals)
           (recur (cdr pairs)
                  (cons (caar pairs) syms)
                  (cons (cons 'fn (cdar pairs)) vals)
                  recur)))))
</pre>

<p>
Uma expressão envolvendo o uso de <code>letfn</code> como a expressão a seguir:
</p>

<pre class="example" id="org494fa93">
(letfn ((foo (x) (+ 1 2 x)))
  (foo 5))
</pre>

<p>
Tal  expressão acaba  por  expandir-se para  a  aplicação imediata  de
função, que recebe outra(s) como parâmetro:
</p>

<pre class="example" id="orgeb44740">
((fn (foo) (foo 5))
 (fn (x) (+ 1 2 x)))
</pre>

<p>
É importante  notar que o macro  <code>letfn</code> <b>não possibilita a  definição de
funções  recursivas</b>. Uma  função  recursiva requer  que  a mesma  seja
executada em um  contexto onde a mesma esteja  bem-definida.
</p>

<p>
Teoricamente, uma função definida via <code>letfn</code> pode encontrar sua própria
definição durante  a execução  das expressões de  <code>body</code> através  de uma
consulta ao contexto em que  foi chamada, sendo portanto dependente do
uso de  <i>contexto dinâmico</i>.
</p>

<p>
Todavia, caso a função seja retornada ou atribuída em um contexto fora
do  criado  por  <code>letfn</code>,  esta consulta  falhará,  tendo  comportamento
inesperado do  ponto de  vista do programador.  Um exemplo  deste erro
pode ser observado a seguir.
</p>

<pre class="example" id="org794d15e">
&gt; (def my-function
       (letfn ((foo () (bar))
               (bar ()
                 (print "Hello from bar on letfn")))
         foo))
my-function

&gt; (my-function)
(lit error "{} is unbound" bar)
</pre>

<p>
Funções  locais  propriamente  recursivas,   que  capturam  o  próprio
contexto em que estão definidas,  devem ser definidas através da forma
especial <code>letrec</code>.
</p>
</div>
</div>

<div id="outline-container-org838ea11" class="outline-4">
<h4 id="org838ea11"><span class="section-number-4">11.10.7.</span> <code>(letfn* bindings . body)</code></h4>
<div class="outline-text-4" id="text-11-10-7">
<p>
Cria  contextos léxicos  em  sequência com  funções bem-definidas,  de
forma que uma definição de função  possa depender das definições que a
precedem, e  então interpreta  uma série  de expressões  em sequência,
delimitadas   por  <code>body</code>.   Retorna   o  valor   da  última   expressão
interpretada.
</p>

<p>
Caso haja  um erro em  alguma das  interpretações ou na  definição das
funções,  a  execução  é  interrompida imediatamente  e  o  erro  será
retornado.
</p>

<p>
<code>letfn*</code> pode ser definido da seguinte forma:
</p>

<pre class="example" id="org6635428">
(defmac letfn* (clauses . body)
  (if (nilp clauses)
      (cons 'do body)
      `(letfn (,(car clauses))
         ,(if (nilp (cdr clauses))
              (cons 'do body)
              `(letfn* ,(cdr clauses)
                 ,@body)))))
</pre>

<p>
Pode-se  observar que  <code>letfn*</code> define  uma forma  modificada de  <code>letfn</code>,
assim como <code>let*</code> define uma forma modificada de <code>let</code>. Assim, a definição
de cada função pode depender das funções anteriormente definidas.
</p>

<p>
Deve-se adicionar  que essa  dependência é dada  a partir  de <i>capturas
sucessivas de  contexto</i> durante  as definições das  funções. Portanto,
uma  função definida  mais posteriormente,  mesmo quando  retornada do
escopo de  <code>letfn*</code> ou atribuída  a uma  variável em um  escopo externo,
esta  ainda manterá  as referências  capturadas das  funções definidas
antes de si.
</p>

<p>
O exemplo a seguir demonstra esse comportamento.
</p>

<pre class="example" id="org3b91da9">
&gt; (def my-function
       (letfn* ((foo ()
                  (print "Executing foo"))
                (bar ()
                  (print "Executing bar")
                  (foo)))
         bar))
my-function

&gt; (letfn ((foo ()
            (print "This is another foo")))
    (my-function))
; Executing bar
; Executing foo
;
nil
</pre>
</div>
</div>

<div id="outline-container-orgda5580b" class="outline-4">
<h4 id="orgda5580b"><span class="section-number-4">11.10.8.</span> <code>(when pred . body)</code></h4>
<div class="outline-text-4" id="text-11-10-8">
<p>
Realiza  a  interpretação sequencial  das  expressões  de <code>body</code>,  se  e
somente   se  a   interpretação   de  <code>pred</code>   resultar   em  um   valor
verdadeiro. Nesse caso,  retorna o valor da última  expressão de <code>body</code>;
caso contrário, retorna <code>nil</code>.
</p>

<p>
O macro <code>when</code>  pode ser implementado a partir da  forma especial <code>if</code>, da
seguinte forma:
</p>

<pre class="example" id="orgde1151f">
(defmac when (pred . body)
  `(if ,pred (do ,@body) nil))
</pre>

<p>
Assim, uma expressão como esta:
</p>

<pre class="example" id="org4c31e3a">
(when t
  (print "Hello")
  (+ 2 3))
</pre>

<p>
Acaba por tornar-se esta expressão:
</p>

<pre class="example" id="org1898ed0">
(if t
    (do (print "Hello")
        (+ 2 3))
    nil)
</pre>

<p>
O macro <code>when</code> executa, portanto, controle  de fluxo, assim como a forma
especial <code>if</code> e o macro <code>cond</code>,  todavia lida apenas com a consequência de
um resultado  verdadeiro para o  predicado, e é  capaz de lidar  com a
execução de várias expressões sem depender da forma especial <code>do</code>.
</p>

<pre class="example" id="orgbdb3d78">
&gt; (when (nilp 'a)
    'is-nil)
nil

&gt; (when (nilp nil)
    'is-nil)
is-nil
</pre>
</div>
</div>

<div id="outline-container-org1a0e476" class="outline-4">
<h4 id="org1a0e476"><span class="section-number-4">11.10.9.</span> <code>(unless pred . body)</code></h4>
<div class="outline-text-4" id="text-11-10-9">
<p>
Realiza  a  interpretação sequencial  das  expressões  de <code>body</code>,  se  e
somente  se a  interpretação  de  <code>pred</code> resultar  em  <code>nil</code>. Nesse  caso,
retorna o  valor a última  expressão de <code>body</code>; caso  contrário, retorna
<code>nil</code>.
</p>

<p>
O macro  <code>unless</code> pode ser  implementado através da utilização  da forma
especial <code>if</code>:
</p>

<pre class="example" id="orge57aacd">
(defmac unless (pred . body)
  `(if (not ,pred) (do ,body) nil))
</pre>

<p>
Assim, uma expressão como esta:
</p>

<pre class="example" id="orge760a56">
(unless nil
  (print "Hello")
  (+ 2 3))
</pre>

<p>
Acaba por tornar-se esta expressão:
</p>

<pre class="example" id="org2ed9aff">
(if (not nil)
    (do (print "Hello")
        (+ 2 3))
    nil)
</pre>

<p>
O macro <code>unless</code> age, portanto, como  uma versão <i>negativa</i> de <code>when</code>, sendo
também responsável por controle de fluxo.
</p>

<pre class="example" id="org7813728">
&gt; (unless (nilp 'a)
    'ok)
ok

&gt; (unless (nilp nil)
    'ok)
nil
</pre>
</div>
</div>

<div id="outline-container-org670696f" class="outline-4">
<h4 id="org670696f"><span class="section-number-4">11.10.10.</span> <code>(until pred . body)</code></h4>
<div class="outline-text-4" id="text-11-10-10">
<p>
Executa  sequencialmente o  conjunto  de expressões  contidas em  <code>body</code>
enquanto o  predicado <code>pred</code>  retornar <code>nil</code>. A  execução da  sequência de
expressões será realizada até que  a condição seja satisfeita.
</p>

<p>
O  valor retornado  será o  valor  da última  expressão executada,  na
última iteração. Caso nenhuma  iteração tenha ocorrido, será retornado
<code>nil</code>.
</p>

<p>
O macro <code>until</code> pode ser implementado da seguinte forma:
</p>

<pre class="example" id="org3830c74">
(defmac until (pred . body)
  `(while (not ,pred) ,@body))
</pre>

<p>
Assim, uma forma como esta:
</p>

<pre class="example" id="org8040e35">
(until (&gt;= x 5)
  (set x (1+ x)))
</pre>

<p>
Será expandida para:
</p>

<pre class="example" id="org87d123a">
(while (not (&gt;= x 5)
  (set x (1+ x)))
</pre>

<p>
Como pode-se  observar, o  macro <code>until</code>  é a  forma <i>negativa</i>  de <code>while</code>,
assim como ocorre com <code>unless</code> e <code>when</code>.
</p>

<pre class="example" id="org0064259">
&gt; (let ((x 0))
    (until (&gt;= x 5)
      (print "x = {}" x)
      (set x (1+ x))))
; x = 0
; x = 1
; x = 2
; x = 3
; x = 4
;
x

&gt; (let ((lst '(1 2 3 a 5)))
    (until (nilp lst)
      (let (((num . rest) lst))
        (print "2 = {}? {}"
               num
               (= 2 num))
        (set lst rest))))
; 2 = 1? nil
; 2 = 2? t
; 2 = 3? nil
;
(lit error "{} is not a number" a)

&gt; (let ((lst '(1 2 3 NaN 5)))
    (until (&gt;= (car lst) 5)
      (let (((num . rest) lst))
        (print "{}" num)
        (set lst rest))))
; 1
; 2
; 3
;
(lit error "{} is not a number" NaN)
</pre>
</div>
</div>

<div id="outline-container-orgdeb3349" class="outline-4">
<h4 id="orgdeb3349"><span class="section-number-4">11.10.11.</span> <code>(repeat n . body)</code></h4>
<div class="outline-text-4" id="text-11-10-11">
<p>
Executa  sequencialmente as  expressões de  <code>body</code>, por  um número  <code>n</code> de
vezes. O valor  retornado será o valor da  última expressão executada,
na última iteração. Caso nenhuma iteração ocorra, será retornado <code>nil</code>.
</p>

<p>
O macro <code>repeat</code> pode ser escrito da seguinte forma:
</p>

<pre class="example" id="org8c71446">
(defmac repeat (n . body)
  (let ((it (gensym))
        (res (gensym)))
    `(let ((,it   ,n)
           (,res nil))
       (while (&gt; ,it 0)
         (set ,res (do ,@body))
         (set ,it (1- ,it)))
       ,res)))
</pre>

<p>
Uma expressão como a seguinte:
</p>

<pre class="example" id="org97e1dd8">
(repeat 5 (print "Test"))
</pre>

<p>
Expande-se para uma expressão similar a esta:
</p>

<pre class="example" id="orga06e534">
(let ((:G189   5)
      (:G188 nil))
  (while (&gt; :G189 0)
    (set :G188 (do (print "Test")))
    (set :G189 (1- :G189)))
  :G188)
</pre>

<p>
Sendo assim,  <code>repeat</code> pode ser visto  como um uso de  <code>while</code> que explora
uma variável que  sofre modificação, e outra que  armazena o resultado
parcial da  expressão a  cada iteração.
</p>

<p>
Os  símbolos  <code>:G189</code>   e  <code>:G188</code>  mostrados  no   exemplo  são  símbolos
arbitrários  automaticamente  gerados,  e  serão  diferentes  em  cada
uso de  <code>repeat</code>. Sua geração é  efeito colateral da medida  tomada para
que <code>repeat</code>  não se torne  um macro <i>anafórico</i>,  isto é, que  não nomeie
variáveis  que possam  ser  normalmente  utilizadas pelo  programador,
evitando o risco de erros semânticos.
</p>

<pre class="example" id="org05cc52c">
&gt; (repeat 4 (print "Hello"))
; Hello
; Hello
; Hello
; Hello
;
nil

&gt; (let ((x 5))
    (repeat 4
      (print "x = {}" x)
      (set x (1- x))))
; x = 5
; x = 4
; x = 3
; x = 2
;
x
</pre>
</div>
</div>

<div id="outline-container-orgd94da1b" class="outline-4">
<h4 id="orgd94da1b"><span class="section-number-4">11.10.12.</span> <code>(with-open-stream (sym dir file) . body)</code></h4>
<div class="outline-text-4" id="text-11-10-12">
<p>
Abre um  stream ligado ao símbolo  <code>sym</code>, de direção <code>dir</code>  para o caminho
<code>file</code>,  garantindo  que o  stream  seja  fechado  após a  execução  das
expressões em <code>body</code>.
</p>

<p>
Uma possível implementação para <code>with-open-stream</code> poderia ser:
</p>

<pre class="example" id="org2bcc4cd">
(defmac with-open-stream ((sym dir file) . body)
  `(let ((,sym (open-stream ,dir ,file)))
     (unwind-protect (do ,@body)
       (close-stream ,sym))))
</pre>

<p>
Sendo assim, uma expressão como esta:
</p>

<pre class="example" id="org4f6c4ca">
(with-open-stream (s 'in "teste.txt")
  (read-char s))
</pre>

<p>
Expande-se para a seguinte expressão:
</p>

<pre class="example" id="org11861fb">
(let ((s (open-stream 'in "teste.txt")))
  (unwind-protect
      (do (read-char s))
    (close-stream s)))
</pre>

<p>
Caso  o  stream  não  possa  ser  aberto,  o  erro  na  abertura  será
retornado.
</p>

<p>
Caso  ocorra   algum  erro  na   execução  das  expressões   em  <code>body</code>,
<code>with-open-stream</code>  ainda garante  que o  stream seja  fechado. O  valor
retornado será o valor de interpretação da última expressão em <code>body</code>.
</p>

<p>
O fechamento do stream está sujeito às regras de uso da forma especial
<code>unwind-protect</code>.
</p>

<p>
Supondo um  arquivo-texto <code>teste.txt</code>  contendo exatamente  os seguintes
caracteres, sem espaço em branco ao final&#x2026;
</p>

<pre class="example" id="org31a183d">
Teste
</pre>

<p>
&#x2026;os exemplos a seguir utilizam-se de tal arquivo.
</p>

<pre class="example" id="org6632602">
&gt; (with-open-stream (stream 'in "/home/alchemist/teste.txt")
    (read-char stream))
#\T

&gt; (with-open-stream (stream 'out "/home/alchemist/teste.txt")
    (read-char stream))
(lit error "{} is not an input stream" #&lt;stream (out) {...}&gt;)
</pre>
</div>
</div>

<div id="outline-container-org34d9724" class="outline-4">
<h4 id="org34d9724"><span class="section-number-4">11.10.13.</span> <span class="todo TODO">TODO</span> Variações de <code>car</code> e <code>cdr</code></h4>
<div class="outline-text-4" id="text-11-10-13">
<ul class="org-ul">
<li><code>first</code>: Igual a <code>(car x)</code>.</li>
<li><code>rest</code>: Igual a <code>(cdr x)</code>.</li>
<li><code>caar</code> (<code>first-of-first</code>): Igual a <code>(car (car x))</code>.</li>
<li><code>cadr</code> (<code>second</code>): Igual a <code>(car (cdr x))</code>.</li>
<li><code>cdar</code> (<code>rest-of-first</code>): Igual a <code>(cdr (car x))</code>.</li>
<li><code>cddr</code> (<code>rest-of-rest</code>): Igual a <code>(cdr (cdr x))</code>.</li>
<li><code>third</code>: Igual a <code>(car (cddr x))</code>.</li>
<li><code>fourth</code>: Igual a <code>(cadr (cddr x))</code>.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgf055758" class="outline-3">
<h3 id="orgf055758"><span class="section-number-3">11.11.</span> <span class="todo TODO">TODO</span> Miscelânea</h3>
<div class="outline-text-3" id="text-11-11">
</div>
<div id="outline-container-orga8c1eee" class="outline-4">
<h4 id="orga8c1eee"><span class="section-number-4">11.11.1.</span> <code>(map f (x . xs))</code></h4>
<div class="outline-text-4" id="text-11-11-1">
<p>
Mapeia uma  função <code>f</code> sobre uma  lista, retornando, ao final,  uma nova
lista,  composta do  resultado da  aplicação de  <code>f</code> sobre  cada um  dos
elementos da lista, em ordem.
</p>

<p>
Uma possível implementação para <code>map</code> seria:
</p>

<pre class="example" id="org175c49e">
(defn map (f (x . xs))
  (unless (nilp x)
    (cons (f x)
          (map f xs))))
</pre>

<p>
<code>map</code> desestrutura o segundo argumento &#x2013; uma lista &#x2013; em seus elementos
<i>car</i> e  <i>cdr</i> (<code>x</code>  e <code>xs</code>,  respectivamente). Assim, caso  <code>x</code> não  seja nulo,
aplica-se <code>f</code>  em <code>x</code> e coleta-se  o resultado, repetindo-se a  função <code>map</code>
recursivamente para <code>xs</code>, até que a lista se esgote.
</p>

<p>
Caso a lista passada como segundo argumento seja uma lista pontuada, o
último <i>cdr</i> será ignorado.
</p>

<pre class="example" id="orgc12fc6c">
&gt; (map (fn (x) (* x x))
       '(1 2 3 4 5))
(1 4 9 16 25)

&gt; (map (fn (x) (* x x))
       '(1 2 3 4 . 5))
(1 4 9 16)
</pre>
</div>
</div>

<div id="outline-container-org234110e" class="outline-4">
<h4 id="org234110e"><span class="section-number-4">11.11.2.</span> <code>(mapc f (x . xs))</code></h4>
<div class="outline-text-4" id="text-11-11-2">
<p>
Mapeia uma função <code>f</code> sobre uma lista, retornando <code>nil</code> ao final.
</p>

<p>
Uma possível implementação para <code>mapc</code> seria:
</p>

<pre class="example" id="org30047ef">
(defn mapc (f (x . xs))
  (unless (nilp x)
    (f x)
    (mapc f xs)))
</pre>

<p>
<code>mapc</code>  opera de  forma muito  similar a  <code>map</code>, todavia  sem a  coleta de
resultados da  aplicação de  <code>f</code> em  <code>x</code>. Em  outras palavras,  <code>mapc</code> opera
melhor principalmente  quando seu  uso envolve <i>efeitos  colaterais</i>, ou
seja, quando <code>f</code>  não está atrelado à ideia de  apenas retornar um valor
para cada parâmetro a ele passado.
</p>

<p>
Um exemplo  clássico do  uso de  <i>efeitos colaterais</i>  é a  <b>impressão em
tela</b>.  Pode-se usar  <code>mapc</code>  para,  por exemplo,  imprimir  cada um  dos
elementos de uma lista, em sequência.
</p>

<p>
Caso a lista passada como segundo argumento seja uma lista pontuada, o
último <i>cdr</i> será ignorado.
</p>

<pre class="example" id="org25453e1">
&gt; (mapc (fn (x) (* x x))
        '(1 2 3 4 5))
nil

&gt; (do (mapc (fn (x) (display x))
            '(1 2 3 4 5))
      (terpri))
; 12345
;
nil
</pre>
</div>
</div>

<div id="outline-container-orgfedb551" class="outline-4">
<h4 id="orgfedb551"><span class="section-number-4">11.11.3.</span> <code>(assp proc (x . xs))</code></h4>
<div class="outline-text-4" id="text-11-11-3">
<p>
Varre uma  <i>lista associativa</i>, aplicando <code>proc</code>  à chave de cada  uma das
associações,  sequencialmente.  Caso  uma  aplicação  tenha  um  valor
não-nulo, toda aquela associação será retornada como resposta.
</p>

<p>
Uma possível implementação para <code>assp</code> seria:
</p>

<pre class="example" id="org99fd7c4">
(defn assp (proc (x . xs))
  (unless (nilp x)
    (let (((key . rest) x))
      (or (and (proc key) x)
          (assp proc xs)))))
</pre>

<p>
Caso nenhuma associação retorne um  valor não-nulo durante a aplicação
de <code>proc</code> em sua chave, retorna <code>nil</code>.
</p>

<pre class="example" id="orgac26031">
&gt; (assp (fn (x) (eq 'b x))
        '((a . 1) (b . 2) (c . 3)))
(b . 2)

&gt; (assp (eq 'b) '((a . 1) (b . 2) (c . 3)))
(b . 2)

&gt; (assp (eq 'z) '((a . 1) (b . 2) (c . 3)))
nil
</pre>
</div>
</div>

<div id="outline-container-org1cfcc3d" class="outline-4">
<h4 id="org1cfcc3d"><span class="section-number-4">11.11.4.</span> <code>(assoc sym alist)</code></h4>
<div class="outline-text-4" id="text-11-11-4">
<p>
Varre uma lista associativa, procurando por <code>sym</code> nas chaves de cada uma
das associações,  sequencialmente. Quando  <code>sym</code> corresponde à  chave de
uma associação, toda aquela associação será retornada como resposta.
</p>

<p>
Para  comparar  <code>sym</code> com  cada  uma  das  chaves, <code>assoc</code>  utiliza-se  da
função <code>equal</code>, que pode ser  temporariamente alterada através do uso de
uma variável dinâmica.
</p>

<p>
A função <code>assoc</code>  poderia ser implementada com base na  função <code>assp</code>:
</p>

<pre class="example" id="org5d71dfc">
(defn assoc (sym alist)
  (assp (equal sym) alist))
</pre>

<p>
Caso nenhuma associação possua <code>sym</code> como sua chave, retorna-se <code>nil</code>.
</p>

<pre class="example" id="orge79533b">
&gt; (assoc 'b '((a . 1) (b . 2) (c . 3)))
(b . 2)

&gt; (assoc 'a '((a . 1) (b . 2) (a . 3)))
(a . 1)

&gt; (letfn ((equal (x y)
            (= x y)))
    (assoc 2 '((1 . a) (2 . b) (3 . c))))
(2 . b)

&gt; (assoc 'z '((a . 1) (b . 2) (a . 3)))
nil
</pre>
</div>
</div>

<div id="outline-container-orgeeb099a" class="outline-4">
<h4 id="orgeeb099a"><span class="section-number-4">11.11.5.</span> <code>(member elt lst)</code></h4>
<div class="outline-text-4" id="text-11-11-5">
<p>
Varre  uma  lista  de  elementos,   procurando  por  <code>elt</code>.  Quando  <code>elt</code>
corresponde  ao primeiro  elemento de  uma sublista,  aquela sublista,
incluindo <code>elt</code> como primeiro elemento, será retornada.
</p>

<p>
Para  comparar <code>elt</code>  com cada  um dos  elementos, <code>member</code> utiliza-se  da
função <code>equal</code>, que pode ser  temporariamente alterada através do uso de
uma variável dinâmica.
</p>

<p>
A função <code>member</code> poderia ser implementada da seguinte forma:
</p>

<pre class="example" id="orgd7eeed9">
(defn member (elt lst)
  (unless (nilp lst)
    (let (((x . rest) lst))
      (or (and (equal elt x)
               lst)
          (member elt rest)))))
</pre>

<p>
Caso  o elemento  <code>elt</code> não  se  encontre em  <code>lst</code>, será retornado <code>nil</code>.
</p>

<pre class="example" id="org2a8688b">
&gt; (member 'a '(x y z a b c))
(a b c)

&gt; (member 'x '(x y z a b c))
(x y z a b c)

&gt; (member 'c '(x y z a b c))
(c)

&gt; (letfn ((equal (x y)
            (= x y)))
    (member 1 '(5 6 7 1 2 3)))
(1 2 3)

&gt; (member 'n '(x y z a b c))
nil
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga8fef64" class="outline-2">
<h2 id="orga8fef64"><span class="section-number-2">12.</span> <span class="todo TODO">TODO</span> Aplicação</h2>
<div class="outline-text-2" id="text-12">
</div>
<div id="outline-container-org2c88f13" class="outline-3">
<h3 id="org2c88f13"><span class="section-number-3">12.1.</span> Aplicação de clausuras</h3>
<div class="outline-text-3" id="text-12-1">
</div>
</div>

<div id="outline-container-orgcfb87d1" class="outline-3">
<h3 id="orgcfb87d1"><span class="section-number-3">12.2.</span> Aplicação de primitivas</h3>
</div>
<div id="outline-container-orga8ca59a" class="outline-3">
<h3 id="orga8ca59a"><span class="section-number-3">12.3.</span> Aplicação de macros</h3>
</div>
</div>

<div id="outline-container-org12ee3f1" class="outline-2">
<h2 id="org12ee3f1"><span class="section-number-2">13.</span> <span class="todo TODO">TODO</span> Interpretação</h2>
<div class="outline-text-2" id="text-13">
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Tradução livre do Inglês, <i>literate program</i>. 
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Caso  seja importante comparar  pela igualdade de  dois números
<code>float</code>, Majestic Lisp provê a função  <code>float=</code>, que se baseia em <i>unidades
de menor precisão</i>.
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://en.wikipedia.org/wiki/CAR_and_CDR">https://en.wikipedia.org/wiki/CAR_and_CDR</a> 
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4" role="doc-backlink">4</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Para  maiores informações  a respeito  deste algoritmo,  veja o
tópico,  como   foi  brilhantemente   explicado,  por   Bruce  Dawson:
<a href="https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/">https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/</a>.
</p></div></div>

<div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5" role="doc-backlink">5</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Para mais informações sobre campos ordenados, veja a Wikipedia:
<a href="https://en.wikipedia.org/wiki/Ordered_field">https://en.wikipedia.org/wiki/Ordered_field</a>.
</p></div></div>

<div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6" role="doc-backlink">6</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
A título de comparação, <code>unwind-protect</code>  é similar a blocos <i>try-finally</i>
na linguagem Object Pascal, e ao bloco <i>finally</i> em Java.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Lucas S. Vieira Lucas S. Vieira</p>
<p class="date">Created: 2022-10-24 seg 00:27</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
