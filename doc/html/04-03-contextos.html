<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt-br" xml:lang="pt-br">
<head>
<!-- 2022-10-23 dom 22:46 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Contextos</title>
<meta name="author" content="Lucas S. Vieira" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="./main.css" />
<link rel="stylesheet" type="text/css" href="./syntax.css" />
<link id="theme-css" rel="stylesheet" type="text/css" href="./dark-theme.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:image" content="../img/cat-i-mage.jpg">
<meta name="theme-color" content="#14171e">
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="04-nucleo.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">Contextos</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgdf1da2a">1. Importações</a></li>
<li><a href="#org990e61a">2. Extensão de contexto</a></li>
<li><a href="#orgd4e4ebf">3. <span class="todo TODO">TODO</span> Procura por símbolo em um contexto</a></li>
<li><a href="#orgcef4ee4">4. <span class="todo TODO">TODO</span> União de contextos</a></li>
</ul>
</div>
</div>
<p>
Trataremos  agora  do  submódulo  que diz  respeito  a  <i>contextos</i>.  Em
Majestic Lisp, um <i>contexto</i> é impresso em formato de <i>lista associativa</i>,
onde cada um  dos elementos da lista  será um <i>cons</i>; em  cada um desses
<i>cons</i>, o <code>car</code> corresponde a um símbolo, e o <code>cdr</code> corresponde a um valor.
</p>

<p>
Por exemplo, a lista associativa
</p>

<pre class="example" id="org140caec">
((square . (lit closure nil (x) (* x x)))
 (y      . 90)
 (x      . 5J2/3))
</pre>

<p>
é um contexto qualquer válido, que realiza as seguintes associações:
</p>

<pre class="example" id="org23dd451">
square = (lit closure nil (x) (* x x))
y      = 90
x      = 5J2/3
</pre>

<p>
como podemos ver, o símbolo <code>square</code>  está associado a uma certa função,
o  símbolo  <code>y</code> está  associado  ao  numero \(90\),  e  o  símbolo <code>x</code>  está
associado ao número complexo \(5 + \frac{2}{3}i\).
</p>

<p>
A maior  parte do  código listado  a seguir  poderá ser  encontrado em
<code>src/core/environment.rs</code>, exceto onde for apontado.
</p>

<div id="outline-container-orgdf1da2a" class="outline-2">
<h2 id="orgdf1da2a"><span class="section-number-2">1.</span> Importações</h2>
<div class="outline-text-2" id="text-1">
<p>
Começaremos importando  alguns objetos  importantes, como  a estrutura
<code>Maj</code>,  que descreve  os  tipos primitivos  de  nossa linguagem.  Também
teremos  à   mão  a   estrutura  genérica  para   identificar  objetos
gerenciados pelo coletor de lixo.
</p>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">use</span> <span style="color: #569cd6;">super</span>::<span style="color: #4ec9b0;">Maj</span>;
<span style="color: #569cd6;">use</span> <span style="color: #569cd6;">gc</span>::<span style="color: #4ec9b0;">Gc</span>;
</pre>
</div>

<p>
Algumas das operações que se  seguem envolvem comparações de tipos nos
objetos, ou compara dois objetos.  Para tanto, podemos importar alguns
predicados da nossa  lista de axiomas, que servirão para  esse tipo de
comparação. Os  predicados possuem  uma interface  voltada diretamente
para  uso   no  próprio   interpretador,  mas   poderemos  utilizá-los
normalmente em Rust se utilizarmos o método <code>to_bool</code> do tipo <code>Maj</code>.
</p>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">axioms</span>::<span style="color: #569cd6;">predicates</span>::{
    maj_nilp,
    maj_eq,
    maj_proper_list_p,
    maj_symbolp
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org990e61a" class="outline-2">
<h2 id="org990e61a"><span class="section-number-2">2.</span> Extensão de contexto</h2>
<div class="outline-text-2" id="text-2">
<p>
O processo de  extensão do contexto é um  processo não-destrutivo, que
toma um certo  <i>contexto</i>, um certo <i>símbolo</i> e um  <i>valor</i> qualquer, e cria
um <b>novo</b>  contexto tal  que, em  seu topo,  haverá uma  nova associação
entre o  símbolo e o valor  supracitados, feita através da  criação de
uma célula <i>cons</i>.
</p>

<p>
Portanto, dado um contexto
</p>

<pre class="example" id="org4022706">
((x . 2))
</pre>

<p>
se quisermos adicionar uma nova associação  tal que <code>y = 3</code>, teremos, ao
final da operação, este exato novo contexto:
</p>

<pre class="example" id="org1270d79">
((y . 3) (x . 2))
</pre>

<p>
A  função  pública  <code>maj_env_push</code>   realiza  esse  trabalho.  Também  é
importante ressaltar  que o processo  de identificação de  um <i>contexto</i>
envolve verificar se o mesmo é  uma lista adequada, e o símbolo também
será  verificado quanto  a tal.  O  valor poderá  ser qualquer  coisa,
portanto não será verificado.
</p>

<p>
A criação de um novo contexto  não pressupõe cópia do anterior: apenas
aproveitamos o mesmo contexto antigo e adicionamos uma nova associação
em seu topo, sem realizar nenhum processo destrutivo.
</p>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">pub</span> <span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_env_push</span>(<span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">sym</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">val</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">is_env</span> = maj_proper_list_p(env.clone()).to_bool();
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">is_sym</span> = maj_symbolp(sym.clone()).to_bool();
    
    <span style="color: #569cd6;">if</span> !is_env || !is_sym {
        <span style="color: #4ec9b0;">Maj</span>::nil()
    } <span style="color: #569cd6;">else</span> {
        <span style="color: #4ec9b0;">Maj</span>::cons(
            <span style="color: #4ec9b0;">Maj</span>::cons(sym, val),
            env)
    }
}
</pre>
</div>

<p>
É interessante ressaltar que um <i>contexto</i>, por ser validado apenas pela
ideia de  <i>lista adequada</i>,  também envolve  o uso  correto da  parte do
programador.
</p>
</div>
</div>

<div id="outline-container-orgd4e4ebf" class="outline-2">
<h2 id="orgd4e4ebf"><span class="section-number-2">3.</span> <span class="todo TODO">TODO</span> Procura por símbolo em um contexto</h2>
<div class="outline-text-2" id="text-3">
<p>
Outro  processo importante  de  ser  mencionado para  o  contexto é  a
<i>procura</i>, que  envolve procurar  pelo valor associado  a um  <i>símbolo</i> no
contexto. Para  tanto, atravessa-se o contexto  recursivamente, <i>cons</i> a
<i>cons</i>, e verifica-se pela igualdade (<code>eq</code>)  entre o símbolo procurado e o
<code>car</code> da associação.
</p>

<p>
Caso o  contexto seja  completamente atravessado e  nenhuma associação
seja encontrada,  trata-se de um  erro. Retornamos aqui o  símbolo <code>nil</code>
para referência, mas isso poderá ser mudado em breve.
</p>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">pub</span> <span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_env_assoc</span>(<span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">sym</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">axioms</span>::<span style="color: #569cd6;">primitives</span>::maj_err;
    <span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::maj_list;
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">itr</span> = env.clone();
    <span style="color: #569cd6;">while</span> !maj_nilp(itr.clone()).to_bool() {
        <span style="color: #569cd6;">if</span> <span style="color: #569cd6;">let</span> <span style="color: #4ec9b0;">Maj</span>::<span style="color: #4ec9b0;">Cons</span> { <span style="color: #9cdcfe;">car</span>: entry, cdr } = <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span>*itr.clone() {
            <span style="color: #569cd6;">if</span> <span style="color: #569cd6;">let</span> <span style="color: #4ec9b0;">Maj</span>::<span style="color: #4ec9b0;">Cons</span> {
                <span style="color: #9cdcfe;">car</span>: symbol,
                <span style="color: #9cdcfe;">cdr</span>: _
            } = <span style="color: #d4d4d4; background-color: #1e1e1e;">&amp;</span>*entry.clone() {
                <span style="color: #569cd6;">if</span> maj_eq(symbol.clone(), sym.clone()).to_bool() {
                    <span style="color: #569cd6;">return</span> entry.clone();
                }
            } <span style="color: #569cd6;">else</span> {
                <span style="color: #c586c0;">panic!</span>(<span style="color: #ce9178;">"All entries on an environment must be pairs"</span>);
            }
            itr = cdr.clone();
        } <span style="color: #569cd6;">else</span> {
            <span style="color: #c586c0;">panic!</span>(<span style="color: #ce9178;">"Environment is not an alist"</span>);
        }
    }
    maj_err(
        <span style="color: #4ec9b0;">Maj</span>::string(<span style="color: #ce9178;">"{} is unbound"</span>),
        <span style="color: #c586c0;">maj_list!</span>(sym))
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">pub</span> <span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_env_lookup</span>(<span style="color: #9cdcfe;">env</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">sym</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">axioms</span>::<span style="color: #569cd6;">predicates</span>::maj_errorp;
    <span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">axioms</span>::<span style="color: #569cd6;">primitives</span>::maj_cdr;
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">result</span> = maj_env_assoc(env, sym);
    <span style="color: #569cd6;">if</span> !maj_errorp(result.clone()).to_bool() {
        maj_cdr(result)
    } <span style="color: #569cd6;">else</span> {
        result
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcef4ee4" class="outline-2">
<h2 id="orgcef4ee4"><span class="section-number-2">4.</span> <span class="todo TODO">TODO</span> União de contextos</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #569cd6;">pub</span> <span style="color: #569cd6;">fn</span> <span style="color: #dcdcaa;">maj_env_union</span>(<span style="color: #9cdcfe;">env1</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;, <span style="color: #9cdcfe;">env2</span>: <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt;) -&gt; <span style="color: #4ec9b0;">Gc</span>&lt;<span style="color: #4ec9b0;">Maj</span>&gt; {
    <span style="color: #569cd6;">use</span> <span style="color: #569cd6;">crate</span>::<span style="color: #569cd6;">axioms</span>::{
        <span style="color: #569cd6;">primitives</span>::{ maj_car, maj_cdr },
        <span style="color: #569cd6;">predicates</span>::maj_errorp
    };
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">is_env_env1</span> = maj_proper_list_p(env1.clone()).to_bool();
    <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">is_env_env2</span> = maj_proper_list_p(env2.clone()).to_bool();
    <span style="color: #569cd6;">if</span> !is_env_env1 || !is_env_env2 {
        <span style="color: #c586c0;">panic!</span>(<span style="color: #ce9178;">"Attempted union of improper lists"</span>);
    }
    
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">Uniting two envs involves creating a new env with mixed bindings.</span>
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">It must basically be env2 with env1 bindings substituting wherever</span>
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">a substitution is needed.</span>
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">iter</span> = env2.clone();
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">0. Reverse env2 (because of the way it works)</span>
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">env2_bindings</span> = <span style="color: #c586c0;">vec!</span>[];
    <span style="color: #569cd6;">while</span> !maj_nilp(iter.clone()).to_bool() {
        env2_bindings.push(maj_car(iter.clone()));
        iter = maj_cdr(iter);
    }
    
    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">1. traverse for each bind2 on env2.</span>
    <span style="color: #569cd6;">let</span> <span style="color: #569cd6;">mut</span> <span style="color: #9cdcfe;">newenv</span> = <span style="color: #4ec9b0;">Maj</span>::nil();
    <span style="color: #569cd6;">for</span> <span style="color: #9cdcfe;">bind2</span> <span style="color: #569cd6;">in</span> env2_bindings.iter().rev() {
        <span style="color: #6a9955;">// </span><span style="color: #6a9955;">2. if (sym in bind2) is defined in (bind1 in env1), collect bind1.</span>
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">sym</span> = maj_car(bind2.clone());
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">bind1</span> = maj_env_assoc(env1.clone(), sym);
        newenv = <span style="color: #569cd6;">if</span> !maj_errorp(bind1.clone()).to_bool() {
            <span style="color: #4ec9b0;">Maj</span>::cons(bind1, newenv)
        } <span style="color: #569cd6;">else</span> {
            <span style="color: #6a9955;">//    </span><span style="color: #6a9955;">2.5. otherwise collect bind2.</span>
            <span style="color: #4ec9b0;">Maj</span>::cons(bind2.clone(), newenv)
        };
    }

    <span style="color: #6a9955;">// </span><span style="color: #6a9955;">3. Add bindings on env1 that were not added</span>
    iter = env1.clone();
    <span style="color: #569cd6;">while</span> !maj_nilp(iter.clone()).to_bool() {
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">binding</span> = maj_car(iter.clone());
        <span style="color: #569cd6;">let</span> <span style="color: #9cdcfe;">sym</span> = maj_car(binding.clone());
        <span style="color: #569cd6;">if</span> maj_errorp(maj_env_assoc(newenv.clone(), sym.clone())).to_bool() {
            newenv = <span style="color: #4ec9b0;">Maj</span>::cons(binding, newenv);
        }
        iter = maj_cdr(iter);
    }

    newenv
}
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Lucas S. Vieira</p>
<p class="date">Created: 2022-10-23 dom 22:46</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
