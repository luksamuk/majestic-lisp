<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt-br" xml:lang="pt-br">
<head>
<!-- 2022-10-23 dom 23:28 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Escrevendo programas</title>
<meta name="author" content="Lucas S. Vieira" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="./main.css" />
<link rel="stylesheet" type="text/css" href="./syntax.css" />
<link id="theme-css" rel="stylesheet" type="text/css" href="./dark-theme.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:image" content="../img/cat-i-mage.jpg">
<meta name="theme-color" content="#14171e">
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="02-sintaxe.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">Escrevendo programas</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org3369cb3">1. Declaração de variáveis</a>
<ul>
<li><a href="#orgb6f120a">1.1. Variáveis globais</a></li>
<li><a href="#org80d0deb">1.2. Variáveis locais</a>
<ul>
<li><a href="#org4500503"><b>Sombreando variáveis.</b></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgfdeb4fc">2. Funções</a>
<ul>
<li><a href="#orge64b3db">2.1. Funções primitivas</a></li>
<li><a href="#orgbe812e7">2.2. Aplicação de funções</a></li>
<li><a href="#org4990cdd">2.3. Funções do usuário</a>
<ul>
<li><a href="#org085a7ab"><b>Funções locais.</b></a></li>
<li><a href="#org7615a7c">Funções globais recursivas.</a></li>
<li><a href="#org76c07ac">Funções locais recursivas.</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgef46abb">3. Controle de fluxo</a></li>
<li><a href="#orgd7e911c">4. <i>Quasiquoting</i></a></li>
</ul>
</div>
</div>
<p>
Agora que falamos de listas, podemos finalmente falar dos programas de
Majestic Lisp.
</p>

<p>
Programas  de  Majestic   Lisp  são  tratados  como   um  <i>conjunto  de
expressões</i>. Essas expressões podem ser símbolos individuais, ou <i>listas</i>
com arranjo específico.
</p>

<p>
Como anteriormente citado, um símbolo individual normalmente é tratado
como um  rótulo para um valor.  Já uma lista pode  estar relacionada à
<i>aplicação de uma  função</i>, execução de uma <i>forma  especial</i> ou <i>aplicação
de um macro</i>.
</p>

<p>
Por exemplo, a expressão a seguir define uma função capaz de dobrar um
número qualquer, aqui chamada <code>double</code>:
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">defn</span> double <span style="color: #da70d6;">(</span>x<span style="color: #da70d6;">)</span>
  <span style="color: #da70d6;">(</span><span style="color: #dcdcaa;">*</span> x 2<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
double
</pre>


<p>
Apesar de ser um uso específico do macro<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup> <code>defn</code>, a expressão acima
continua sendo  uma lista,  segundo o  que já foi  dito a  respeito da
sintaxe  das  mesmas. A  diferença  crucial  está em  não  realizarmos
<i>quoting</i> na expressão, o que indica que ela deverá ser interpretada.
</p>

<p>
Durante a  interpretação, o interpretador verifica  o primeiro símbolo
da   lista  e   percebe   que   <code>defn</code>  está   atrelado   a  um   macro;
subsequentemente, realiza  os passos de interpretação  necessários que
levam, ao final, à atribuição de uma função ao símbolo <code>double</code>.
</p>

<p>
Veremos a seguir algumas funções e  formas especiais que são padrão em
Majestic, bem como o uso das mesmas.
</p>

<div id="outline-container-org3369cb3" class="outline-2">
<h2 id="org3369cb3"><span class="section-number-2">1.</span> Declaração de variáveis</h2>
<div class="outline-text-2" id="text-1">
<p>
A maioria das linguagens possui uma forma de atribuir <i>rótulos</i> a certos
valores, e  Majestic Lisp não  é diferente nesse aspecto.  Nela, temos
uma  forma de  definir  valores  que estarão  acessíveis  para todo  o
programa, e  também valores que  estarão acessíveis apenas  em regiões
específicas,  que  geralmente  chamamos  de  <i>escopo</i>.
</p>

<p>
Outra  forma  de  utilização  de  uma  variável  está  em  redefini-la
dinamicamente de  acordo com um  contexto, porém não  abordaremos este
método nas seções subsequentes.
</p>
</div>

<div id="outline-container-orgb6f120a" class="outline-3">
<h3 id="orgb6f120a"><span class="section-number-3">1.1.</span> Variáveis globais</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Variáveis globais  são variáveis  que, normalmente, são  acessíveis em
qualquer região de um programa.
</p>

<p>
Majestic  Lisp armazena,  em um  estado  global, uma  tabela que  liga
certos rótulos (símbolos) a certos valores.
</p>

<p>
Podemos  usar a  <i>forma especial</i>  <code>def</code> para  definir uma  variável.
</p>

<p>
A seguir,  usamos <code>def</code>  para <i>definir</i>  uma variável  global <code>x</code>,  de valor
numérico <code>5</code>. Como resposta, o  interpretador retorna o mesmo símbolo <code>x</code>,
indicando que este foi definido com sucesso.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">def</span> x 5<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
x
</pre>


<p>
Se, logo em seguida, formos ao REPL  e digitarmos o símbolo <code>x</code> para que
seja interpretado, o interpretador retornará  o valor associado a esse
símbolo:
</p>

<div class="org-src-container">
<pre class="src src-majestic">x
</pre>
</div>

<pre class="example">
5
</pre>


<p>
Caso digitássemos um símbolo não-<i>quotado</i>  que não correspondesse a uma
variável anteriormente definida, o  interpretador informaria que há um
erro.
</p>

<p>
Podemos redefinir  o valor  de uma variável  com facilidade,  usando a
forma  especial <code>set</code>.  Ela nos  permite realizar  atribuições de  novos
valores a variáveis já existentes.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">set</span> x 9<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
x
</pre>


<div class="org-src-container">
<pre class="src src-majestic">x
</pre>
</div>

<pre class="example">
9
</pre>


<p>
<code>set</code> só pode ser utilizado em uma variável global após a mesma ter sido
atribuída, através de <code>def</code>.
</p>
</div>
</div>

<div id="outline-container-org80d0deb" class="outline-3">
<h3 id="org80d0deb"><span class="section-number-3">1.2.</span> Variáveis locais</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Há uma  forma de definir  variáveis apenas temporariamente  através da
criação de  um <i>escopo</i>. O  interpretador de Majestic Lisp  tratará essa
variável como definida apenas dentro do mesmo; fora, a variável já não
estará definida.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">let</span> <span style="color: #da70d6;">(</span><span style="color: #87cefa;">(</span>y 9<span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span>
  y<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
9
</pre>


<p>
Na  situação acima,  usamos o  <i>macro</i> <code>let</code>  para definir  localmente uma
única  variável <code>y</code>,  que  estará  definida apenas  para  o corpo  desse
macro.
</p>

<p>
O macro <code>let</code> tem a forma a seguir:
</p>

<pre class="example" id="org3552bb0">
(let (&lt;definições&gt;)
  &lt;corpo&gt;)
</pre>

<p>
&#x2026;onde <code>&lt;definições&gt;</code> é um número arbitrário de duplas na forma <code>(rótulo
valor)</code>, e <code>&lt;corpo&gt;</code> é <b>uma única expressão</b>, que será interpretada levando
em consideração as variáveis localmente definidas.
</p>

<p>
O exemplo anterior  funciona como se tivéssemos definido  a variável <code>y</code>
globalmente usando o valor <code>9</code> e  pedíssemos o valor associado a <code>y</code>. Logo
em seguida, o interpretador "esquece"  que essa variável foi algum dia
definida.
</p>

<p>
Também podemos redefinir o valor de uma variável local, usando a forma
especial <code>set</code>:
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">let</span> <span style="color: #da70d6;">(</span><span style="color: #87cefa;">(</span>y 9<span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span>
  <span style="color: #da70d6;">(</span><span style="color: #569cd6;">set</span> y 10<span style="color: #da70d6;">)</span>
  y<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
10
</pre>
</div>

<div id="outline-container-org4500503" class="outline-4">
<h4 id="org4500503"><b>Sombreando variáveis.</b></h4>
<div class="outline-text-4" id="text-org4500503">
<p>
Podemos   usar  definições   locais  para   utilizarmos  a   ideia  de
<i>sombreamento</i>,  para  efetuar  redefinições  temporárias  de  variáveis
globais, ou até mesmo de variáveis locais, em caso de <code>let</code>'s aninhados.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">def</span> x 5<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
x
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">let</span> <span style="color: #da70d6;">(</span><span style="color: #87cefa;">(</span>x 6<span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span>
  x<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
6
</pre>


<div class="org-src-container">
<pre class="src src-majestic">x
</pre>
</div>

<pre class="example">
5
</pre>


<p>
O exemplo acima mostra uma variável global <code>x</code> cujo valor atribuído é <code>5</code>;
em seguida, criamos um escopo onde  <code>x</code> possui o valor <code>6</code>, e requisitamos
nele o valor  de <code>x</code>.  Após a  execução desse escopo, <code>x</code> "volta"  a ter o
valor associado <code>5</code>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfdeb4fc" class="outline-2">
<h2 id="orgfdeb4fc"><span class="section-number-2">2.</span> Funções</h2>
<div class="outline-text-2" id="text-2">
<p>
Até agora, vimos estruturas especiais de listas a serem interpretadas,
mais  especificamente <i>formas  especiais</i>  e <i>macros</i>.  Mas  e quanto  aos
outros tipos de lista?
</p>

<p>
Quando  temos uma  lista  "comum", o  interpretador  de Majestic  Lisp
espera que o  primeiro elemento da lista seja uma  <i>função</i>. Funções são
fragmentos de código  que realizam operações específicas,  e que podem
ser reutilizados posteriormente.
</p>

<p>
Em  Majestic  Lisp, temos  dois  tipos  de  funções: <i>primitivas</i>  e  <i>de
usuário</i>.
</p>
</div>

<div id="outline-container-orge64b3db" class="outline-3">
<h3 id="orge64b3db"><span class="section-number-3">2.1.</span> Funções primitivas</h3>
<div class="outline-text-3" id="text-2-1">
<p>
As funções primitivas de Majestic  Lisp são funções já definidas antes
da   execução   do   interpretador.  Isso   significa   que   qualquer
implementação da  linguagem precisa garantir que  essas funções possam
ser utilizadas.
</p>

<p>
Uma dessas funções é a  função <code>+</code>, responsável principalmente por somar
números.  Essa  função  aceita  qualquer quantidade  de  números  como
<i>argumentos</i> e, quando fornecidos dois ou mais argumentos, ela retorna a
soma de todos esses números<sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup>.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">+</span> 2 3<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
5
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">+</span> 5 7 1<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
13
</pre>


<p>
Há também outras funções primitivas de aritmética, capazes de executar
multiplicação (<code>*</code>), divisão (<code>/</code>) e subtração (<code>-</code>). Podemos inclusive usar
sublistas  para realizar  mais  operações com  o  resultado de  outras
operações; nesse caso, também é  pertinente indentar nosso código para
melhor legibilidade.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">+</span> <span style="color: #da70d6;">(</span><span style="color: #dcdcaa;">/</span> 8 2<span style="color: #da70d6;">)</span>
   <span style="color: #da70d6;">(</span><span style="color: #dcdcaa;">+</span> 1 3<span style="color: #da70d6;">)</span>
   <span style="color: #da70d6;">(</span><span style="color: #dcdcaa;">*</span> 7 7<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
57
</pre>
</div>
</div>

<div id="outline-container-orgbe812e7" class="outline-3">
<h3 id="orgbe812e7"><span class="section-number-3">2.2.</span> Aplicação de funções</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Outro  exemplo de  função  primitiva, muito  utilizada,  é <code>cons</code>.  Essa
função requer  exatamente <i>dois</i> argumentos,  e pode ser  utilizada para
criar uma célula <i>cons</i>. Veja o exemplo um pouco mais complexo a seguir.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">let</span> <span style="color: #da70d6;">(</span><span style="color: #87cefa;">(</span>x 2<span style="color: #87cefa;">)</span>
      <span style="color: #87cefa;">(</span>y 3<span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span>
  <span style="color: #da70d6;">(</span><span style="color: #dcdcaa;">cons</span> x y<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
(2 . 3)
</pre>


<p>
Aqui, temos as  variáveis locais <code>x</code> e  <code>y</code>, de valores atribuídos  <code>2</code> e <code>3</code>,
respectivamente.
</p>

<p>
Ao passarmos as variáveis locais <code>x</code> e <code>y</code> para <code>cons</code>, veja que não estamos
<i>quotando</i> esses rótulos. Isso significa que  o que está sendo passado a
<i>cons</i>  não são  os  nomes das  variáveis,  mas sim  os  valores a  eles
atribuídos.
</p>

<p>
Da mesma forma, <code>cons</code> é apenas o <i>rótulo</i> de uma certa operação, que cria
uma célula <i>cons</i> a partir de dois valores.
</p>

<p>
O resultado da operação  é uma célula cujo <i>car</i> é <code>2</code> e  cujo <i>cdr</i> é <code>3</code>. Ao
final do  escopo do  <code>let</code>, as  variáveis <code>x</code> e  <code>y</code> deixarão  de "existir",
permanecendo apenas a célula <i>cons</i> retornada, contendo esses valores.
</p>

<p>
Podemos constatar  os valores de <i>car</i>  e <i>cdr</i> de uma  função através das
funções primitivas homônimas, <code>car</code> e <code>cdr</code>. A seguir, temos um exemplo um
pouco  mais  complexo, que  toma  o  retorno do  escopo  anteriormente
demonstrado, colocando-o em uma variável para ser consultada depois.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">def</span> my-cell
  <span style="color: #da70d6;">(</span><span style="color: #569cd6;">let</span> <span style="color: #87cefa;">(</span><span style="color: #ffd700;">(</span>x 2<span style="color: #ffd700;">)</span>
        <span style="color: #ffd700;">(</span>y 3<span style="color: #ffd700;">)</span><span style="color: #87cefa;">)</span>
    <span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">cons</span> x y<span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
my-cell
</pre>


<div class="org-src-container">
<pre class="src src-majestic">my-cell
</pre>
</div>

<pre class="example">
(2 . 3)
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">car</span> my-cell<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
2
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">cdr</span> my-cell<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
3
</pre>
</div>
</div>

<div id="outline-container-org4990cdd" class="outline-3">
<h3 id="org4990cdd"><span class="section-number-3">2.3.</span> Funções do usuário</h3>
<div class="outline-text-3" id="text-2-3">
<p>
As funções  de usuário  de Majestic Lisp  são funções  declaradas pelo
usuário  do   sistema,  diferentemente  das  funções   primitivas  que
já existem quando o sistema é iniciado.
</p>

<p>
A sintaxe para a declaração de uma função envolve a forma especial <code>fn</code>,
que pode ser compreendida como:
</p>

<pre class="example" id="orgba64ba4">
(fn &lt;argumentos&gt; &lt;corpo&gt;)
</pre>

<p>
&#x2026;onde <code>&lt;argumentos&gt;</code>  é, normalmente, uma  lista de argumentos  para a
função, e  <code>&lt;corpo&gt;</code> é  uma única  expressão a  ser executada  durante a
invocação da função.
</p>

<p>
O  exemplo  a  seguir  envolve  a   função  que  eleva  um  número  ao
quadrado. Como  podemos observar, a  função recebe um  único argumento
(aqui chamado <code>x</code>), e então multiplica-o por si mesmo.
</p>

<p>
O resultado  retornado é um  formato de  impressão de uma  função, que
normalmente não pode ser reinserido no REPL.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">fn</span> <span style="color: #da70d6;">(</span>x<span style="color: #da70d6;">)</span> <span style="color: #da70d6;">(</span><span style="color: #dcdcaa;">*</span> x x<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
#&lt;function (fn (x)) {0x565242ffe170}&gt;
</pre>


<p>
Funções  são  <i>cidadãos  de  primeira-classe</i>  em  Majestic  Lisp.  Isso
significa que  elas podem ser  rotuladas, repassadas em  aplicações de
outras funções e  atribuídas a novos rótulos, assim  como faríamos com
qualquer outro valor.
</p>

<p>
Podemos, por exemplo, atribuir a nossa função ao símbolo <code>square</code>:
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">def</span> square
  <span style="color: #da70d6;">(</span><span style="color: #569cd6;">fn</span> <span style="color: #87cefa;">(</span>x<span style="color: #87cefa;">)</span> <span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">*</span> x x<span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
square
</pre>


<p>
Para  que não  precisemos  usar com  frequência a  dupla  <code>def</code> &#x2026;  <code>fn</code>,
instituiremos um  atalho sintático (um  <i>macro</i>) que faça  este trabalho
por nós, tornando  as funções mais simples de serem  lidas. Este macro
se chamará <code>defn</code>, e poderá ser escrito usando a regra sintática:
</p>

<pre class="example" id="org0facc83">
(defn &lt;nome&gt; &lt;argumentos&gt; &lt;corpo&gt;)
</pre>

<p>
Se esse "atalho sintático" fosse  expandido, seria exatamente igual ao
exemplo anterior,  em que usamos <code>def</code>  e <code>fn</code>, portanto as  regras para o
símbolo, os argumentos e o corpo ainda se aplicam.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">defn</span> square <span style="color: #da70d6;">(</span>x<span style="color: #da70d6;">)</span>
  <span style="color: #da70d6;">(</span><span style="color: #dcdcaa;">*</span> x x<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
square
</pre>


<p>
A aplicação de uma função do usuário é muito similar, se não idêntica,
à aplicação de uma função primitiva.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>square 5<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
25
</pre>
</div>

<div id="outline-container-org085a7ab" class="outline-4">
<h4 id="org085a7ab"><b>Funções locais.</b></h4>
<div class="outline-text-4" id="text-org085a7ab">
<p>
Assim  como no  caso das  variáveis locais,  existem situações  onde é
interessante  criar  funções de  usuário  que  só valham  para  certos
escopos. Isso  pode ser feito  usando a  forma <code>letfn</code>, que  atribui uma
função a um símbolo em um escopo léxico, tal qual a forma <code>let</code>.
</p>

<p>
Similar  a <code>defn</code>,  cada  cláusula de  <code>letfn</code>, de  forma  análoga a  <code>let</code>,
define uma  função local. A sintaxe  de cada cláusula é  idêntica à de
<code>defn</code>, excluindo-se o uso do símbolo <code>defn</code> em si.
</p>

<p>
O exemplo a seguir define globalmente a função de usuário <code>1+</code>, que soma
uma unidade a um certo número. Em seguida, criamos um escopo onde <code>1+</code> é
redefinido  como  uma função  que  soma  um  número  a si  mesmo;  tal
definição desaparece ao fim desse escopo.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">defn</span> <span style="color: #dcdcaa;">1+</span> <span style="color: #da70d6;">(</span>x<span style="color: #da70d6;">)</span> <span style="color: #da70d6;">(</span><span style="color: #dcdcaa;">+</span> x 1<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
1+
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">letfn</span> <span style="color: #da70d6;">(</span><span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">1+</span> <span style="color: #ffd700;">(</span>x<span style="color: #ffd700;">)</span>
          <span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">+</span> x x<span style="color: #ffd700;">)</span><span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span>
  <span style="color: #da70d6;">(</span><span style="color: #dcdcaa;">1+</span> 5<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
10
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">1+</span> 5<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
6
</pre>
</div>
</div>

<div id="outline-container-org7615a7c" class="outline-4">
<h4 id="org7615a7c">Funções globais recursivas.</h4>
<div class="outline-text-4" id="text-org7615a7c">
<p>
É  interessante  observarmos  como  funciona  a  recursão  em  funções
definidas globalmente em Majestic Lisp.
</p>

<p>
A  função <code>foo</code>  a seguir  é recursiva  (pois sua  definição depende  da
invocação de si mesma).
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">defn</span> foo <span style="color: #da70d6;">(</span>n<span style="color: #da70d6;">)</span>
  <span style="color: #da70d6;">(</span><span style="color: #569cd6;">when</span> <span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">&lt;</span> n 3<span style="color: #87cefa;">)</span>
    <span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">print</span> <span style="color: #ce9178;">"foo #{}"</span> <span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">1+</span> n<span style="color: #ffd700;">)</span><span style="color: #87cefa;">)</span>
    <span style="color: #87cefa;">(</span>foo <span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">1+</span> n<span style="color: #ffd700;">)</span><span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
foo
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>foo 0<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
foo #1
foo #2
foo #3
nil
</pre>


<p>
Durante  a  execução  de  <code>foo</code>,   um  interpretador  de  Majestic  Lisp
consultará a tabela local de símbolos para realizar uma nova aplicação
da função atrelada ao símbolo  <code>foo</code>. Isso ocorre sem maiores problemas,
já  que  <code>foo</code>  está  registrado  em  um  contexto  visível  em  toda  a
aplicação.
</p>
</div>
</div>

<div id="outline-container-org76c07ac" class="outline-4">
<h4 id="org76c07ac">Funções locais recursivas.</h4>
<div class="outline-text-4" id="text-org76c07ac">
<p>
O uso de <code>letfn</code> é suficiente  para a maioria das situações onde funções
locais  são necessárias,  porém, este  exemplo falha  quando a  função
local precisa  ser recursiva <b>e</b>  precisa ser executada em  outro escopo
que não seja o local.
</p>

<p>
Considere o  exemplo a seguir.  Temos um uso  de <code>letfn</code> que  define uma
função local <code>foo</code>, igualmente recursiva  como no exemplo de recursão em
funções globais. Todavia, o escopo de  <code>letfn</code> retorna a função ligada a
<code>foo</code> localmente, que é então atribuída ao símbolo <code>bar</code> globalmente.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">def</span> bar
  <span style="color: #da70d6;">(</span><span style="color: #569cd6;">letfn</span> <span style="color: #87cefa;">(</span><span style="color: #ffd700;">(</span>foo <span style="color: #da70d6;">(</span>n<span style="color: #da70d6;">)</span>
            <span style="color: #da70d6;">(</span><span style="color: #569cd6;">when</span> <span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">&lt;</span> n 3<span style="color: #87cefa;">)</span>
              <span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">print</span> <span style="color: #ce9178;">"foo #{}"</span> <span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">1+</span> n<span style="color: #ffd700;">)</span><span style="color: #87cefa;">)</span>
              <span style="color: #87cefa;">(</span>foo <span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">1+</span> n<span style="color: #ffd700;">)</span><span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span><span style="color: #87cefa;">)</span>
    foo<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
bar
</pre>


<p>
Quando <code>bar</code>  for executada,  note que,  mesmo que  a função  tenha sido
originalmente atribuída como  <code>foo</code>, como este símbolo já  não existe no
contexto local (e nem em um contexto global), <code>bar</code> executará apenas uma
vez, mostrando um erro assim que <code>foo</code> for invocada.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>bar 0<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
foo #1
Error: foo is unbound
</pre>


<p>
Isso ocorre  porque, quando definimos  uma função recursiva  local via
<code>letfn</code>, essa função não captura o  escopo na qual foi criada; em outras
palavras, quando a execução de <code>foo</code> ocorre fora do <code>letfn</code>, <code>foo</code> é incapaz
de encontrar uma referência a si mesmo<sup><a id="fnr.3" class="footref" href="#fn.3" role="doc-backlink">3</a></sup>.
</p>

<p>
Para tanto, podemos usar a  forma especial <code>letrec</code>. Esta forma especial
funciona  de forma  idêntica a  <code>letfn</code>, porém  garante que  cada função
local  definida tenha  acesso permanente  ao  escopo em  que todas  as
funções de <code>letrec</code> foram definidas.
</p>

<p>
<code>letrec</code> pode, então, ser utilizado não apenas em contextos de definição
local de  funções recursivas  que sairão  daquele escopo,  como também
pode  ser  utilizado  para  definir funções  locais  que  se  utilizam
mutuamente, onde uma ou mais delas também sairá do escopo de <code>letrec</code>.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">def</span> bar
  <span style="color: #da70d6;">(</span><span style="color: #569cd6;">letrec</span> <span style="color: #87cefa;">(</span><span style="color: #ffd700;">(</span>foo <span style="color: #da70d6;">(</span>n<span style="color: #da70d6;">)</span>
             <span style="color: #da70d6;">(</span><span style="color: #569cd6;">when</span> <span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">&lt;</span> n 3<span style="color: #87cefa;">)</span>
               <span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">print</span> <span style="color: #ce9178;">"foo #{}"</span> <span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">1+</span> n<span style="color: #ffd700;">)</span><span style="color: #87cefa;">)</span>
               <span style="color: #87cefa;">(</span>foo <span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">1+</span> n<span style="color: #ffd700;">)</span><span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span><span style="color: #87cefa;">)</span>
    foo<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
bar
</pre>


<p>
A definição de  <code>bar</code>, dessa vez, carrega uma função  que, antes, estava
associada ao  símbolo <code>foo</code>; essa  função, porém, captura o  contexto de
<code>letrec</code>, onde o símbolo <code>foo</code> está bem-definido como sendo uma referência
a ela mesma.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>bar 0<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
foo #1
foo #2
foo #3
nil
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgef46abb" class="outline-2">
<h2 id="orgef46abb"><span class="section-number-2">3.</span> Controle de fluxo</h2>
<div class="outline-text-2" id="text-3">
<p>
Majestic Lisp também  provê algumas estruturas capazes  de controlar o
fluxo  de execução  de programas.  A  linguagem segue  a estrutura  de
outros Lisps nesse sentido,  replicando com muita similaridade algumas
formas especiais canônicas.
</p>

<p>
O primeiro tipo de condicional envolve a forma especial <code>if</code>. Essa forma
é escrita segundo a regra sintática:
</p>

<pre class="example" id="org8ea8faf">
(if &lt;condição&gt; &lt;consequência&gt; &lt;alternativa&gt;)
</pre>

<p>
Assim,  <code>&lt;condição&gt;</code>, <code>&lt;consequência&gt;</code>  e <code>&lt;alternativa&gt;</code>  são expressões  a
serem interpretadas segundo certas regras especiais.
</p>

<p>
Primeiramente,   Majestic  Lisp   tentará   interpretar  a   expressão
<code>&lt;condição&gt;</code>.  Caso seu  valor seja  verdadeiro (ou  seja, diferente  de
<code>nil</code>), a expressão <code>&lt;consequência&gt;</code>  será interpretada. Caso contrário, a
expressão <code>&lt;alternativa&gt;</code> será interpretada.
</p>

<p>
A função <code>with-one</code>  a seguir verifica pela nulidade de  um objeto. Caso
esse  objeto seja  nulo, será  retornado  um <i>cons</i>  entre <code>0</code>  e <code>1</code>;  caso
contrário, será retornado um <i>cons</i> entre o objeto em questão e <code>1</code>.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">defn</span> with-one <span style="color: #da70d6;">(</span>x<span style="color: #da70d6;">)</span>
  <span style="color: #da70d6;">(</span><span style="color: #569cd6;">if</span> <span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">nilp</span> x<span style="color: #87cefa;">)</span>
      <span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">cons</span> 0 1<span style="color: #87cefa;">)</span>
      <span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">cons</span> x 1<span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
with-one
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>with-one nil<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
(0 . 1)
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>with-one 5<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
(5 . 1)
</pre>


<p>
Outro tipo  de condicional é a  forma <code>cond</code>. Essa forma  é extremamente
útil quando lidamos  com condicionais que envolvem mais  que apenas um
predicado.
</p>

<p>
Por exemplo, uma condicional como esta:
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">if</span> pred1
    conseq1
    <span style="color: #da70d6;">(</span><span style="color: #569cd6;">if</span> pred2
        conseq2
        conseq3<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<p>
&#x2026;pode ser reescrita, usando <code>cond</code>, da seguinte forma:
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">cond</span> <span style="color: #da70d6;">(</span>pred1 conseq1<span style="color: #da70d6;">)</span>
      <span style="color: #da70d6;">(</span>pred2 conseq2<span style="color: #da70d6;">)</span>
      <span style="color: #da70d6;">(</span>t conseq3<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<p>
Assim, podemos  transformar o que  seria um encadeamento  sucessivo de
<code>if</code>'s em algo sintaticamente agradável.
</p>

<p>
A função <code>abs</code> retratada a seguir  é uma forma redundante de definir uma
função que calcula  o valor absoluto de um número.  Caso o número seja
igual a  <code>0</code>, será  retornado <code>0</code>; caso  o número seja  maior que  <code>0</code>, este
mesmo número será  retornado; mas, se o número for  menor que <code>0</code>, então
será retornado o valor aritmeticamente oposto a ele.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">defn</span> abs <span style="color: #da70d6;">(</span>x<span style="color: #da70d6;">)</span>
  <span style="color: #da70d6;">(</span><span style="color: #569cd6;">cond</span> <span style="color: #87cefa;">(</span><span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">zerop</span> x<span style="color: #ffd700;">)</span> 0<span style="color: #87cefa;">)</span>
        <span style="color: #87cefa;">(</span><span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">&gt;</span> x 0<span style="color: #ffd700;">)</span> x<span style="color: #87cefa;">)</span>
        <span style="color: #87cefa;">(</span>t <span style="color: #ffd700;">(</span><span style="color: #dcdcaa;">-</span> x<span style="color: #ffd700;">)</span><span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
abs
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>abs 0<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
0
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>abs 5<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
5
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>abs -5<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
5
</pre>
</div>
</div>

<div id="outline-container-orgd7e911c" class="outline-2">
<h2 id="orgd7e911c"><span class="section-number-2">4.</span> <i>Quasiquoting</i></h2>
<div class="outline-text-2" id="text-4">
<p>
Um  dos elementos  cruciais da  metaprogramação em  Majestic Lisp  é a
ideia de <i>quasiquoting</i>. O conceito é  muito similar à ideia de <i>quoting</i>,
onde toda  uma lista  <i>quasiquotada</i> é, por  padrão, tratada  como dados
pelo interpretador.
</p>

<p>
Todavia,  empregar  o recurso  do  <i>quasiquote</i>  permite ao  programador
estipular  alguns  dados  no  interior  de  uma  expressão  que  serão
efetivamente <i>interpretados</i>.   Em outras palavras, alguns  elementos da
lista serão dados  produzidos durante o processo de  retorno da mesma,
enquanto outros permanecerão intactos.
</p>

<p>
Uma lista quasiquotada é precedida pelo  acento grave (<code>`</code>), ao invés do
apóstrofo que simboliza o <i>quote</i> (<code>'</code>). Algumas formas dentro dessa lista
poderão estar  precedidas pelos  símbolos especiais  de <i>unquote</i>  (<code>,</code>) e
<i>unquote-splice</i> (<code>,@</code>).
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">defn</span> hello <span style="color: #da70d6;">(</span><span style="color: #dcdcaa;">name</span><span style="color: #da70d6;">)</span>
  `<span style="color: #da70d6;">(</span>good morning ,<span style="color: #dcdcaa;">name</span> <span style="color: #569cd6;">and</span> have a nice day<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
hello
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>hello 'fulano<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
(good morning fulano and have a nice day)
</pre>


<p>
A função de usuário <code>hello</code>  apresentada acima recebe um único argumento
&#x2013; <code>name</code> &#x2013;  que será inserido diretamente numa  lista, precedido pelos
respectivos símbolos  <code>good</code> e  <code>morning</code>. Veja que,  com o  <i>quasiquote</i>, é
possível deixar  claro o  local exato  onde o  valor associado  a <code>name</code>
ficará, e  este valor é marcado  através do <i>unquote</i> da  expressão <code>name</code>
nesta lista.
</p>

<p>
Todavia,  o processo  de  <i>unquote</i>  não realiza  distinção  se o  valor
associado a <code>name</code> é uma lista ou não:
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>hello '<span style="color: #da70d6;">(</span>fulano da silva<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
(good morning (fulano da silva) and have a nice day)
</pre>


<p>
Em uma situação ideal, podemos  realizar essa distinção reescrevendo a
função  <code>hello</code> de  forma que,  quando o  valor recebido  na chamada  da
função  for  uma  <i>lista</i>,  <b>apenas   seu  conteúdo  seja  adicionado  ao
resultado</b>. A este processo, damos o nome de <i>unquote-splice</i>.
</p>

<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span><span style="color: #569cd6;">defn</span> hello <span style="color: #da70d6;">(</span><span style="color: #dcdcaa;">name</span><span style="color: #da70d6;">)</span>
  <span style="color: #da70d6;">(</span><span style="color: #569cd6;">if</span> <span style="color: #87cefa;">(</span><span style="color: #dcdcaa;">consp</span> <span style="color: #dcdcaa;">name</span><span style="color: #87cefa;">)</span>
      `<span style="color: #87cefa;">(</span>good morning ,@name <span style="color: #569cd6;">and</span> have a nice day<span style="color: #87cefa;">)</span>
      `<span style="color: #87cefa;">(</span>good morning ,<span style="color: #dcdcaa;">name</span> <span style="color: #569cd6;">and</span> have a nice day<span style="color: #87cefa;">)</span><span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
hello
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>hello '<span style="color: #da70d6;">(</span>fulano da silva<span style="color: #da70d6;">)</span><span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
(good morning fulano da silva and have a nice day)
</pre>


<div class="org-src-container">
<pre class="src src-majestic"><span style="color: #ffd700;">(</span>hello 'fulano<span style="color: #ffd700;">)</span>
</pre>
</div>

<pre class="example">
(good morning fulano and have a nice day)
</pre>


<p>
Veja que, como previsto, apenas o conteúdo da lista <i>quotada</i> <code>(fulano da
silva)</code>  foi adicionado  diretamente à  lista, como  se seus  elementos
tivessem sido "desempacotados" na lista de nível superior.
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Macros  auxiliam o  programador, possibilitando a  definição de
nova sintaxe que, em tempo de execução, se transforma em sintaxe menos
intuitiva. Veremos como isso funciona posteriormente.
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
É interessante  notar que, em Majestic Lisp, a  função <code>+</code> também
pode operar  sobre um  único número, calculando  seu <i>conjugado</i>  &#x2013; uma
operação que funciona com números  complexos. Caso o número não possua
esse subtipo, <code>+</code> apenas retorna o número sem modificações.
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Isso ocorre  por intermédio de escopo dinâmico em  <code>letfn</code>, o que
pode inclusive não ser desejável.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Lucas S. Vieira</p>
<p class="date">Created: 2022-10-23 dom 23:28</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
